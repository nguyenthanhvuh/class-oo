<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-11-20 Sun 21:34 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>SWE 419 Notes</title>
<meta name="author" content="ThanhVu (Vu) Nguyen" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="https://dynaroars.github.io/files/org.css">
<link rel="alternative stylesheet" href="https://dynaroars.github.io/files/org-orig.css">
</head>
<body>
<div id="content" class="content">
<h1 class="title">SWE 419 Notes</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgdc925d8">1. Lecture 11</a></li>
<li><a href="#org39ace8a">2. In class 2 (MLO 1, 2, 3) [.5 hours]</a></li>
<li><a href="#orgd00ce99">3. Lecture 10</a></li>
<li><a href="#org36dc471">4. Lecture 9 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-11-04 Fri&gt;</span></span>)</a></li>
<li><a href="#orgf66da64">5. Lecture 8 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-10-28 Fri&gt;</span></span>)</a></li>
<li><a href="#org0ff49d5">6. Lecture 7 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-10-21 Fri&gt;</span></span>)</a></li>
<li><a href="#orgc1cf1eb">7. Lecture 6 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-10-07 Fri&gt;</span></span>)</a></li>
<li><a href="#org772905b">8. Lecture 5 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-09-30 Fri&gt;</span></span>)</a></li>
<li><a href="#orgb547d31">9. Lecture 4 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-09-16 Fri&gt;</span></span>)</a></li>
<li><a href="#org710da70">10. Lecture 3 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-09-09 Fri&gt;</span></span>)</a></li>
<li><a href="#orgb2e0317">11. Lecture 2 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-09-02 Fri&gt;</span></span>)</a></li>
<li><a href="#org6d5a979">12. Lecture 1 (8/26)</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgdc925d8" class="outline-2">
<h2 id="orgdc925d8"><span class="section-number-2">1.</span> Lecture 11</h2>
<div class="outline-text-2" id="text-1">
<p>
JUnit and Junit Theories
</p>

<p>
JUnit Theories
</p>
<div class="org-src-container">
<pre class="src src-java">
  <span style="color: #b751b6;">@RunWith</span>(Theories.<span style="color: #e45649;">class</span>)
  <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">MyJunitTheories</span> {

      <span style="color: #b751b6;">@DataPoints</span>
      <span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #986801;">int</span>[] <span style="color: #a626a4;">dataPoints</span>() {
          <span style="color: #e45649;">return</span> <span style="color: #e45649;">new</span> <span style="color: #986801;">int</span>[]{
                  71, 82, 53, -1
          };
      }

      <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">For a and b where a,b &gt; 0</span>
      <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">(a+b)^2 = a^2+b^2+2ab </span>
      <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">a+b &gt; a and a+b &gt; b</span>

      <span style="color: #b751b6;">@Theory</span>
      <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">squareTheory</span>(<span style="color: #986801;">Integer</span> <span style="color: #6a1868;">a</span>, <span style="color: #986801;">Integer</span> <span style="color: #6a1868;">b</span>){

          <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">Below assume statement ensures that we are testing only positive numbers</span>
          Assume.assumeTrue(a &gt; 0 &amp;&amp; b &gt; 0);

          System.out.println(<span style="color: #50a14f;">"Running with Data points - "</span> + a + <span style="color: #50a14f;">" , "</span>+ b);

          <span style="color: #986801;">Double</span> <span style="color: #6a1868;">leftSide</span> = Math.pow(a+b,2);
          <span style="color: #986801;">Double</span> <span style="color: #6a1868;">rightSide</span> = Double.valueOf(a * a + b * b + 2 * a * b);

          assertEquals(leftSide,rightSide);

          assertTrue(a + b &gt; a);
          assertTrue(a + b &gt; b);
      }
}      
</pre>
</div>

<ul class="org-ul">
<li><p>
16 tests in total
</p>

<div class="org-src-container">
<pre class="src src-txt">-1,-1
53,53
82,82
71,71
71,82
82,71
82,53
53,82
53,-1
-1,53
71,53
53,71
71,-1
-1,71
82,-1
-1,82
</pre>
</div></li>

<li><p>
7 fail preconditions
</p>
<div class="org-src-container">
<pre class="src src-txt">-1,-1
53,-1
...
</pre>
</div></li>

<li><p>
7 pass the tests (fail preconds) + the other 9  = 16
</p>
<div class="org-src-container">
<pre class="src src-txt">53,71 .. pass
</pre>
</div></li>
</ul>



<ul class="org-ul">
<li>pair of points over 5 data points</li>
</ul>
<p>
5**2 = 25 (Cartesian product)
</p>

<ul class="org-ul">
<li>k over n</li>
</ul>
<p>
n**k   
n=5,k=2    5x5 = 25
n=5,k=3    5x5x5 = 1255
n=100,k=2  100x100 = 10,000
</p>
</div>
</div>


<div id="outline-container-org39ace8a" class="outline-2">
<h2 id="org39ace8a"><span class="section-number-2">2.</span> In class 2 (MLO 1, 2, 3) [.5 hours]</h2>
<div class="outline-text-2" id="text-2">
<p>
This is a JUnit theory exercise.
</p>

<ol class="org-ol">
<li>Write a JUnit theory that captures the symmetry property of the <code>equals()</code> method.
<ol class="org-ol">
<li>Create <code>@DataPoints</code> from Bloch's <code>Point</code>, <code>ColorPoint</code> classes. So that we're all on the same page, create 1 <code>null</code> reference, 1 <code>Point</code> object and 2 <code>ColorPoint</code> objects.</li>
<li>Given this set of data points:
<ul class="org-ul">
<li>How many combinations are considered by the theory?</li>
<li>How many combinations make it past the preconditions of the theory?</li>
<li>How many combinations make it to the postcondition of the theory?</li>
</ul></li>
<li>What happens to this theory and the accompanying data points when favoring composition over inheritance?</li>
</ol></li>
<li>Repeat the exercise for the transitive property for <code>equals()</code>.</li>
<li>Recall the <code>equals()</code> and <code>hashCode()</code> discussion in Bloch. Write a JUnit theory that encodes the consistency property between <code>equals()</code> and <code>hashCode()</code>.</li>
<li>Build a toy example that violates the theory. Fix the toy example so that the theory is no longer violated.</li>
<li>Consider the <code>Comparable</code> interface: what properties should be checked with theories?</li>
</ol>


<p>
<b>SOLUTION:</b>
</p>
<div class="org-src-container">
<pre class="src src-java">  <span style="color: #b751b6;">@DataPoints</span>
   <span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #986801;">Point</span>[] <span style="color: #6a1868;">points</span> = {<span style="color: #b751b6;">null</span>, <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">a</span>
       <span style="color: #e45649;">new</span> <span style="color: #986801;">Point</span>(2,2),  <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">b</span>
       <span style="color: #e45649;">new</span> <span style="color: #986801;">ColorPoint</span>(2,2,<span style="color: #b751b6;">COLOR</span>.BLACK), <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">c</span>
       <span style="color: #e45649;">new</span> <span style="color: #986801;">ColorPoint</span>(2,2 ,<span style="color: #b751b6;">COLOR</span>.RED)}; <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">d</span>

  <span style="color: #b751b6;">@Theory</span>
  <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">testEquals</span>(<span style="color: #986801;">Object</span> <span style="color: #6a1868;">a</span>, <span style="color: #986801;">Object</span> <span style="color: #6a1868;">b</span>) {  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">can also use Point, but Object is more general and just</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">symmetry</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">*if* (a==b) then b==a AND</span>

      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">if (b==a) then a==b</span>
      <span style="color: #9ca0a4;">//  </span><span style="color: #9ca0a4;">a==b iff b==a</span>

      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">NOT correct : too strong</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">a==b AND b==a</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">a.equals(b) == FALSE  =&gt;  b.equals(a) == FALSE</span>

      assumeTrue(a!= <span style="color: #b751b6;">null</span> &amp;&amp; b != <span style="color: #b751b6;">null</span>);

      <span style="color: #e45649;">if</span>(a.equals(b)){assertTrue(b.equals(a));}
      <span style="color: #e45649;">if</span>(b.equals(a)){assertTrue(a.equals(b));}

      <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">or , a shorter version</span>
      assertTrue(a.equals(b) == b.equals(a));

      <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;"># of tests = 4*4 = 16</span>
      <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;"># of tests passing the preconds: 9</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">fail preconds(null,null;  *,null, null,*)</span>

      <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">passing tests</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">a,a</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">a,*</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">*,a</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">b,b</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">c,c</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">d,d</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">c,d because c.equals(d) == FALSE  == d.equals(c) == FALSE </span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">d,c because d.equals(c) == FALSE  == c.equals(d) == FALSE</span>

      <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">failing tests</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">b,c  b.equals(c)  == T</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">c.equals(b)  == F</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">c,b  ....</span>
  }

<span style="color: #b751b6;">@Theory</span>
<span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">equalsTransitivity</span>(<span style="color: #986801;">Object</span> <span style="color: #6a1868;">x</span>, <span style="color: #986801;">Object</span> <span style="color: #6a1868;">y</span>, <span style="color: #986801;">Object</span> <span style="color: #6a1868;">z</span>){
    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">(x.equals(y) and y.equals(z)) =&gt; x.equals(z)</span>
    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">if (x.equals(y) and y.equals(z)) then  x.equals(z)</span>

    assumeTrue(x!=<span style="color: #b751b6;">null</span> &amp;&amp; y!=<span style="color: #b751b6;">null</span> &amp;&amp; z!= <span style="color: #b751b6;">null</span>);
    <span style="color: #e45649;">if</span>(x.equals(y) &amp;&amp; y.equals(z)){
        assertTrue(x.equals(z))
    }

    assumeEquals(x,y);
    assumeEquals(y,z);
    assertTrue(x,z);
}


<span style="color: #b751b6;">@Theory</span>
<span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">equalsHashCode</span>(<span style="color: #986801;">Object</span> <span style="color: #6a1868;">x</span>, <span style="color: #986801;">Object</span> <span style="color: #6a1868;">y</span>){
    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">if(x==y) then x.hash == y.hash</span>

  assumeTrue(x != <span style="color: #b751b6;">null</span>);
  assumeTrue(y != <span style="color: #b751b6;">null</span>);

  assumeTrue(x.equals(y));
  assertTrue(x.hashCode() == y.hashCode());

}

</pre>
</div>
</div>
</div>



<div id="outline-container-orgd00ce99" class="outline-2">
<h2 id="orgd00ce99"><span class="section-number-2">3.</span> Lecture 10</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>Constructor must not invoke overridable methods</li>
</ul>

<div class="org-src-container">
<pre class="src src-java">   <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Super</span> {
       <span style="color: #e45649;">public</span> Super() {m();}
       <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">m</span>() {
        <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">initialization code</span>
        print(<span style="color: #50a14f;">"Super m"</span>);
       }

   <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Sub</span> <span style="color: #e45649;">extends</span> <span style="color: #986801;">Super</span> {
       <span style="color: #e45649;">private</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">Date</span> <span style="color: #6a1868;">date</span>;
       <span style="color: #e45649;">public</span> Sub() {
           <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">Super()</span>
           date = <span style="color: #e45649;">new</span> <span style="color: #986801;">Date</span>();
       }
       <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">m</span>() {
           <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">access date variable</span>
           print(<span style="color: #50a14f;">"Sub m"</span>);
       }

   <span style="color: #986801;">Sub</span> <span style="color: #6a1868;">s</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">Sub</span>();
   <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">"Sub m"</span>
 #+end_src java


 - Favor composition over inheritence

 #+begin_src java 
 <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">InstrumentedHashSet</span>&lt;<span style="color: #986801;">E</span>&gt; <span style="color: #e45649;">extends</span> <span style="color: #986801;">HashSet</span>&lt;<span style="color: #986801;">E</span>&gt;    {
         <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">The number of attempted element insertions</span>
         <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">addCount</span> = 0;
         <span style="color: #e45649;">public</span> InstrumentedHashSet() {         }
         <span style="color: #e45649;">public</span> InstrumentedHashSet(<span style="color: #986801;">int</span> <span style="color: #6a1868;">initCap</span>, <span style="color: #986801;">float</span> <span style="color: #6a1868;">loadFactor</span>) {
                 <span style="color: #e45649;">super</span>(initCap, loadFactor);
         }
         <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">add</span>(<span style="color: #986801;">E</span> <span style="color: #6a1868;">e</span>) {
                 addCount++;
                 <span style="color: #e45649;">return</span> <span style="color: #e45649;">super</span>.add(e);
         }
         <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">addAll</span>(<span style="color: #986801;">Collection</span>&lt;? <span style="color: #e45649;">extends</span> <span style="color: #986801;">E</span>&gt; <span style="color: #6a1868;">c</span>) {
                 <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">addCount += c.size();</span>
                 <span style="color: #e45649;">return</span> <span style="color: #e45649;">super</span>.addAll(c);
         }
         <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">getAddCount</span>() {     <span style="color: #e45649;">return</span> addCount; }
 }

<span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">client code</span>
<span style="color: #986801;">InstrumentedHashSet</span>&lt;<span style="color: #986801;">String</span>&gt; <span style="color: #6a1868;">s</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">InstrumentedHashSet</span>&lt;&gt;();
s.addAll(Arrays.asList(<span style="color: #50a14f;">"Snap"</span>, <span style="color: #50a14f;">"Crackle"</span>, <span style="color: #50a14f;">"Pop"</span>));
print(s.getAddCount()); <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">??</span>

</pre>
</div>



<div class="org-src-container">
<pre class="src src-java"><span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Wrapper class - uses composition in place of inheritance</span>
<span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">InstrumentedSet</span>&lt;<span style="color: #986801;">E</span>&gt; <span style="color: #e45649;">extends</span> <span style="color: #986801;">ForwardingSet</span>&lt;<span style="color: #986801;">E</span>&gt; {
    <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">addCount</span> = 0;

    <span style="color: #e45649;">public</span> InstrumentedSet(<span style="color: #986801;">Set</span>&lt;<span style="color: #986801;">E</span>&gt; <span style="color: #6a1868;">s</span>) {
        <span style="color: #e45649;">super</span>(s);
    }
    <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">add</span>(<span style="color: #986801;">E</span> <span style="color: #6a1868;">e</span>) {
        addCount++;
        <span style="color: #e45649;">return</span> <span style="color: #e45649;">super</span>.add(e);
     }
     <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">addAll</span>(<span style="color: #986801;">Collection</span>&lt;? <span style="color: #e45649;">extends</span> <span style="color: #986801;">E</span>&gt; <span style="color: #6a1868;">c</span>) {
         addCount += c.size();
         <span style="color: #e45649;">return</span> <span style="color: #e45649;">super</span>.addAll(c);
     }
     <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">getAddCount</span>() {
         <span style="color: #e45649;">return</span> addCount;
     }
}

<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Reusable forwarding class</span>
<span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">ForwardingSet</span>&lt;<span style="color: #986801;">E</span>&gt; <span style="color: #e45649;">implements</span> <span style="color: #986801;">Set</span>&lt;<span style="color: #986801;">E</span>&gt; {
    <span style="color: #e45649;">private</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">Set</span>&lt;<span style="color: #986801;">E</span>&gt; <span style="color: #6a1868;">s</span>;
    <span style="color: #e45649;">public</span> ForwardingSet(<span style="color: #986801;">Set</span>&lt;<span style="color: #986801;">E</span>&gt; <span style="color: #6a1868;">s</span>) {
        <span style="color: #e45649;">this</span>.s = s;
    }

    <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">clear</span>()               { s.clear();            }
    <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">contains</span>(<span style="color: #986801;">Object</span> <span style="color: #6a1868;">o</span>) { <span style="color: #e45649;">return</span> s.contains(o); }
    <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">isEmpty</span>()          { <span style="color: #e45649;">return</span> s.isEmpty();   }
    <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">size</span>()                 { <span style="color: #e45649;">return</span> s.size();      }
    <span style="color: #e45649;">public</span> <span style="color: #986801;">Iterator</span>&lt;<span style="color: #986801;">E</span>&gt; <span style="color: #a626a4;">iterator</span>()     { <span style="color: #e45649;">return</span> s.iterator();  }
    <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">add</span>(<span style="color: #986801;">E</span> <span style="color: #6a1868;">e</span>)           { <span style="color: #e45649;">return</span> s.add(e);      }
    <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">remove</span>(<span style="color: #986801;">Object</span> <span style="color: #6a1868;">o</span>)   { <span style="color: #e45649;">return</span> s.remove(o);   }
    <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">containsAll</span>(<span style="color: #986801;">Collection</span>&lt;?&gt; <span style="color: #6a1868;">c</span>)
                                   { <span style="color: #e45649;">return</span> s.containsAll(c); }
    <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">addAll</span>(<span style="color: #986801;">Collection</span>&lt;? <span style="color: #e45649;">extends</span> <span style="color: #986801;">E</span>&gt; <span style="color: #6a1868;">c</span>)
                                   { <span style="color: #e45649;">return</span> s.addAll(c);      }
    <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">removeAll</span>(<span style="color: #986801;">Collection</span>&lt;?&gt; <span style="color: #6a1868;">c</span>)
                                   { <span style="color: #e45649;">return</span> s.removeAll(c);   }
    <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">retainAll</span>(<span style="color: #986801;">Collection</span>&lt;?&gt; <span style="color: #6a1868;">c</span>)
                                   { <span style="color: #e45649;">return</span> s.retainAll(c);   }
    <span style="color: #e45649;">public</span> <span style="color: #986801;">Object</span>[] <span style="color: #a626a4;">toArray</span>()          { <span style="color: #e45649;">return</span> s.toArray();  }
    <span style="color: #e45649;">public</span> &lt;<span style="color: #986801;">T</span>&gt; <span style="color: #986801;">T</span>[] <span style="color: #a626a4;">toArray</span>(<span style="color: #986801;">T</span>[] <span style="color: #6a1868;">a</span>)      { <span style="color: #e45649;">return</span> s.toArray(a); }
    <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">equals</span>(<span style="color: #986801;">Object</span> <span style="color: #6a1868;">o</span>)
                                       { <span style="color: #e45649;">return</span> s.equals(o);  }
    <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">hashCode</span>()    { <span style="color: #e45649;">return</span> s.hashCode(); }
    <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">String</span> <span style="color: #a626a4;">toString</span>() { <span style="color: #e45649;">return</span> s.toString(); }
}
</pre>
</div>



<ul class="org-ul">
<li>From Mac Os Notes: Item 17</li>
<li>Constructor must not invoke overridable methods
<ul class="org-ul">
<li>super, sub code from notesS22</li>
</ul></li>
<li>Prefers composition over Inheritence
<ul class="org-ul">
<li>Wes's slides
<ul class="org-ul">
<li>show incorrect count due by Inheritance</li>
<li>show how it can be fixed with forwarding class</li>
</ul></li>
<li>Inclass 12A
<ul class="org-ul">
<li>- IC A</li>
<li>keep track of how many times add has been called (directly from add() or indirectly from addAll())</li>
<li>Composition instead of inheritence</li>
<li><b>Sol</b>
<ul class="org-ul">
<li>don’t do anything with addAll in InstrumentedHashSet so that it inherits addAll from HashSet which calls adds() which will call the InstrumentedHashSet’s adds (and therefore increment correctly).</li>
<li>why hard question: depends on implementations</li>
<li>equals:  does not consider addCount, only considers the contents of the set</li>
<li>Q2: value of sh.addAll()  :   2</li>
<li>Q3: InstrumentedSet is better because it uses composition instead of inheritence (so doesn’t require knowledge of how things are implemented in details; also can work on any kind of Set (ForwardSet implements Set) whereas InstrumentedHashSet only extends HashSet)</li>
<li>Q4: all true (cat and dog).  Set’s equal contracts require if both are instances of set and they both have same things in them (cat and dog) and so they must be all equal.</li>
<li>Q5</li>
</ul></li>
<li>11:  s=r=[ant,bee,cat]</li>
<li>15: s=r=t=[ant,bee,cat,dog]</li>
<li>18:s=r=t=[bee,ant]
<ul class="org-ul">
<li>sh.addCount=2</li>
<li>r.addCount = 2</li>
<li>s.addCount=4</li>
<li>t.addCount=1</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org36dc471" class="outline-2">
<h2 id="org36dc471"><span class="section-number-2">4.</span> Lecture 9 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-11-04 Fri&gt;</span></span>)</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li>Go over Quiz</li>
<li>Common Java methods (methods in class Object that should be extended from classes extending Object)
<ul class="org-ul">
<li>equals</li>
<li>toString</li>
<li>hashCode</li>
<li>clone &#x2026;</li>
</ul></li>
<li>objective of this class: able to overrride these methods correctly</li>
</ul>


<p>
o1
o2
o3
</p>

<p>
equivalence relationship
</p>
<ul class="org-ul">
<li>reflexive:
o1.equals(o1) // TRUE</li>
<li>symmetry:
o1.equals(o2) == o2.equals(o1)</li>
<li>transitive:
o1.equals(o2) &amp; o2.equals(o3)  =&gt; o1.equals(o3)</li>
</ul>


<div class="org-src-container">
<pre class="src src-java"><span style="color: #986801;">Point</span> <span style="color: #6a1868;">p1</span> = p(3,4);
<span style="color: #986801;">ColorPoint</span> <span style="color: #6a1868;">p2</span> = ColorPoint(3,4,RED);
<span style="color: #986801;">ColorPoint</span> <span style="color: #6a1868;">p3</span> = ColorPoint(3,4,BLUE);

p1.equals(p2); <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">TRUE</span>
p2.equals(p1); <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">FALSE</span>
<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">symmetry: if p1 = p2 then p2 = p1</span>

p1.equals(p2); <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">TRUE</span>
p2.equals(p1); <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">TRUE   //OK for symmetry</span>

p2.equals(p1); <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">TRUE</span>
p1.equals(p3); <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">TRUE</span>
p2.equals(p3); <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">FALSE  //breaks transitivity</span>

</pre>
</div>
</div>
</div>


<div id="outline-container-orgf66da64" class="outline-2">
<h2 id="orgf66da64"><span class="section-number-2">5.</span> Lecture 8 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-10-28 Fri&gt;</span></span>)</h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li><p>
Prev Homework
int compare(x,y){
-1,0,1
}
</p>

<p>
Set s= HashSet()
s.add(3)
s.add(-3)
compare(3,-3)
//s = [3,-3]
</p>

<p>
int AbsCompare(int x, int y){
  return abs(x).compare(abs(y))
}
Set s' = HashSet((x,y) -&gt; AbsCompare)
s.add(3)
s.add(-3)
//s = [3]
</p></li>

<li><p>
Generics (templates)
</p>

<p>
Generics and the <b>subtype polymorphism</b> (thing that we did last lecture)
</p>
<ul class="org-ul">
<li>Generics gives a compile time error</li>
<li>subtype polymorphism gives runtime error</li>
</ul>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Before Java 5</span>
<span style="color: #e45649;">public</span> <span style="color: #e45649;">interface</span> <span style="color: #986801;">Comparable</span>{
    <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">compareTo</span> (<span style="color: #986801;">Object</span> <span style="color: #6a1868;">o</span>)
}
<span style="color: #986801;">Comparable</span> <span style="color: #6a1868;">c</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">Date</span>();
c.compareTo(<span style="color: #50a14f;">"red"</span>);  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">RUNTIME ERROR</span>

<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Java 5</span>
<span style="color: #e45649;">public</span> <span style="color: #e45649;">interface</span> <span style="color: #986801;">Comparable</span>&lt;<span style="color: #986801;">T</span>&gt;{
    <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">compareTo</span> (<span style="color: #986801;">T</span> <span style="color: #6a1868;">o</span>)
}
<span style="color: #986801;">Comparable</span>&lt;<span style="color: #986801;">Date</span>&gt; <span style="color: #6a1868;">c</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">Date</span>();
c.compareTo(<span style="color: #50a14f;">"red"</span>);  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">COMPILE ERROR</span>
</pre>
</div></li>
</ul>


<ul class="org-ul">
<li>Item 26: don't use Raw Types in New Code
List
List&lt;String&gt;
Listing&lt;T&gt;</li>
</ul>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Now a raw collection type &#8211; don&#8217;t do this</span>
   <span style="color: #e45649;">private</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">Collection</span> <span style="color: #6a1868;">stamps</span> = ; <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Intention: Contains only Stamps</span>
<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Erroneous insertion of coin into stamp collection</span>
   stamps.add(<span style="color: #e45649;">new</span> <span style="color: #986801;">Coin</span>(...));   <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Oops!  We&#8217;re set up for ClassCastException later</span>

<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Parameterized collection type - typesafe </span>
     <span style="color: #e45649;">private</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">Collection</span>&lt;<span style="color: #986801;">Stamp</span>&gt; <span style="color: #6a1868;">stamps</span> = ...;
     stamps.add(<span style="color: #e45649;">new</span> <span style="color: #986801;">Coin</span>(...));  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">result is instead a compile time error, which is good</span>

<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Now a raw iterator type &#8211; don&#8217;t do this!</span>
   <span style="color: #e45649;">for</span> (<span style="color: #986801;">Iterator</span> <span style="color: #6a1868;">I</span> = stamps.iterator(); i.hasNext(); ) {
      <span style="color: #986801;">Stamp</span> <span style="color: #6a1868;">s</span> = (<span style="color: #986801;">Stamp</span>) i.next();       <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">might throw a ClassCastException</span>
       ...<span style="color: #9ca0a4;">//  </span><span style="color: #9ca0a4;">Do something with the stamp</span>
    }
<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">for-each loop over parameterized collection &#8211; typesafe</span>
   <span style="color: #e45649;">for</span> (<span style="color: #986801;">Stamp</span> <span style="color: #6a1868;">s</span>: stamps) {   <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">No (explicit) cast &#8211; same code as above</span>
       ...<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Do something with the stamp</span>
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #986801;">List</span>&lt;<span style="color: #986801;">String</span>&gt; <span style="color: #6a1868;">strings</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">ArrayList</span>&lt;<span style="color: #986801;">String</span>&gt;();
unsafeAdd(strings, <span style="color: #e45649;">new</span> <span style="color: #986801;">Integer</span>(42));
<span style="color: #986801;">String</span> <span style="color: #6a1868;">s</span> = strings.get(0);  <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">can cause error at runtime</span>

 <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">note use of raw types</span>
 <span style="color: #e45649;">private</span> <span style="color: #e45649;">static</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">unsafeAdd</span>(<span style="color: #986801;">List</span> <span style="color: #6a1868;">list</span>, <span style="color: #986801;">Object</span> <span style="color: #6a1868;">o</span>) {
    list.add(o);
 }

<span style="color: #e45649;">private</span> <span style="color: #e45649;">static</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">unsafeAdd</span>( <span style="color: #986801;">List</span>&lt;<span style="color: #986801;">Object</span>&gt; <span style="color: #6a1868;">list</span>, <span style="color: #986801;">Object</span> <span style="color: #6a1868;">o</span>) {
    list.add(o);
}
</pre>
</div>

<p>
Item 27: Eliminate Unchecked Warnings
</p>
<div class="org-src-container">
<pre class="src src-java">  <span style="color: #986801;">Set</span>&lt;<span style="color: #986801;">Lark</span>&gt; <span style="color: #6a1868;">exaltation</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">HashSet</span>();              <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">warning</span>
  <span style="color: #986801;">Set</span>&lt;<span style="color: #986801;">Lark</span>&gt; <span style="color: #6a1868;">exaltation</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">HashSet</span>&lt;<span style="color: #986801;">Lark</span>&gt;();              <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">no warning</span>


  <span style="color: #e45649;">public</span> &lt;<span style="color: #986801;">T</span>&gt; <span style="color: #986801;">T</span>[] <span style="color: #a626a4;">toArray</span> (<span style="color: #986801;">T</span>[] <span style="color: #6a1868;">a</span>) {
    <span style="color: #e45649;">if</span> (a.length &lt; <span style="color: #986801;">size</span>)
       <span style="color: #b751b6;">@SuppressWarnings</span>(&#8220;unchecked&#8221;)
           <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">copyOf copyes Objects so it would warn that Objects[] is not the same as T[]</span>
       T[]results = (<span style="color: #986801;">T</span>[]) Arrays.copyOf(elements, size, a.getClass());
       <span style="color: #e45649;">return</span> results

    System.arraycopy(elements, 0, a, 0, size);
    <span style="color: #e45649;">if</span> (a.length &gt; size)  a[size] = <span style="color: #b751b6;">null</span>;
    <span style="color: #e45649;">return</span> a; }

<span style="color: #9ca0a4;">/*</span>
<span style="color: #9ca0a4;">  ArrayList.java:305: warning [unchecked] unchecked cast</span>
<span style="color: #9ca0a4;">found   : Object[], required T[]    </span>
<span style="color: #9ca0a4;">    return (T[]) Arrays.copyOf(elements, size, a.getClass());</span>
<span style="color: #9ca0a4;"> */</span>

</pre>
</div>

<p>
Item 28: Prefer Lists over Arrays
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Fails at runtime</span>
<span style="color: #986801;">Object</span>[] <span style="color: #6a1868;">objectArray</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">Long</span>[1];
objectArray[0] = &#8220;I don&#8217;t fit in<span style="color: #4078f2; font-weight: bold;">!</span>&#8221;;           <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Throws ArrayStoreException</span>

<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Won&#8217;t compile</span>
<span style="color: #986801;">List</span>&lt;<span style="color: #986801;">Object</span>&gt; <span style="color: #6a1868;">o1</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">ArrayList</span>&lt;<span style="color: #986801;">Long</span>&gt;();
o1.add(&#8220;I don&#8217;t fit in<span style="color: #4078f2; font-weight: bold;">!</span>&#8221;);                           <span style="color: #9ca0a4;">//  </span><span style="color: #9ca0a4;">Incompatible types</span>
</pre>
</div>


<p>
covariant vs invariance (not related to loop invariant)
</p>
<ul class="org-ul">
<li>Arrays is covariance: Arrays enforces checking at <b>runtime</b></li>

<li>List is invriance :  List enforces checking at <b>compile time</b></li>
</ul>



<div class="org-src-container">
<pre class="src src-java"><span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Chooser - a class badly in need of generics!</span>
<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Bloch 3rd edition, Chapter 5, Item 28:  Prefer lists to arrays</span>

<span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Chooser</span> {
    <span style="color: #e45649;">private</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">Object</span>[] <span style="color: #6a1868;">choiceArray</span>;

    <span style="color: #e45649;">public</span> Chooser (<span style="color: #986801;">Collection</span> <span style="color: #6a1868;">choices</span>) {
        choiceArray = choices.toArray();
    }

    <span style="color: #e45649;">public</span> <span style="color: #986801;">Object</span> <span style="color: #a626a4;">choose</span>() {
        <span style="color: #986801;">Random</span> <span style="color: #6a1868;">rnd</span> = ThreadLocalRandom.current();
        <span style="color: #e45649;">return</span> choiceArray [rnd.nextInt(choiceArray.length)];
    }
}
</pre>
</div>



<ul class="org-ul">
<li>Generify</li>
</ul>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Chooser</span>&lt;<span style="color: #986801;">T</span>&gt; {
    <span style="color: #e45649;">private</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">T</span>[] <span style="color: #6a1868;">choiceArray</span>;

    <span style="color: #e45649;">public</span> Chooser (<span style="color: #986801;">Collection</span>&lt;<span style="color: #986801;">T</span>&gt; <span style="color: #6a1868;">choices</span>) {
        choiceArray = choices.toArray(); <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">compiler errors: cannot convert to T,</span>

        <span style="color: #b751b6;">@supresswarning</span>..
        choiceArray = (<span style="color: #986801;">T</span>[]) choices.toArray();  <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">cast to (T[]),  got a warning, supress it because we know it is safe because choiceArray is of type T</span>
    }

    <span style="color: #e45649;">public</span> <span style="color: #986801;">T</span> <span style="color: #a626a4;">choose</span>() { 
        <span style="color: #986801;">Random</span> <span style="color: #6a1868;">rnd</span> = ThreadLocalRandom.current();
        <span style="color: #e45649;">return</span> choiceArray [rnd.nextInt(choiceArray.length)];
</pre>
</div>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Chooser</span> {
    <span style="color: #e45649;">private</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">List</span>&lt;<span style="color: #986801;">T</span>&gt; <span style="color: #6a1868;">choiceArray</span>;

    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">RepInv: choicearray is not Null and not empty</span>

    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">POST: @throw IAE if choices is empty</span>
    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">POST: @throw NPE if choice contains null</span>
    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">Post: create a chooser with choices</span>
    <span style="color: #e45649;">public</span> Chooser (<span style="color: #986801;">Collection</span>&lt;<span style="color: #986801;">T</span>&gt; <span style="color: #6a1868;">choices</span>) {
        <span style="color: #e45649;">if</span> (choices.size() == 0)  <span style="color: #e45649;">throw</span> <span style="color: #e45649;">new</span> <span style="color: #986801;">IllegalArgumentException</span>(); <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">ADD</span>
        <span style="color: #e45649;">if</span> (choices.contains(<span style="color: #b751b6;">null</span>)) <span style="color: #e45649;">throw</span> <span style="color: #e45649;">new</span> <span style="color: #986801;">NullPointerExeption</span>();<span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">ADD</span>
        choiceArray = <span style="color: #e45649;">new</span> <span style="color: #986801;">ArrayList</span>&lt;&gt;();
    }

    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">POST: @throws ISE if empty, else return random choice</span>
    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">CHECK: choiceArray never changed so RI maintained,</span>
    <span style="color: #e45649;">public</span> <span style="color: #986801;">Object</span> <span style="color: #a626a4;">choose</span>() {
        <span style="color: #e45649;">if</span>(choiceList.size() == 0) <span style="color: #e45649;">throw</span> IllegalStateException(); <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">NEW CODE</span>
        <span style="color: #986801;">Random</span> <span style="color: #6a1868;">rnd</span> = ThreadLocalRandom.current();
        <span style="color: #e45649;">return</span> choiceArray [rnd.nextInt(choiceArray.length)];
    }

    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">Post @throw NPE if choice is null</span>
    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">POST: add choice to this</span>
    <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">addChoice</span>(<span style="color: #986801;">T</span> <span style="color: #6a1868;">choice</span>){
        <span style="color: #e45649;">if</span> (choice == <span style="color: #b751b6;">null</span>) <span style="color: #e45649;">throw</span> <span style="color: #e45649;">new</span> <span style="color: #986801;">NullPointerException</span>();
        choiceList.add(choice);
    }
}
</pre>
</div>


<ul class="org-ul">
<li><p>
Item 29 : Prefer Generic Types
</p>

<p>
private Object[] elements -&gt;  private T[] elements  -&gt; private List&lt;E&gt; elements
</p></li>
</ul>


<ul class="org-ul">
<li>Item 30: Prefer Generic Methods</li>
</ul>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Uses raw types &#8211; unacceptable! (Item 23)</span>
<span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #986801;">Set</span> <span style="color: #a626a4;">union</span> (<span style="color: #986801;">Set</span> <span style="color: #6a1868;">s1</span>, <span style="color: #986801;">Set</span> <span style="color: #6a1868;">s2</span>)  {  
   <span style="color: #986801;">Set</span> <span style="color: #6a1868;">result</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">HashSet</span>(s1);              <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Generates a warning              </span>
   result.addAll(s2);                                 <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Generates a warning</span>
   <span style="color: #e45649;">return</span> result;
}


<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Generic method </span>
   <span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> &lt;<span style="color: #986801;">E</span>&gt; <span style="color: #986801;">Set</span> &lt;<span style="color: #986801;">E</span>&gt; <span style="color: #a626a4;">union</span> (<span style="color: #986801;">Set</span> &lt;<span style="color: #986801;">E</span>&gt; <span style="color: #6a1868;">s1</span>, <span style="color: #986801;">Set</span> &lt;<span style="color: #986801;">E</span>&gt; <span style="color: #6a1868;">s2</span>)  {
       <span style="color: #986801;">Set</span> &lt;<span style="color: #986801;">E</span>&gt; <span style="color: #6a1868;">result</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">HashSet</span> &lt;<span style="color: #986801;">E</span>&gt; (s1);              
       result.addAll(s2);                                 
       <span style="color: #e45649;">return</span> result;
}

</pre>
</div>
</div>
</div>


<div id="outline-container-org0ff49d5" class="outline-2">
<h2 id="org0ff49d5"><span class="section-number-2">6.</span> Lecture 7 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-10-21 Fri&gt;</span></span>)</h2>
<div class="outline-text-2" id="text-6">
<ul class="org-ul">
<li>Previous Quiz  on Repr Inv</li>
</ul>

<p>
Suppose <code>C</code> is an abstract data type that has two <code>String</code> fields:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #e45649;">class</span> <span style="color: #986801;">C</span> {
    <span style="color: #e45649;">private</span> <span style="color: #986801;">String</span> <span style="color: #6a1868;">s</span>;
    <span style="color: #e45649;">private</span> <span style="color: #986801;">String</span> <span style="color: #6a1868;">t</span>;
    ...
}
</pre>
</div>

<p>
Assuming you don’t know anything about C, which of the following might be statements in a rep invariant for C?
</p>

<p>
s contains only letters
s.length() == t.length()
s represents a set of characters
s is the reverse of t
s+t  
</p>


<ul class="org-ul">
<li>Recap
<ul class="org-ul">
<li>Liskov's Principle of Substitution</li>
</ul></li>
</ul>


<ul class="org-ul">
<li>Polymorphic Abstractions; Lambda's</li>

<li>Int sum (Int a, Int b) {&#x2026;.}</li>
<li>Double sum2 (Double a, Double b) {&#x2026;}</li>
</ul>
<p>
&#x2026;
</p>

<p>
Number
 /   \
Int Double 
</p>

<p>
Number sum (Number a, Number b) &#x2026;
</p>

<p>
Object sum (Object a, Object b) ..
</p>


<ul class="org-ul">
<li>Polymorphic data type
<ul class="org-ul">
<li>Iterator</li>
</ul></li>
</ul>


<ul class="org-ul">
<li>Equality can be problematic</li>
</ul>

<pre class="example">
Set s = new HashSet();
Vector x = new Vector();
s.insert(x)
Vector y = new Vector();

x.isEqual(y) // True

s.insert(y) ; // at this point,  s has 1 element
s.isIn(x)  ; // True
s.isIn(y)  ; // True
x.insert(3)
s.isIn(y)  ; // No
</pre>

<ul class="org-ul">
<li>because the way HashSet implements insert and equality
<ul class="org-ul">
<li>change how HashSet implements insert/equality</li>
</ul></li>

<li>mutable data
<ul class="org-ul">
<li>Sol: change to immutable data</li>
</ul></li>
</ul>


<ul class="org-ul">
<li><p>
Comparator and Comparable
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #e45649;">class</span> <span style="color: #986801;">Person</span> <span style="color: #e45649;">implements</span> <span style="color: #986801;">Comparable</span>{
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">age</span>;
    <span style="color: #986801;">String</span> <span style="color: #6a1868;">name</span>;
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">years_of_experiences</span>;

    <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">compareTo</span>(<span style="color: #986801;">Person</span> <span style="color: #6a1868;">p</span>){
        age.compare(p.age);
    }
}
<span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">pre-planning</span>


<span style="color: #e45649;">class</span> <span style="color: #986801;">NamePerson</span> <span style="color: #e45649;">implements</span> <span style="color: #986801;">Comparator</span>{
    <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">compare</span> (<span style="color: #986801;">Person</span> <span style="color: #6a1868;">p1</span>, <span style="color: #986801;">Person</span> <span style="color: #6a1868;">p2</span>){
        <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">compare name</span>
    }
}
Collections.sort(collection_of_person, <span style="color: #e45649;">new</span> <span style="color: #986801;">NamePerson</span>())
<span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">post-planning    </span>

</pre>
</div></li>
</ul>


<ul class="org-ul">
<li><p>
Lambda (Bloch 7-Item 42)
</p>

<p>
Turing Machine  == Lambda Calculus
</p></li>
</ul>


<div class="org-src-container">
<pre class="src src-java">  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">class SortbyLength implements Comparator{</span>
  <span style="color: #9ca0a4;">//     </span><span style="color: #9ca0a4;">...</span>
  <span style="color: #9ca0a4;">//     </span><span style="color: #9ca0a4;">}</span>
  Collections.sort(<span style="color: #986801;">words</span>, <span style="color: #e45649;">new</span> <span style="color: #986801;">Comparator</span>&lt;<span style="color: #986801;">String</span>&gt;() {
      <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">compare</span>(<span style="color: #986801;">String</span> <span style="color: #6a1868;">s1</span>, <span style="color: #986801;">String</span> <span style="color: #6a1868;">s2</span>) {
          <span style="color: #e45649;">return</span> Integer.compare(s1.length(), s2.length());
      }
  });
  <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">very verbose</span>

Collections.sort(words,
                 (s1, s2) -&gt; Integer.compare(s1.length(), s2.length()));



</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">mylist</span> = [x*2 <span style="color: #e45649;">for</span> x <span style="color: #e45649;">in</span> mylist]
<span style="color: #6a1868;">mylist</span> = <span style="color: #a626a4;">map</span>(mylist, <span style="color: #e45649;">lambda</span> x: x*x)    
</pre>
</div>



<p>
In-class 9
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Person</span> {

    <span style="color: #e45649;">public</span> <span style="color: #e45649;">enum</span> <span style="color: #986801;">Sex</span> {
        <span style="color: #6a1868;">MALE</span>, <span style="color: #6a1868;">FEMALE</span>
    }
    <span style="color: #986801;">String</span> <span style="color: #6a1868;">name</span>;
    <span style="color: #986801;">Sex</span> <span style="color: #6a1868;">gender</span>;
    <span style="color: #986801;">String</span> <span style="color: #6a1868;">emailAddress</span>;
    <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">getAge</span>() {
        <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">...</span>
    }
    <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">printPerson</span>() {
        <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">...</span>
    }
}
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="org3ba2398"></a>Approach 1: Create Methods That Search for Members That Match One Characteristic.<br />
<div class="outline-text-5" id="text-6-0-0-1">
<p>
One simplistic approach is to create several methods; each method searches for members that match one characteristic, such as gender or age. <b>Create a method that prints members that are older than a specified age</b>.
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">findPersonOlderThan</span>(<span style="color: #986801;">List</span>&lt;<span style="color: #986801;">Person</span>&gt; <span style="color: #6a1868;">listOfPerson</span>, <span style="color: #986801;">int</span> <span style="color: #6a1868;">age</span>) {
    <span style="color: #e45649;">for</span> (<span style="color: #986801;">Person</span> <span style="color: #6a1868;">p</span> : listOfPerson) {
        <span style="color: #e45649;">if</span> (p.getAge() &gt;= age) p.printPerson();
    }
}
</pre>
</div>

<p>
Limitation: This approach can potentially make your application brittle, which is the likelihood of an application not working because of the introduction of updates (such as newer data types). Suppose that you upgrade your application and change the structure of the Person class such that it contains different member variables; perhaps the class records and measures ages with a different data type or algorithm. You would have to rewrite a lot of your API to accommodate this change. In addition, this approach is unnecessarily restrictive; what if you wanted to print members younger than a certain age, for example?
</p>
</div>
</li>

<li><a id="org81e1be7"></a>Approach 2: Create More Generalized Search Methods.<br />
<div class="outline-text-5" id="text-6-0-0-2">
<p>
Create a method is more generic than the one in the previous approach. It prints members within a specified range of ages.
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">findPersonOlderThan</span>(<span style="color: #986801;">List</span>&lt;<span style="color: #986801;">Person</span>&gt; <span style="color: #6a1868;">listOfPerson</span>, <span style="color: #986801;">int</span> <span style="color: #6a1868;">lower</span>, <span style="color: #986801;">upper</span>) {
        <span style="color: #e45649;">for</span> (<span style="color: #986801;">Person</span> <span style="color: #6a1868;">p</span> : listOfPerson) {
                <span style="color: #e45649;">if</span> (p.getAge() &gt;= lower &amp;&amp; p.getAge() &lt;= upper) p.printPerson();
        }
}
</pre>
</div>

<p>
Limitation: What if you want to print members of a specified sex, or a combination of a specified gender and age range? What if you decide to change the Person class and add other attributes such as relationship status or geographical location? Although this method is more generic, trying to create a separate method for each possible search query can still lead to brittle code. You can instead separate the code that specifies the criteria for which you want to search in a different class.
</p>
</div>
</li>

<li><a id="orge3e91bb"></a>Approach 3: Specify Search Criteria Code in a Local Class<br />
<div class="outline-text-5" id="text-6-0-0-3">
<p>
Instead of writing filtering functions, use a new interface and class for each search you plan. Use the following filtering criteria for example:  filters members that are eligible for Selective Service in the United States: those who are male and between the ages of 18 and 25:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">printPersons</span>(<span style="color: #986801;">List</span>&lt;<span style="color: #986801;">Person</span>&gt; <span style="color: #6a1868;">roster</span>, <span style="color: #986801;">CheckPerson</span> <span style="color: #6a1868;">tester</span>) {
         <span style="color: #e45649;">for</span> (<span style="color: #986801;">Person</span> <span style="color: #6a1868;">p</span> : roster) {
             <span style="color: #e45649;">if</span> (tester.test(p)) {
                 p.printPerson();
             }
         }
     }
 <span style="color: #e45649;">interface</span> <span style="color: #986801;">CheckPerson</span> {
     <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">test</span>(<span style="color: #986801;">Person</span> <span style="color: #6a1868;">p</span>);
 }
 <span style="color: #e45649;">class</span> <span style="color: #986801;">CheckPersonEligibleForSelectiveService</span> <span style="color: #e45649;">implements</span> <span style="color: #986801;">CheckPerson</span> {
     <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">test</span>(<span style="color: #986801;">Person</span> <span style="color: #6a1868;">p</span>) {
         <span style="color: #e45649;">return</span> p.gender == <span style="color: #b751b6;">Person</span>.<span style="color: #b751b6;">Sex</span>.MALE &amp;&amp;
             p.getAge() &gt;= 18 &amp;&amp;
             p.getAge() &lt;= 25;
     }
 }

</pre>
</div>


<p>
Limtation: Although this approach is less brittle—you don't have to rewrite methods if you change the structure of the Person—you still have additional code: a new interface and a local class for each search you plan to perform in your application. Because one of the class implements an interface, you can use an anonymous class instead of a local class and bypass the need to declare a new class for each search.
</p>
</div>
</li>

<li><a id="org76ef702"></a>Approach 4: Specify Search Criteria Code in an Anonymous Class<br />
<div class="outline-text-5" id="text-6-0-0-4">
<p>
Use an anonymous class to address the issue with Approach 3.
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">printPersons</span>(<span style="color: #986801;">List</span>&lt;<span style="color: #986801;">Person</span>&gt; <span style="color: #6a1868;">roster</span>,
                              <span style="color: #e45649;">new</span> <span style="color: #986801;">CheckPerson</span>{
                                <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">test</span>(<span style="color: #986801;">Person</span> <span style="color: #6a1868;">p</span>){
                                    <span style="color: #e45649;">return</span> p.gender == <span style="color: #b751b6;">Person</span>.<span style="color: #b751b6;">Sex</span>.MALE &amp;&amp;
                                        p.getAge() &gt;= 18 &amp;&amp;
                                        p.getAge() &lt;= 25;
                                  }
                                }
                              )
</pre>
</div>

<p>
Limtation: This approach reduces the amount of code required because you don't have to create a new class for each search that you want to perform. However, the syntax of anonymous classes is bulky considering that the CheckPerson interface contains only one method. In this case, you can use a lambda expression instead of an anonymous class, as described in the next section.
</p>
</div>
</li>

<li><a id="org70083d8"></a>Approach 5: Specify Search Criteria Code with a Lambda Expression<br />
<div class="outline-text-5" id="text-6-0-0-5">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">printPersons</span>(<span style="color: #986801;">List</span>&lt;<span style="color: #986801;">Person</span>&gt; <span style="color: #6a1868;">roster</span>,
                              (Person <span style="color: #986801;">p</span>) -&gt; p.getGender() == <span style="color: #b751b6;">Person</span>.<span style="color: #b751b6;">Sex</span>.MALE &amp;&amp;
                                p.getAge() &gt;= 18 &amp;&amp;
                                p.getAge() &lt;= 25
                              )
</pre>
</div>

<p>
Use lambda expression to address the limitation the previous approach.
</p>
</div>
</li>
</ol>
</div>



<div id="outline-container-orgc1cf1eb" class="outline-2">
<h2 id="orgc1cf1eb"><span class="section-number-2">7.</span> Lecture 6 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-10-07 Fri&gt;</span></span>)</h2>
<div class="outline-text-2" id="text-7">
<p>
Recap
</p>
<ul class="org-ul">
<li>ADT
<ul class="org-ul">
<li>Repr invs
<ul class="org-ul">
<li>invariant:  something that is always true
<ul class="org-ul">
<li>Binary tree repr inv:  has 2 nodes</li>
</ul></li>
</ul></li>
<li>Abstract Function
<ul class="org-ul">
<li>toString()</li>
<li>polynomial:   5x*2 + 10  (array, &#x2026; )</li>
</ul></li>
</ul></li>

<li>Iterator
<ul class="org-ul">
<li>hasNext(); next(); remove()</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #986801;">List</span>&lt;<span style="color: #986801;">String</span>&gt; <span style="color: #6a1868;">list</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">List</span>&lt;&gt;([<span style="color: #50a14f;">"b"</span>, <span style="color: #50a14f;">"c"</span>, <span style="color: #50a14f;">"d"</span>]);
<span style="color: #986801;">Iterator</span>&lt;<span style="color: #986801;">String</span>&gt; <span style="color: #6a1868;">itr</span> = list.iterator(); <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">list = [b,c,d],  itr=[b,c,d]</span>
itr.hasNext() <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">return True</span>
itr.next();  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">return b ,  list = [b,c,d], itr=[c,d]</span>
itr.next(); <span style="color: #9ca0a4;">//  </span><span style="color: #9ca0a4;">return c,   list = [b,c,d], itr=[d]</span>
itr.hasNext() <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">return True  </span>
itr.next(); <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">return d,    list = [b,c,d], itr=[]</span>
itr.hasNext() <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">return False</span>
itr.next(); <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">raise NSEE ,  list = [b,c,d], itr=[]  </span>

<span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">prev()   hasPrev()</span>
<span style="color: #986801;">List</span>&lt;<span style="color: #986801;">String</span>&gt; <span style="color: #6a1868;">list</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">List</span>&lt;&gt;([<span style="color: #50a14f;">"b"</span>, <span style="color: #50a14f;">"c"</span>, <span style="color: #50a14f;">"d"</span>]);
<span style="color: #986801;">Iterator</span>&lt;<span style="color: #986801;">String</span>&gt; <span style="color: #6a1868;">itr</span> = list.iterator(); <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">list = [b,c,d],  itrN=[b,c,d] iterY=[]</span>
itr.next() ;  <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">return B, itrN=[c,d],  iterY=[b]</span>
itr.next();  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">return C, itrN=[d], iterY =[c,b]</span>
itr.prev() ; <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">return C, iterN=[c,d], iterY=[b]</span>
itr.prev() ; <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">return B, iterN=[b,c,d], iterY=[]</span>
iter.hasPrev(); <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">return False</span>
iter.prev() ; <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">raise NSEE</span>

<span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">remove()</span>
<span style="color: #986801;">List</span>&lt;<span style="color: #986801;">String</span>&gt; <span style="color: #6a1868;">list</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">List</span>&lt;&gt;([<span style="color: #50a14f;">"b"</span>, <span style="color: #50a14f;">"c"</span>, <span style="color: #50a14f;">"d"</span>]);
<span style="color: #986801;">Iterator</span>&lt;<span style="color: #986801;">String</span>&gt; <span style="color: #6a1868;">itr</span> = list.iterator(); <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">list = [b,c,d],  itrN=[b,c,d] iterY=[], nextCalled=False</span>
itr.next();  <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">return B, itrN=[c,d], list =[b,c,d ], nextCalled=True</span>
itr.next();  <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">return C, itrN=[d], list=[b,c,d],  nextCalled=True</span>
itr.remove(); <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">itrN=[d], list=[b,d], nextCalled=False</span>
itr.remove(); <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">raise ISE</span>
</pre>
</div>



<ul class="org-ul">
<li>Immutable vulnerabilities
<ul class="org-ul">
<li>lots of benefits for immutable objects</li>
<li>but if we do it wrong, and it is not immutable</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Broken &#8220;immutable&#8221; time period class</span>
<span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Period</span> {               <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Question 3</span>
    <span style="color: #e45649;">private</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">Date</span> <span style="color: #6a1868;">start</span>;
    <span style="color: #e45649;">private</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">Date</span> <span style="color: #6a1868;">end</span>;
    <span style="color: #84888b; font-style: italic;">/**</span>
<span style="color: #84888b; font-style: italic;">     * </span><span style="color: #b751b6; font-style: italic;">@param</span><span style="color: #84888b; font-style: italic;"> start the beginning of the period</span>
<span style="color: #84888b; font-style: italic;">     * </span><span style="color: #b751b6; font-style: italic;">@param</span><span style="color: #84888b; font-style: italic;"> end the end of the period; must not precede start</span>
<span style="color: #84888b; font-style: italic;">     * </span><span style="color: #b751b6; font-style: italic;">@throws</span><span style="color: #84888b; font-style: italic;"> IAE if start is after end</span>
<span style="color: #84888b; font-style: italic;">     * </span><span style="color: #b751b6; font-style: italic;">@throws</span><span style="color: #84888b; font-style: italic;"> NPE if start or end null</span>
<span style="color: #84888b; font-style: italic;">     */</span>

    <span style="color: #e45649;">public</span> Period (<span style="color: #986801;">Date</span> <span style="color: #6a1868;">start</span>, <span style="color: #986801;">Date</span> <span style="color: #6a1868;">end</span>) {
        <span style="color: #e45649;">if</span> (start.compareTo(end) &gt; 0) <span style="color: #e45649;">throw</span> <span style="color: #e45649;">new</span> <span style="color: #986801;">IAE</span>();
        <span style="color: #e45649;">this</span>.start = start; <span style="color: #e45649;">this</span>.end = end;  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Question 1</span>
    }
    <span style="color: #e45649;">public</span> <span style="color: #986801;">Date</span> <span style="color: #a626a4;">start</span>() { <span style="color: #e45649;">return</span> start;}    <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Question 2</span>
    <span style="color: #e45649;">public</span> <span style="color: #986801;">Date</span> <span style="color: #a626a4;">end</span>()   { <span style="color: #e45649;">return</span> end;}      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Question 2</span>
}


<span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">MyClass</span> <span style="color: #e45649;">extends</span> <span style="color: #986801;">Period</span>{
    <span style="color: #e45649;">private</span> <span style="color: #986801;">Date</span> <span style="color: #6a1868;">myDate</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">Date</span>(0); <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">bad, problematic value</span>

    <span style="color: #b751b6;">@override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">Date</span> <span style="color: #a626a4;">start</span>(){
        <span style="color: #e45649;">if</span> (itsTime()){
            <span style="color: #e45649;">return</span> myDate;   <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">returning some(bad)thing I define </span>
        }
        <span style="color: #e45649;">return</span> <span style="color: #e45649;">super</span>.start()
    }

  <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">LoanProvider</span>{
      <span style="color: #986801;">Period</span> <span style="color: #6a1868;">p</span>;
      <span style="color: #e45649;">public</span> LoanProvider(<span style="color: #986801;">Period</span> <span style="color: #6a1868;">p</span>, <span style="color: #986801;">other</span> <span style="color: #6a1868;">stuff</span>){
          <span style="color: #e45649;">this</span>.p = p; <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">no defense copy because Period is immutable</span>

        <span style="color: #e45649;">this</span>.p.start()
      }
  }

<span style="color: #986801;">Period</span> <span style="color: #6a1868;">m</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">myClass</span>(); <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">instead of the start define in class Period,  this uses start method from my class which uses myDate</span>
<span style="color: #986801;">LoanProvider</span> <span style="color: #6a1868;">lp</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">LoanProvider</span>(m, ..) <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">will have start from my class</span>


</pre>
</div>

<ul class="org-ul">
<li>LSP:
Language server protocol (Python, Java, C#, Rust &#x2026;)</li>
</ul>


<ul class="org-ul">
<li><p>
Liskov Substitution Principle (LSP)
</p>
<ul class="org-ul">
<li>if B is a subtype of A (B inherits A  or B extends A), then whenever you use an object of type A, you should be able to use an object of type B instead.</li>

<li>class Mammal  // A</li>
<li>class Human extends Mammal // Human(B) is a subtype of Mammal(A)
<ul class="org-ul">
<li>speak()</li>
</ul></li>

<li>class Whale extends Mammal
<ul class="org-ul">
<li>echo_location()</li>
</ul></li>
</ul>

<p>
MammalObj1.grow_hair()
HumanObj2.grow_hair()
WhaleMamal.grow_hair()
</p>

<p>
//reverse of LSP is not correct
Whale.echo_location()
Mamal.echo_location()
</p></li>
</ul>


<ul class="org-ul">
<li><p>
if B is a subtype of A, then its specification must be at least stronger than A (B's behaviors is a SUPERSET of A's behaviors)
</p>

<p>
A has a method m 
B overrides m  :  m'
method m' has to be at least as precise as m
</p>

<p>
m: pre(takes in an integer)   post (returns an integer)
m':  pre'(anything)     post' (return 3)
</p>

<p>
want m' to be at least as precise as m
post' should be at least as strong
pre' should at most as weak
</p></li>
</ul>


<div class="org-src-container">
<pre class="src src-java"><span style="color: #e45649;">class</span> <span style="color: #986801;">A</span>:
    <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> reduce (<span style="color: #986801;">Reducer</span> <span style="color: #6a1868;">x</span>)
        <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Effects: if x is null throw NPE</span>
        <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">else if x is not appropriate for this throw IAE</span>
        <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">else reduce this by x</span>
 <span style="color: #e45649;">class</span> B:
     <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> reduce (<span style="color: #986801;">Reducer</span> <span style="color: #6a1868;">x</span>)
        <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Requires: x is not null</span>

        <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Effects: if x is not appropriate for this throw IAE</span>
        <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">else reduce this by x</span>
 <span style="color: #e45649;">class</span> C:
     <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> reduce (<span style="color: #986801;">Reducer</span> <span style="color: #6a1868;">x</span>)
        <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Effects: if x is null return (normally) with no change to this</span>
        <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">else if x is not appropriate for this throw IAE</span>
        <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">else reduce this by x</span>
</pre>
</div>

<p>
B extends A.
Precondition Part:  not satisfied LSP because B has stronger pre than A
Postcondition Part:  not statisfied because A has stronger post
</p>
<hr />
<p>
C extends A.   
Precondition Part: C's pre &lt;= A's pre ,  satisfied 
Postcondition Part: C's post &gt;= A's post, 
</p>
<ul class="org-ul">
<li>A's post is stronger than C's post because NPE is preferred:  LSP is violated</li>
<li>C's post is stronger than A's post because normal return is preferred: LSP is satisfied</li>
<li>A and C's behaviors are not comparable :  LSP is violated</li>
</ul>

<hr />
<p>
A extends B.
Precondition Part:  A has no pre and therefore is weaker than B &#x2013; satisfies LSP     
Postcondition Part:
</p>
<ul class="org-ul">
<li>Since A is stronger because it handles null (throwing NPE), but B does not &#x2013; satisfies LSP</li>
<li>If taken into account the precond of B, which disallow x being null, then the posts of A and B are the same , satisfies LSP</li>
</ul>

<hr />
<p>
C extends B.
</p>

<ul class="org-ul">
<li>preconds: C is weaker than B - satisfies LSP</li>
<li>postconds:
<ul class="org-ul">
<li>since C can handle null input, C is stronger than B</li>
<li>since for non-null cases as required by the pre of B, both C and B hae same</li>
</ul></li>
</ul>

<hr />
<p>
A extends C.
Precondition Part:
Postcondition Part:
</p>
<hr />
</div>
</div>




<div id="outline-container-org772905b" class="outline-2">
<h2 id="org772905b"><span class="section-number-2">8.</span> Lecture 5 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-09-30 Fri&gt;</span></span>)</h2>
<div class="outline-text-2" id="text-8">
<pre class="example">
{y=7} x:=3 {x + y = 10)   y=7 is the weakest precondition

{y=7 AND x= 100} x:=3 {x + y = 10)


WP(x := E, Q) = Q[x/E]
WP(x:=3 , x +y = 10)  
=  x +y = 10[x/3]
=  3 +y = 10
=  y = 7

WP(z:=3, z + y &gt; 0)
= 3 +y &gt; 0
{3+y &gt;0} z := 3 {z + y &gt;0}



WP([x:=x+1; y:=y*x], y = 2*z)
= WP(x:=x+1, WP(y:=y*x, y=2*z))
= WP(x:=x+1,  y*x = 2*z)
= y*(x+1)=2*z

WP(if b then S1 else S2, Q)  =  (b =&gt; WP(S1,Q))  &amp;  (!b =&gt; WP(S2, Q))

WP(if x &gt; 0 then y := x + 2  else y := y + 1,  y &gt; x)
x &gt; 0 =&gt; WP(y:=x+2, y&gt;x)  &amp; x&lt;=0 =&gt; WP(y:=y+1, y&gt;x)
x &gt; 0 =&gt; x+2 &gt; x    &amp; x&lt;=0 =&gt; WP(y:=y+1, y&gt;x)
x &gt; 0 =&gt; True       &amp; x&lt;=0 =&gt; WP(y:=y+1, y&gt;x)
True                &amp; x&lt;=0 =&gt; WP(y:=y+1, y&gt;x)
x&lt;=0 =&gt; WP(y:=y+1, y&gt;x)
x&lt;=0 =&gt; y+1 &gt; x


// {N &gt;= 0}  #P
i = 0;
while (i &lt; N){
    i = i + 1;
}
//{i == N}  #Q


WP([i:=0; while(i&lt;N) do i:=i+1], i=N)
WP(i:=0,  WP(while(i&lt;N) do i:=i+1, i=N))

WP(while [I] b do S, Q) =  I &amp; (I &amp; b =&gt; WP(S,I) &amp; (I &amp; !b)  =&gt; Q)
let I =   *i&lt;=N*

WP(while(i&lt;N) do i:=i+1, i=N)
= i&lt;=N  &amp;  i&lt;N =&gt; WP( i:=i+1, i&lt;=N)  &amp; (i&lt;=N &amp; i&gt;=N)  =&gt; i=N
= i&lt;=N  &amp;  i&lt;N =&gt; i+1 &lt;= N    &amp;  i=N  =&gt; i=N
= i&lt;=N  &amp;  i&lt;N =&gt; i+1 &lt;= N    &amp;  True
= i&lt;=N  &amp;  i&lt;N =&gt; i+1 &lt;= N

= i&lt;=N  &amp;  i&lt;=N-1 =&gt; i+1 &lt;= N
= i&lt;=N  &amp;  i&lt;=N-1 =&gt; i =N -1
= i&lt;=N  &amp;  True
= i&lt;=N  

WP(i:=0, WP(while(i&lt;N) do i:=i+1, i=N))
WP(i:=0, i&lt;=N)
= 0&lt;=N

verification condition (vc)
P =&gt; WP([i:=0; while(i&lt;N) do i:=i+1], i=N,Q)
P =&gt; 0&lt;=N
N &gt;= 0   =&gt;  0 &lt;= N
True  (i.e.,   program is correct wrt to P and Q)

P1 =&gt; 0&lt;=N
N &gt;= 1   =&gt;  0&lt;=N   
True  (i.e.,   program is correct wrt to P and Q)

P2 =&gt; 0&lt;=N
True =&gt; 0&lt;=N
0&lt;=N



--
let I = true
WP(while [I] b do S, Q) =  I &amp; (I &amp; b =&gt; WP(S,I) &amp; (I &amp; !b)  =&gt; Q)
WP(while(i&lt;N) do i:=i+1, i=N)
= True &amp;    True &amp; i&lt;N =&gt; WP(i:=i+1, True) &amp;    (True &amp; i&gt;=N)  =&gt; i=N
= True &amp;    True &amp; i&lt;N =&gt; True  &amp;    (True &amp; i&gt;=N)  =&gt; i=N
= (True &amp; i&lt;N) =&gt; True    &amp;     (i&gt;=N  =&gt; i=N)
= (i&lt;N =&gt; True)  &amp;   (i&gt;=N  =&gt; i=N)
=     i&gt;=N       &amp;   (i&gt;=N  =&gt; i=N)


WP(i:=0, i&gt;=N   &amp; (i&gt;=N  =&gt; i=N))
0&gt;=N  &amp;  (0&gt;=N  =&gt;  0=N)


VC
P =&gt; 0&gt;=N  &amp;  (0&gt;=N  =&gt;  0=N)
N&gt;=0   =&gt;  0&gt;=N  &amp;  (0&gt;=N  =&gt;  0=N)
Not simplified to True



{True} i:=i+1  {True}

Q[x/E]
True[i/i+1]
True

WP(i:=i+1,  x=10)
x=10[i/i+1]
x=10

{x=10} {i:=i+1} {x=10}



// {N &gt;= 0}   # P
i = 0;
while (i &lt; N){
    i = i + 1;
}

// {N &gt;= 0}   # P
i = 0;
while (1){
    [I]  // 
    if (!(i &lt; N)) break;
    i = i + 1;
}


2. i&lt;=N ... loop inv
3. i&gt;=0  ... loop inv

</pre>
</div>


<div id="outline-container-org7e8c46b" class="outline-3">
<h3 id="org7e8c46b"><span class="section-number-3">8.1.</span> Repr Invariants</h3>
<div class="outline-text-3" id="text-8-1">
<ul class="org-ul">
<li>things that are true about a data structure</li>
<li>binary tree 
<ul class="org-ul">
<li>at most two children</li>
<li>all nodes except root has a parent</li>
</ul></li>

<li>BinTree
<ul class="org-ul">
<li>add(x)</li>
<li></li>
</ul></li>

<li>Set
<ul class="org-ul">
<li>Distinct</li>
</ul></li>

<li>BinarySearchTree
<ul class="org-ul">
<li></li>
</ul></li>
</ul>

<p>
ReprOK()
RepOK()
</p>
</div>
</div>
</div>

<div id="outline-container-orgb547d31" class="outline-2">
<h2 id="orgb547d31"><span class="section-number-2">9.</span> Lecture 4 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-09-16 Fri&gt;</span></span>)</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-orgdb8fe3d" class="outline-3">
<h3 id="orgdb8fe3d"><span class="section-number-3">9.1.</span> No class next Friday</h3>
<div class="outline-text-3" id="text-9-1">
<ul class="org-ul">
<li>will send out details later</li>
</ul>
</div>
</div>

<div id="outline-container-orgdd089b7" class="outline-3">
<h3 id="orgdd089b7"><span class="section-number-3">9.2.</span> Topic: Automatic Verification</h3>
<div class="outline-text-3" id="text-9-2">
<ul class="org-ul">
<li><p>
Logic
</p>

<p>
a =&gt; b   :  !a OR b
</p>

<ul class="org-ul">
<li>there is class next Friday :   False</li>
<li>today is September 16:  True</li>

<li>x &gt; 6 and x &lt; 5  : False  (no value of x would satisfy this)</li>
<li>x &gt; 6  =&gt;  x &gt; 1   :  True</li>
<li>x &gt; 6  and  y = 3   :  False , counterxample(cex) : (x=5 , y=2)</li>
<li>x &gt; 6  <code>&gt;  y = 3   :  False,       cex  : (x=7,  y=4)
    x &lt;</code> 6  or  y = 3</li>
</ul>

<p>
satisfiable:
  f :  satisfiable   if there is some assignment to the values in f that makes f evaluate to True
</p>
<ul class="org-ul">
<li>x &lt;= 6 or y = 3  is satisfiable (e.g.,  x=4, y=4)</li>
<li>x &gt; 6  and  y = 3 is SAT (e.g.,  x =7, y=3)</li>
<li>x &gt; 6  =&gt;  x &gt; 1   is SAT (e.g.,  x=7)</li>
<li>x &gt; 6 and x &lt; 5   is UNSAT</li>
</ul>

<p>
valid (tautology):
  f : valid, if f evaluates to True for <b>every</b> assignment (f is <b>always</b> satisfiable)
</p>
<ul class="org-ul">
<li>x &gt; 6  =&gt;  x &gt; 1   is valid</li>
<li>x = x  is valid</li>
</ul>

<p>
falsification:
 f : is falsification if f elvalues to False for <b>every</b> assignment (f is <b>always</b> unsat)
</p>
<ul class="org-ul">
<li>x &gt; 6 and x &lt; 5</li>
<li>x != x</li>
<li>x = x + 1   (if x = some infinite number, then x = x + 1 would True, so assume x is finite)</li>
</ul></li>
</ul>


<p>
Implication   a =&gt; b   =  !a or b
</p>

<ul class="org-ul">
<li>f =&gt; f      =  Valid    (!f or f)</li>
<li>f =&gt; True   =  Valid    (!f or True)</li>
<li>True =&gt; f   = Not Valid  !True or f  = False or f   =  f</li>
<li>f =&gt; False   =  Not Valid       !f or False   = !f</li>
<li>False =&gt; f  =  Valid      !False or f  =  True or f  = True</li>
</ul>

<p>
Hoare Verification
</p>
<ul class="org-ul">
<li>Tony Hoare: Sir. Hoare, quick sort, verification, &#x2026;</li>
<li>automatic verification that a program S is correct with respect to precondition P and postcondition Q</li>
</ul>


<ul class="org-ul">
<li>Hoare tripple
{P}  S  {Q}
<ul class="org-ul">
<li>Precondition: P</li>
<li>Postcond :  Q</li>
<li>S :   program (statements)</li>
<li>Hoare tripple is valid: if P holds, and the successful execution of S results in Q
<ul class="org-ul">
<li>S is correct with respect to P and Q</li>
</ul></li>
</ul></li>
</ul>




<ul class="org-ul">
<li><p>
Testing   S,   P , Q
</p>

<p>
Goal: given a program S,  {P, Q},  check if S is correct wrt to P, Q
</p>
<ul class="org-ul">
<li>testing: finding some bug:  want to find if there is some (bad) input that satisfy P,  but doesn't satisy Q
<ul class="org-ul">
<li>pros: quick , test it on some finite number of inputs (K,M,B ..)</li>
<li>cons: if the test shows no bug, DOES NOT mean the program really has no bug</li>
</ul></li>

<li>verification: want to show there exist no bad input that &#x2026; 
<ul class="org-ul">
<li>pros: if verify shows no bug,  DOES mean program has bug</li>
<li>cons: runs slowly (have to consider all possible inputs)</li>
</ul></li>
</ul></li>
</ul>


<ul class="org-ul">
<li>medical (surgeries), airplan, weapons, &#x2026;</li>
<li>Hardware design (CPU)</li>
<li>Airbus:  verification to check floating errors do not occur A380 &#x2026;</li>
<li>NASA:  Rovers  (symbolic execution)</li>
<li>Facebook Newsfeed :  verification (currency), Instagram</li>
<li>Amazon AWS :  cloud computing</li>
</ul>


<p>
Examples of Hoare tripples
</p>

<ul class="org-ul">
<li>{True} x := 5  {x=5}  : Valid HT # strongest post</li>
<li>{True} x := 5  {x &gt; 4} :  Valid HT</li>
<li>{True}  x:= 5  {x=5 or x=6}  : Valid HT</li>
</ul>




<ul class="org-ul">
<li>{True}  x:= 5  {x &gt; 5}  : Invalid HT</li>

<li>{x = 1 &amp; y = 2} z:= x/y  {z &lt; 1}   : Valid</li>
<li>{x &lt; y} z:= x/y  {z &lt; 1}   :   Invalid</li>
<li>{False} x:=3 {x=8}  : Valid</li>
<li>{True} while(1){x:=8} {x=3}  : Valid (Partial correct)
<ul class="org-ul">
<li>Partial () vs Total (you have to check that the program terminates)</li>
</ul></li>

<li>Halting problem
<ul class="org-ul">
<li>given a program, is it possible to determine if it will halt or not?</li>
<li>Alan Turing
<ul class="org-ul">
<li>Break Engima (10 years of WW-II)</li>
<li>Father of Computer Science
<ul class="org-ul">
<li>Show that Halting problem is undecidable</li>
<li>Turing machine - Universal Machine</li>
<li>Turing test</li>
</ul></li>
<li>Matrix multiplication (LU-)</li>
</ul></li>
<li>Halting: Undecidable problem</li>
</ul></li>
</ul>


<p>
How to determine if Hoare Triple is valid or not?
</p>
<ul class="org-ul">
<li>Compute <b>weakest</b> preconditions (WP)</li>
<li>WP(S, Q) = P'</li>
</ul>


<ul class="org-ul">
<li>Skip:WP(skip, {x=3})=  {x=3}</li>
<li>Assignment:  
<ul class="org-ul">
<li>WP(x:=x+1, {x=3})= {x=2}
<ul class="org-ul">
<li>{x=2} x:= x+1 {x=3}</li>
</ul></li>
<li>WP(x:=x+1, {x&gt;3})= x&gt;2</li>
<li>WP(x:=1, {x=3}) = False
{False}  x:= 1 {x=3}</li>
</ul></li>
<li>Condition
<ul class="org-ul">
<li>WP(if x &gt; 0 then y := x + 2  else y:= y + 1,  {y &gt; x})
x&gt;0  and   (x  &lt; 0 -&gt; y + 1 &gt;x )</li>
</ul></li>
<li>While loop
<ul class="org-ul">
<li>loop invariant (I)
<ul class="org-ul">
<li>true when entering the loop</li>
</ul></li>
</ul></li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #e45649;">while</span> (b){
  <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">loop body</span>
}

<span style="color: #e45649;">while</span> (<span style="color: #b751b6;">True</span>){
  [I]      <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">loop invariant I is right here</span>
  <span style="color: #e45649;">if</span> (!b) <span style="color: #e45649;">break</span>
    <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">loop body</span>
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">{N &gt;= 0} <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">precondition</span>

i := 0
<span style="color: #e45649;">while</span>(<span style="color: #b751b6;">True</span>):
  [L]
  <span style="color: #e45649;">if</span>(!(i &lt; N)):  <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">i &gt;= N : break</span>
      <span style="color: #e45649;">break</span>
  i := N;
</pre>
</div>

<p>
i = i = True
N= N
i &gt;= 0
i &lt;= N   
</p>
</div>
</div>
</div>

<div id="outline-container-org710da70" class="outline-2">
<h2 id="org710da70"><span class="section-number-2">10.</span> Lecture 3 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-09-09 Fri&gt;</span></span>)</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-orge536c81" class="outline-3">
<h3 id="orge536c81"><span class="section-number-3">10.1.</span> Go over quiz 1</h3>
<div class="outline-text-3" id="text-10-1">
<p>
Binary_search(arrays, x)
</p>
<ul class="org-ul">
<li>precondition:
<ul class="org-ul">
<li>arrays: sorted, cannot null,</li>
</ul></li>
<li><p>
postcondition:
</p>
<ul class="org-ul">
<li>if x not in arrays: raise some exception &#x2026;</li>
<li>ow: returns index of x in array</li>
</ul>
<ul class="org-ul">
<li>Recap:
<ul class="org-ul">
<li>Specification is NOT code/implementation (it is independent of implementation)</li>
<li>Do not look at implementation to write specification (you will write specification for that implementation); write specification FIRST !</li>
<li>Raise exceptions related to the undesirable input, e.g., if you don't want null, then raise something about NullPointerException.  If you don't want bad index to array, then use something about IndexOutOfBoundException. If you don't want some type of inputs, then raise IllegalArgumentException.</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org2643f50" class="outline-3">
<h3 id="org2643f50"><span class="section-number-3">10.2.</span> Data Abstraction</h3>
<div class="outline-text-3" id="text-10-2">
<p>
Consider <a href="./files/Poly.java">Poly.java from Liskov</a>
</p>
<ul class="org-ul">
<li>implements a class to represent <code>polynomials</code></li>
<li>10*x + 5*x^2 + 3*x^3 + 100*x^11 + 42</li>
<li>101</li>
<li>c_1*x_1^d_1 + c_2*x_2^d_2    (c_i*x_i^d_i : term,  c_i: coefficients, d_i: degree)</li>
</ul>


<ul class="org-ul">
<li>This is a <b>specific</b> implementation of Polynomials
<ul class="org-ul">
<li>uses arrays of ints to represent terms &#x2026;</li>
<li><code>deg</code> var to store degree</li>

<li>Some additional constraints for polynomials in this implementation
<ul class="org-ul">
<li>1 variable (5*x*y not allowed)</li>
<li>no negative degree</li>
<li>coefficients integers</li>
</ul></li>
</ul></li>

<li>to represent: <code>5 + 3*x^2</code> in this code
<ul class="org-ul">
<li><code>Poly(deg=2, trms</code>[5,3])=</li>
<li><code>Poly(deg=2, trms</code>[5,0,3])=</li>

<li><code>Poly(deg=2, trms</code>[5,0,3,0,0,0,0,0&#x2026;])=: not allowed in Poly implementation (last element of the array term cannot be non zero)</li>
</ul></li>
</ul>


<ul class="org-ul">
<li>1st <code>public Poly</code> contract: good (no inputs, not modifying any inputs etc)</li>
<li>2nd <code>public Poly</code> contract: also good, total contract: raise exception if n &lt; 0, otherwise return this polynomial</li>
<li><code>private Poly</code>  :  she did not forget the contract, it is assumed that it will be called by something trusted , so no need to talk about specs of these.</li>
<li><code>deg</code>:  highest degree associated with a non-zero cofficient</li>
<li><code>coeff_book()</code> vs <code>coeff()</code>  :  which is better? coeff() is better, go back to constructors:  if n &lt; 0 , it throws IAE,  but this coeff_book returns a value (implicitly allow that)</li>
</ul>
<p>
&#x2026;
</p>
<ul class="org-ul">
<li><b>abstraction method/function</b>: <code>toString</code>   -&gt; concrete (implementation) to abstract (polynomial)
<ul class="org-ul">
<li><code>Poly(deg=2, trms</code>[5,3])=   =&gt;  5+3*x</li>
<li><code>Poly(deg=2, trms</code>[5,0,3])= =&gt;  5+3x^2</li>
</ul></li>
</ul>
</div>

<div id="outline-container-org10d9895" class="outline-4">
<h4 id="org10d9895"><span class="section-number-4">10.2.1.</span> Immutable</h4>
<div class="outline-text-4" id="text-10-2-1">
<ul class="org-ul">
<li>Thread safe ;  easier for sharing; efficiency; safety;  less prone to error, easier to design</li>
<li>really good for concurrency (can do things in parallel)</li>
</ul>
</div>

<ol class="org-ol">
<li><a id="org0911383"></a>General way to turn mutable to immutable<br />
<div class="outline-text-5" id="text-10-2-1-1">
<ul class="org-ul">
<li>If modifies contents of the data, create a new one instead and also return the newly created one</li>
<li>In other words, it would not modify the contents of the data, instead of modifying the data internally,  it returns a new data (that would have same contents as data in the the mutable version)</li>
</ul>
</div>
</li>
</ol>
</div>

<div id="outline-container-org763a6bf" class="outline-4">
<h4 id="org763a6bf"><span class="section-number-4">10.2.2.</span> In-class 3A</h4>
<div class="outline-text-4" id="text-10-2-2">
<pre class="example">
q = [1,2,3]
q.enQueue(4) #  q.elements = [1,2,3,4]

result = q.deQueue()
- q.elements = [2,3,4]
- result = 1

----------------

q = [1,2,3]
q' = q.enQueue_Immutable(4)  
- q.elements = [1,2,3]
- q'.elmenets = [1,2,3,4]
q = q'

q' = q.deQueue_Immutable()
result = q.getFirst()
q = q'
- q.elements = [2,3,4]
- result = 1  

</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgb2e0317" class="outline-2">
<h2 id="orgb2e0317"><span class="section-number-2">11.</span> Lecture 2 (<span class="timestamp-wrapper"><span class="timestamp">&lt;2022-09-02 Fri&gt;</span></span>)</h2>
<div class="outline-text-2" id="text-11">
</div>
<div id="outline-container-org4b6abbf" class="outline-3">
<h3 id="org4b6abbf"><span class="section-number-3">11.1.</span> Adminstrative: Groups</h3>
<div class="outline-text-3" id="text-11-1">
<ul class="org-ul">
<li>next time:  1 submission per group</li>
</ul>
</div>
</div>

<div id="outline-container-org3f96e31" class="outline-3">
<h3 id="org3f96e31"><span class="section-number-3">11.2.</span> Reconsider In-class 1B (class <code>User</code>)</h3>
<div class="outline-text-3" id="text-11-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #986801;">User</span> <span style="color: #6a1868;">u1</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">u1</span>(<span style="color: #50a14f;">"hello"</span>);
<span style="color: #986801;">User</span> <span style="color: #6a1868;">u2</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">User</span>(<span style="color: #b751b6;">null</span>);
u2.equals(u1); <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">contract:F, impl: F</span>
u1.equals(v2); <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">contract:F (Javadoc does not say it should raise exception), impl: exception</span>

<span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">Q: how to fix this?</span>
<span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">A: Check for null and return False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8da0d6c" class="outline-3">
<h3 id="org8da0d6c"><span class="section-number-3">11.3.</span> Another example on how to obtain specs from documentation</h3>
<div class="outline-text-3" id="text-11-3">
<ul class="org-ul">
<li>consider <code>remove</code> from <code>iterator</code>: <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Iterator.html">https://docs.oracle.com/javase/8/docs/api/java/util/Iterator.html</a>
<ul class="org-ul">
<li>Removes from the underlying collection the last element returned by this iterator (optional operation). This method can be called only once per call to next(). The behavior of an iterator is unspecified if the underlying collection is modified while the iteration is in progress in any way other than by calling this method.</li>
<li>Getting contracts/specs from the English description.
<ul class="org-ul">
<li>1st sentence: postcondition, specifying behavior</li>
<li>2nd:  post  or detail implementation</li>
<li>3rd:  post, side effects,  but could be a <b>precondition</b>:  statement that the collection should not be modified</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>



<div id="outline-container-org4cfe69d" class="outline-3">
<h3 id="org4cfe69d"><span class="section-number-3">11.4.</span> Method/Program specifications</h3>
<div class="outline-text-3" id="text-11-4">
<ul class="org-ul">
<li>Preconditions (<code>P</code>): assumptions, properties about the inputs
<ul class="org-ul">
<li>established by clients (e.g., inputs are strings, unsorted list, &#x2026;)</li>
</ul></li>

<li>Postconditions (<code>Q</code>): properties/behaviors of the method/program (usually related inputs)
<ul class="org-ul">
<li>done/established by the developers/implementations (e.g., outputs are sorted list, &#x2026;)</li>
</ul></li>

<li>When something goes wrong, who to blame?
<ul class="org-ul">
<li>If preconditions are incorrect: blame the clients</li>
<li>If preconditions are correct, and the postconditions are not correct: blame developers</li>
</ul></li>
</ul>
</div>
</div>


<div id="outline-container-org7564a7b" class="outline-3">
<h3 id="org7564a7b"><span class="section-number-3">11.5.</span> Weaker Preconditions and Stronger Postconditions</h3>
<div class="outline-text-3" id="text-11-5">
<ul class="org-ul">
<li>Reconsider the <code>intdiv</code> example from previous class</li>
</ul>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #986801;">int</span> <span style="color: #a626a4;">intdiv</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">x</span>, <span style="color: #986801;">int</span> <span style="color: #6a1868;">y</span>){
  <span style="color: #9ca0a4;">/*</span>
<span style="color: #9ca0a4;">  Return the integer division result x/y. </span>

<span style="color: #9ca0a4;">  preconds:</span>
<span style="color: #9ca0a4;">  - x and y are integers # (already given in type)</span>
<span style="color: #9ca0a4;">  // - y cannot be zero   # better if we can remove this</span>

<span style="color: #9ca0a4;">  postconds:</span>
<span style="color: #9ca0a4;">  - z is a number  # weak</span>
<span style="color: #9ca0a4;">  - z is an integer  # weak</span>
<span style="color: #9ca0a4;">  - z = x // y  # *strong*</span>
<span style="color: #9ca0a4;">  */</span>

  <span style="color: #e45649;">if</span> (y == 0){ <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">raise ...</span>

  }

  <span style="color: #e45649;">return</span> z
}
</pre>
</div>

<p>
If we have <code>S1 = P =&gt; Q</code> and <code>S2 = P' =&gt; Q'</code>, then 
</p>
<ul class="org-ul">
<li>S1 is better than S2 :   if P is weaker than P'</li>
<li>S1 is better than S2 :   if Q is stronger than Q'</li>
</ul>
</div>
</div>


<div id="outline-container-org128147b" class="outline-3">
<h3 id="org128147b"><span class="section-number-3">11.6.</span> Total vs Partial contract</h3>
<div class="outline-text-3" id="text-11-6">
<ul class="org-ul">
<li><b>partial</b> specification:  has a precondition</li>
<li><b>total</b> specification:  has NO precondition</li>

<li><p>
to turn a partial spec into a total spec:
</p>
<ul class="org-ul">
<li>for every precondition, remove and turn it into a new behavior in postcondition (of the form if not precondition, then do something, e.g., raising an excpetion)
<ul class="org-ul">
<li>E.g., if we have a precondition   <code>list</code> cannot be <code>null</code></li>
<li>Then we remove that precondition</li>
<li>And create the postcondition:  if list is null then raise NullPointerExeception</li>
</ul></li>
</ul>
<ul class="org-ul">
<li>in the implementation, create conditions and raise exception</li>
</ul></li>
</ul>
</div>
</div>


<div id="outline-container-org9b88b58" class="outline-3">
<h3 id="org9b88b58"><span class="section-number-3">11.7.</span> In-class 2</h3>
<div class="outline-text-3" id="text-11-7">
<ol class="org-ol">
<li>null : gives NPE error null pointer</li>
<li>[]   : gives IOB error (result.remove())</li>
</ol>

<p>
Happy Paths     
</p>
<ol class="org-ol">
<li>[1]  : []</li>
<li>[1,2,3] :  [2, 3]</li>
</ol>


<ul class="org-ul">
<li><p>
Partial Specs
Preconds:
</p>
<ul class="org-ul">
<li>list not null</li>
<li>list not empty (list has at least 1 elem)</li>
</ul>
<p>
Postconds:
</p>
<ul class="org-ul">
<li>return the tail of the original list</li>
</ul></li>

<li>Total Specs
Preconds: 
Postconds:
<ul class="org-ul">
<li>raise NPE if list is null</li>
<li>raise  IllegalArgumentExcdeption if list is empty</li>
<li>return the tail of the original list</li>
<li></li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #986801;">List</span>&lt;<span style="color: #986801;">Integer</span>&gt; <span style="color: #a626a4;">tail</span> (<span style="color: #986801;">List</span>&lt;<span style="color: #986801;">Integer</span>&gt; <span style="color: #6a1868;">list</span>) {

    <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">REQUIRES/PRECONDS: ???</span>
    <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">EFFECTS/POSTCONDS:  ???</span>

    <span style="color: #e45649;">if</span> (<span style="color: #986801;">list</span> <span style="color: #6a1868;">is</span> <span style="color: #b751b6;">null</span>){
        <span style="color: #986801;">raise</span> <span style="color: #6a1868;">NullPointerException</span>;
    }
    <span style="color: #e45649;">if</span> (list.size() == 0){
        <span style="color: #986801;">raise</span> <span style="color: #6a1868;">IllegalArgumentException</span>;
    }

    .....
}
</pre>
</div>

<ul class="org-ul">
<li></li>
</ul>
</div>
</div>

<div id="outline-container-org5c6b1ce" class="outline-3">
<h3 id="org5c6b1ce"><span class="section-number-3">11.8.</span> In-class 2B (<code>tail</code> implementation)</h3>
</div>
</div>



<div id="outline-container-org6d5a979" class="outline-2">
<h2 id="org6d5a979"><span class="section-number-2">12.</span> Lecture 1 (8/26)</h2>
<div class="outline-text-2" id="text-12">
</div>
<div id="outline-container-orgb6cfbe0" class="outline-3">
<h3 id="orgb6cfbe0"><span class="section-number-3">12.1.</span> Administrative</h3>
<div class="outline-text-3" id="text-12-1">
<ul class="org-ul">
<li>Syllabus</li>
</ul>
</div>
</div>

<div id="outline-container-orge9bdfbb" class="outline-3">
<h3 id="orge9bdfbb"><span class="section-number-3">12.2.</span> Specification Example</h3>
<div class="outline-text-3" id="text-12-2">
<p>
Sorting (e.g., quicksort)
</p>
<ul class="org-ul">
<li>Input: a list of integers numbers, e.g., [2,1,5,10]</li>

<li>Output:  
<ul class="org-ul">
<li><b>output is a permutation of input</b> and <b>output is in sored sorder (e.g., ascending)</b></li>
</ul></li>

<li>Alg:
<ul class="org-ul">
<li>additional requirements, e.g., (involving pivot, worst case complexity n^2, amortized nlg n)</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org130c03a" class="outline-3">
<h3 id="org130c03a"><span class="section-number-3">12.3.</span> Definitions</h3>
<div class="outline-text-3" id="text-12-3">
<p>
Software Specifications (e.g., specification of a program/methoad/function)
</p>
<ul class="org-ul">
<li><b>Preconditions</b>: properties of the Inputs</li>
<li><b>Postconditions</b>: properties of the Outputs
<ul class="org-ul">
<li>Typically will have some relationships with the inputs</li>
</ul></li>
</ul>
<ul class="org-ul">
<li>Additional properties/specifications that are common for all software (desirable, but very hard to achieve)
<ul class="org-ul">
<li>secured</li>
<li>robust</li>
<li>bugs-free</li>
<li>efficiently</li>
</ul></li>

<li>Specification of a program: precondition + postcondition</li>
<li>Correctness: A program (implementation) is <b>correct</b> if it satifies the given specifications (i.e., pre/post conditions).</li>
</ul>
</div>
</div>

<div id="outline-container-orge82688b" class="outline-3">
<h3 id="orge82688b"><span class="section-number-3">12.4.</span> Another example</h3>
<div class="outline-text-3" id="text-12-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #986801;">int</span> <span style="color: #a626a4;">intdiv</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">x</span>, <span style="color: #986801;">int</span> <span style="color: #6a1868;">y</span>){
  <span style="color: #9ca0a4;">/*</span>
<span style="color: #9ca0a4;">  precond: x and y are integers, y cannot be zero</span>
<span style="color: #9ca0a4;">  postcond: z = x // y</span>
<span style="color: #9ca0a4;">  */</span>


  <span style="color: #e45649;">return</span> z
}    
</pre>
</div>
</div>
</div>



<div id="outline-container-org5f98634" class="outline-3">
<h3 id="org5f98634"><span class="section-number-3">12.5.</span> In class Exercise (User, equals)</h3>
<div class="outline-text-3" id="text-12-5">
</div>
<div id="outline-container-org7f8fe07" class="outline-4">
<h4 id="org7f8fe07"><span class="section-number-4">12.5.1.</span> Truth table for Implication (=&gt;)</h4>
<div class="outline-text-4" id="text-12-5-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">X</th>
<th scope="col" class="org-left">Y</th>
<th scope="col" class="org-left">X =&gt; Y</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">T</td>
<td class="org-left">T</td>
<td class="org-left">T</td>
</tr>

<tr>
<td class="org-left">T</td>
<td class="org-left">F</td>
<td class="org-left">F</td>
</tr>

<tr>
<td class="org-left">F</td>
<td class="org-left">T</td>
<td class="org-left">T</td>
</tr>

<tr>
<td class="org-left">F</td>
<td class="org-left">F</td>
<td class="org-left">T</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>Be careful about implication, the formula `X =&gt; Y` is only False when `X` is True but `Y` is False, in every other cases, the formula is True.</li>
</ul>
</div>
</div>


<div id="outline-container-orga1aeb08" class="outline-4">
<h4 id="orga1aeb08"><span class="section-number-4">12.5.2.</span> Expected properties for an implementation of `equals` (according to <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html#equals(java.lang.Object)">https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html#equals(java.lang.Object)</a>)</h4>
<div class="outline-text-4" id="text-12-5-2">
<ol class="org-ol">
<li>reflexive: `a == a`</li>
<li>symmetry:   `a <code>= b &lt;=&gt;  b =</code> a`</li>
<li>transitive: `a <code>= b &amp;&amp; b =</code> c  <code>&gt;  a =</code> c`</li>
</ol>


<ul class="org-ul">
<li>Examples</li>
</ul>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #986801;">User</span> <span style="color: #6a1868;">u1</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">User</span>(<span style="color: #50a14f;">"hello"</span>);
<span style="color: #986801;">User</span> <span style="color: #6a1868;">u2</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">User</span>(<span style="color: #50a14f;">"world"</span>)
User u3 = <span style="color: #e45649;">new</span> <span style="color: #986801;">User</span>(<span style="color: #50a14f;">"swe419"</span>);

<span style="color: #986801;">User</span> <span style="color: #6a1868;">u1a</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">User</span>(<span style="color: #50a14f;">"hello"</span>);
<span style="color: #986801;">User</span> <span style="color: #6a1868;">u1b</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">User</span>(<span style="color: #50a14f;">"hello"</span>);
<span style="color: #986801;">User</span> <span style="color: #6a1868;">u2a</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">User</span>(<span style="color: #50a14f;">"world"</span>);

<span style="color: #986801;">SpecialUser</span> <span style="color: #6a1868;">s1</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">SpecialUser</span>(<span style="color: #50a14f;">"hello"</span>, 1)
</pre>
</div>


<p>
For the equal implementation in In-class 1B for <code>User</code>.
</p>

<ul class="org-ul">
<li>Reflexive: OK
<ul class="org-ul">
<li>e.g., <code>u1.equals(u1): contract: T   impl: T</code></li>
</ul></li>

<li>symmetry: OK
<ul class="org-ul">
<li>e.g., <code>u1.equals(u2): False  &amp;&amp; u2.equals(u1): False    contract: F   impl: F</code></li>
<li><code>u1.equals(u1a): T  &amp;&amp; u1a.equals(u1): T  contract: T  impl: T</code></li>
</ul></li>

<li>Transitive: OK
<ul class="org-ul">
<li>e.g., <code>u1.equals(u2) &amp;&amp;  u2.equals(u3) =&gt;  u1.equals(u3) contract: T impl: T</code>,</li>
<li><code>u1.equals(u2a) &amp;&amp;  u2a.equals(u2b)  contract: T   impl: T</code></li>
</ul></li>
</ul>


<p>
Things become more complicated when involving inheritence
</p>

<ul class="org-ul">
<li>Symmetry: Not OK
<ul class="org-ul">
<li><code>u1.equals(s1)    impl:  T</code></li>
<li><code>s1.equals(u1)    impl:  F</code></li>
</ul></li>

<li><p>
A potential fix (suggested by a student)
</p>
<div class="org-src-container">
<pre class="src src-java">SpecialUser
      <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">equals</span> (<span style="color: #986801;">Object</span> <span style="color: #6a1868;">obj</span>) {
      <span style="color: #e45649;">if</span> (<span style="color: #4078f2; font-weight: bold;">!</span>(obj <span style="color: #e45649;">instanceof</span> SpecialUser)) <span style="color: #e45649;">return</span> <span style="color: #e45649;">super</span>.equal(obj); <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">obj.equals(this)</span>
       <span style="color: #e45649;">return</span> <span style="color: #e45649;">super</span>.equals(obj) &amp;&amp; ((<span style="color: #986801;">SpecialUser</span>) obj).id == <span style="color: #e45649;">this</span>.id;
      }

</pre>
</div></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
