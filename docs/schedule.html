<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-03-13 Wed 13:37 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SWE 619 Course Schedule and Assignments</title>
<meta name="author" content="ThanhVu (Vu) Nguyen" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" href="https://dynaroars.github.io/files/org.css">
<link rel="alternative stylesheet" href="https://dynaroars.github.io/files/org-orig.css">
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">SWE 619 Course Schedule and Assignments</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgea5c1ef">1. Notes:</a></li>
<li><a href="#orgbaa0656">2. Schedule</a></li>
<li><a href="#orgbc4629d">3. In class Assignments</a></li>
<li><a href="#orgc7a97d1">4. HW Assignments</a></li>
<li><a href="#org12a53c0">5. Reflection</a></li>
<li><a href="#org1c3e7f4">6. Files</a></li>
<li><a href="#org787220e">7. Links</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgea5c1ef" class="outline-2">
<h2 id="orgea5c1ef"><span class="section-number-2">1.</span> Notes:</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li><a href="./notes.html">notes.html</a>:  Older, more details, but not very polished</li>
<li><a href="./notes.ipynb">notes.ipynb</a>: Python notebook format, you can download the file and load in VS Code or some other editor/viewer.</li>
</ul>
</div>
</div>
<div id="outline-container-orgbaa0656" class="outline-2">
<h2 id="orgbaa0656"><span class="section-number-2">2.</span> Schedule</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li><b>Notes</b>: Except for the first class, students are expected to complete the reading <b>prior to class</b> on listed meeting. Quizzes may occasionally take advantage of this expectation. Homework assignments are <b>due</b> on the date listed.</li>
</ul>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-center" />

<col  class="org-center" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Topic</th>
<th scope="col" class="org-left">Reading</th>
<th scope="col" class="org-center">Assignment</th>
<th scope="col" class="org-center">In-Class Exercise</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><del>Class Overview</del></td>
<td class="org-left">Liskov 1&#x2013;2</td>
<td class="org-center">&#xa0;</td>
<td class="org-center">IC <a href="#ic1">1</a></td>
</tr>

<tr>
<td class="org-left"><del>Procedural Abstraction; Exceptions</del></td>
<td class="org-left">Liskov 3&#x2013;4, Bloch 10</td>
<td class="org-center"><a href="#a1">A1 Due</a></td>
<td class="org-center">IC 2 <a href="#ic2A">A</a> <a href="#ic2B">B</a></td>
</tr>

<tr>
<td class="org-left"><del>Imperative Program Verification</del></td>
<td class="org-left"><a href="https://github.com/dynaroars/dynaroars.github.io/wiki/notes-hoare-logic">Hoare logic notes</a></td>
<td class="org-center"><a href="#a2">A2 Due</a></td>
<td class="org-center">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><del>Imperative Program verification</del></td>
<td class="org-left"><a href="https://github.com/dynaroars/dynaroars.github.io/wiki/notes-hoare-logic">Hoare logic notes</a></td>
<td class="org-center">NO ASSIGNMENT</td>
<td class="org-center">IC <a href="#ic4">4</a></td>
</tr>

<tr>
<td class="org-left"><del>Data Abstraction; Mutability</del></td>
<td class="org-left">Liskov 5.1&#x2013;5.10,</td>
<td class="org-center"><a href="#a4">A4 Due</a></td>
<td class="org-center">IC 5 <a href="#ic5A">A</a> <a href="#ic5B">B</a></td>
</tr>

<tr>
<td class="org-left"><del>Iteration Abstraction; Method Guidelines</del></td>
<td class="org-left">Liskov 6, Bloch 8</td>
<td class="org-center"><a href="#a5">A5 Due</a></td>
<td class="org-center">IC 7 <a href="#ic7A">A</a> <a href="#ic7B">B</a></td>
</tr>

<tr>
<td class="org-left">Type Abstraction</td>
<td class="org-left">Liskov 7</td>
<td class="org-center"><a href="#a6">A6 Due</a></td>
<td class="org-center">IC 8 <a href="#ic8A">A</a> <a href="#ic8B">B</a> <a href="#ic8C">C</a></td>
</tr>

<tr>
<td class="org-left">Mid-semester Recap; <a href="./files/swe619.pdf">Research slides</a></td>
<td class="org-left"><i>No New Material</i></td>
<td class="org-center">NO ASSIGNMENT</td>
<td class="org-center">IC <a href="#ic9">9</a></td>
</tr>

<tr>
<td class="org-left">Polymorphic Abstract; Lambdas</td>
<td class="org-left">Liskov 8, Bloch 7 (Item 42)</td>
<td class="org-center"><a href="#a8">A8 Due</a></td>
<td class="org-center">IC <a href="#ic10">10</a></td>
</tr>

<tr>
<td class="org-left">Generics</td>
<td class="org-left">Bloch 5</td>
<td class="org-center"><a href="#a9">A9 Due</a></td>
<td class="org-center">IC 11 <a href="#ic11A">A</a> <a href="#ic11B">B</a> <a href="#ic11C">C</a></td>
</tr>

<tr>
<td class="org-left">Common Java Contracts</td>
<td class="org-left">Bloch 3</td>
<td class="org-center"><a href="#a10">A10 Due</a></td>
<td class="org-center">IC 12 <a href="#ic12A">A</a> <a href="#ic12B">B</a></td>
</tr>

<tr>
<td class="org-left">Classes and Inheritance</td>
<td class="org-left">Bloch 4</td>
<td class="org-center"><a href="#a11">A11 Due</a></td>
<td class="org-center">IC 12 <a href="#ic13A">A</a> <a href="#ic13B">B</a> <a href="#ic13C">C</a></td>
</tr>

<tr>
<td class="org-left">Contract Model in Testing</td>
<td class="org-left">Advanced JUnit (<a href="./files/Ch03-automation.pptx ">slides 22-24)</a></td>
<td class="org-center"><a href="#a12">A12 Due</a></td>
<td class="org-center">IC <a href="#ic14">14</a></td>
</tr>

<tr>
<td class="org-left">Final Exam</td>
<td class="org-left"><a href="#ic16">example</a></td>
<td class="org-center">&#xa0;</td>
<td class="org-center">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgbc4629d" class="outline-2">
<h2 id="orgbc4629d"><span class="section-number-2">3.</span> In class Assignments</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-ic1" class="outline-3">
<h3 id="ic1"><span class="section-number-3">3.1.</span> In class 1</h3>
<div class="outline-text-3" id="text-ic1">
<p>
Work with your group and do the following:
</p>
<ol class="org-ol">
<li>Spend a few minutes getting acquainted. Explain a bit about yourself: full-time student?, working in software development?, why are you taking this class?, favorite/least favorite thing about writing software?, etc.</li>
<li>Decide on a mechanism for joint communication. Google docs? IDE with screen share? Something else?</li>
<li><p>
Now address a technical topic. This exercise touches on some of the thorny issues in data abstraction and inheritance. There is a lot going on in this example. Hence don&rsquo;t worry if it seems confusing today. We&rsquo;ll revisit this example several times over the course of the semester.
</p>

<p>
Consider the following (textbook) code:
</p>

<div class="org-src-container">
<pre class="src src-java">        <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">User</span> <span style="color: #4078f2;">{</span>
            <span style="color: #e45649;">private</span> <span style="color: #986801;">String</span> <span style="color: #6a1868;">name</span>;
            <span style="color: #e45649;">public</span> User <span style="color: #a626a4;">(</span>String name<span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">this</span>.name = name; <span style="color: #a626a4;">}</span>
            <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">equals</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">Object</span> <span style="color: #6a1868;">obj</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
                <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span><span style="color: #4078f2; font-weight: bold;">!</span><span style="color: #b751b6;">(</span>obj <span style="color: #e45649;">instanceof</span> User<span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span> <span style="color: #e45649;">return</span> <span style="color: #b751b6;">false</span>;
                <span style="color: #e45649;">return</span> <span style="color: #50a14f;">(</span><span style="color: #b751b6;">(</span><span style="color: #986801;">User</span><span style="color: #b751b6;">)</span> obj<span style="color: #50a14f;">)</span>.name.equals<span style="color: #50a14f;">(</span><span style="color: #e45649;">this</span>.name<span style="color: #50a14f;">)</span>;
            <span style="color: #a626a4;">}</span>
            <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">other methods omitted</span>
        <span style="color: #4078f2;">}</span>
        <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">SpecialUser</span> <span style="color: #e45649;">extends</span> <span style="color: #986801;">User</span> <span style="color: #4078f2;">{</span>
            <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">id</span>;
            <span style="color: #e45649;">public</span> SpecialUser <span style="color: #a626a4;">(</span><span style="color: #986801;">String</span> <span style="color: #6a1868;">name</span>, <span style="color: #986801;">int</span> <span style="color: #6a1868;">id</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">super</span><span style="color: #50a14f;">(</span>name<span style="color: #50a14f;">)</span>; <span style="color: #e45649;">this</span>.id = id; <span style="color: #a626a4;">}</span>
            <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">equals</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">Object</span> <span style="color: #6a1868;">obj</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
                <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span><span style="color: #4078f2; font-weight: bold;">!</span><span style="color: #b751b6;">(</span>obj <span style="color: #e45649;">instanceof</span> SpecialUser<span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span> <span style="color: #e45649;">return</span> <span style="color: #b751b6;">false</span>;
                <span style="color: #e45649;">return</span> <span style="color: #e45649;">super</span>.equals<span style="color: #50a14f;">(</span>obj<span style="color: #50a14f;">)</span> &amp;&amp; <span style="color: #50a14f;">(</span><span style="color: #b751b6;">(</span><span style="color: #986801;">SpecialUser</span><span style="color: #b751b6;">)</span> obj<span style="color: #50a14f;">)</span>.id == <span style="color: #e45649;">this</span>.id;
            <span style="color: #a626a4;">}</span>
            <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">other methods omitted</span>
        <span style="color: #4078f2;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">        <span style="color: #e45649;">class</span> <span style="color: #986801;">User</span>:
            <span style="color: #e45649;">def</span> <span style="color: #a626a4;">__init__</span>(<span style="color: #e45649;">self</span>, name):
                <span style="color: #e45649;">self</span>.<span style="color: #6a1868;">name</span> = name
        <span style="color: #e45649;">def</span> <span style="color: #a626a4;">__eq__</span>(<span style="color: #e45649;">self</span>, other):
            <span style="color: #e45649;">if</span> <span style="color: #e45649;">not</span> <span style="color: #a626a4;">isinstance</span>(other, User):
                <span style="color: #e45649;">return</span> <span style="color: #b751b6;">False</span>
            <span style="color: #e45649;">return</span> <span style="color: #e45649;">self</span>.name.__eq__(other.name)

        <span style="color: #e45649;">class</span> <span style="color: #986801;">SuperUser</span>(User):
            <span style="color: #e45649;">def</span> <span style="color: #a626a4;">__init__</span>(<span style="color: #e45649;">self</span>, name, nid):
                <span style="color: #a626a4;">super</span>().__init__(name)
                <span style="color: #e45649;">self</span>.<span style="color: #6a1868;">nid</span> = nid

            <span style="color: #e45649;">def</span> <span style="color: #a626a4;">__eq__</span>(<span style="color: #e45649;">self</span>, other):
                <span style="color: #e45649;">if</span> <span style="color: #e45649;">not</span> <span style="color: #a626a4;">isinstance</span>(other, SuperUser):
                    <span style="color: #e45649;">return</span> <span style="color: #b751b6;">False</span>

                <span style="color: #e45649;">return</span> <span style="color: #a626a4;">super</span>().__eq__(other) <span style="color: #e45649;">and</span> <span style="color: #e45649;">self</span>.nid == other.nid
</pre>
</div></li>
</ol>

<p>
<span class="underline">Hint</span>: also look at the Javadoc for <code>equals()</code>
</p>

<ol class="org-ol">
<li>Walk though the execution of the <code>equals()</code> method in class <code>User</code> for a few well-chosen objects as the parameter. What happens at each point in the execution?</li>
<li>What does it mean for an <code>equals()</code> implementation to be <b>correct</b>? How do you know? Be as concrete as you can.</li>
<li>Is the given implementation of <code>equals()</code> in class <code>User</code> correct? Again, be concrete. If there is a problem, find a specific object (test case!) that demonstrates the problem.</li>
<li>How does inheritance complicate the correctness discussion for <code>equals()</code> in class <code>SpecialUser</code>?</li>
<li>What is your assessment of the <code>equals()</code> method in the <code>SpecialUser</code> class?</li>
</ol>
</div>
</div>
<div id="outline-container-ic2A" class="outline-3">
<h3 id="ic2A"><span class="section-number-3">3.2.</span> In class 2A</h3>
<div class="outline-text-3" id="text-ic2A">
<p>
Consider the following implementation:
</p>

<div class="org-src-container">
<pre class="src src-java">
     <span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #986801;">List</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">Integer</span><span style="color: #4078f2;">&gt;</span> <span style="color: #a626a4;">tail</span> <span style="color: #4078f2;">(</span><span style="color: #986801;">List</span><span style="color: #a626a4;">&lt;</span><span style="color: #986801;">Integer</span><span style="color: #a626a4;">&gt;</span> <span style="color: #6a1868;">list</span><span style="color: #4078f2;">)</span> <span style="color: #4078f2;">{</span>

         <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">REQUIRES/PRECONDS: ???</span>
         <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">EFFECTS/POSTCONDS:  ???</span>

         <span style="color: #986801;">List</span><span style="color: #a626a4;">&lt;</span><span style="color: #986801;">Integer</span><span style="color: #a626a4;">&gt;</span> <span style="color: #6a1868;">result</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">ArrayList</span><span style="color: #a626a4;">&lt;</span><span style="color: #986801;">Integer</span><span style="color: #a626a4;">&gt;(</span>list<span style="color: #a626a4;">)</span>;
         result.remove<span style="color: #a626a4;">(</span><span style="color: #da8548; font-weight: bold;">0</span><span style="color: #a626a4;">)</span>;
         <span style="color: #e45649;">return</span> result;
     <span style="color: #4078f2;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">
        <span style="color: #e45649;">def</span> <span style="color: #a626a4;">tail</span>(my_list):
            <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">REQUIRES/PRECONDS: ???</span>
            <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">EFFECTS/POSTCONDS: ???</span>

            <span style="color: #6a1868;">result</span> = my_list.copy()
            result.pop(<span style="color: #da8548; font-weight: bold;">0</span>)
            <span style="color: #e45649;">return</span> result
</pre>
</div>


<p>
<span class="underline">Hint</span>: also look at the Javadoc (for <code>remove</code>) or Python (for <code>pop</code>)
</p>

<ol class="org-ol">
<li>What does the <i>implementation</i> of <code>tail</code> do in each of the following cases? How do you know: Running the code or reading an API description?
<ul class="org-ul">
<li><code>list = null</code></li>
<li><code>list = []</code></li>
<li><code>list = [1]</code></li>
<li><code>list = [1, 2, 3]</code></li>
</ul></li>
<li>Write a <b>partial</b> specification that matches the &ldquo;happy path&rdquo; part of the implementation&rsquo;s behavior.</li>
<li>Rewrite the specification to be <b>total</b>. Use standard exceptions (e.g., as suggested in Bloch&rsquo;s).</li>
<li>The resulting specification has a problem. What is it? (hint: specification should be more general and not tied to the implementation)</li>
<li><i>Rewrite</i> the specification to address this problem. <i>Rewrite</i> the code to match the new specification.</li>
</ol>
</div>
</div>
<div id="outline-container-ic2B" class="outline-3">
<h3 id="ic2B"><span class="section-number-3">3.3.</span> In class 2B</h3>
<div class="outline-text-3" id="text-ic2B">
<p>
<b>Goal</b>: Understanding Contracts
</p>

<p>
Consider the 3 methods <code>hasNext</code> , <code>next</code>, and <code>remove</code> in the Java <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Iterator.html">Iterator</a> interface:
</p>

<ul class="org-ul">
<li>For each method, identify all preconditions and postconditions.</li>
<li>For each precondition, identify a specific input that violates the precondition.</li>
<li>For each postcondition, identify an input specific to that postcondition.</li>
</ul>
</div>
</div>
<div id="outline-container-ic4" class="outline-3">
<h3 id="ic4"><span class="section-number-3">3.4.</span> In class 4</h3>
<div class="outline-text-3" id="text-ic4">
<div class="org-src-container">
<pre class="src src-java">     <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">{N &gt;= 0}   # P</span>
     i = <span style="color: #da8548; font-weight: bold;">0</span>;
     <span style="color: #e45649;">while</span> <span style="color: #4078f2;">(</span>i &lt; <span style="color: #986801;">N</span><span style="color: #4078f2;">){</span>
         i = i + <span style="color: #da8548; font-weight: bold;">1</span>;
     <span style="color: #4078f2;">}</span>

     <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">{i == N}  # Q</span>
</pre>
</div>

<ul class="org-ul">
<li>Identify the loop invariants for the loop in this program</li>
<li>Use a sufficiently strong invariant to prove the program is correct</li>
<li>Attemp to prove the program using an insufficiently strong invariant, describe what happens and why.</li>
</ul>
</div>
</div>
<div id="outline-container-ic5A" class="outline-3">
<h3 id="ic5A"><span class="section-number-3">3.5.</span> In class 5A</h3>
<div class="outline-text-3" id="text-ic5A">
<p>
Consider a simple generic <code>Queue</code> implementation.
</p>
<div class="org-src-container">
<pre class="src src-java">
     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Queue</span> <span style="color: #4078f2;">&lt;</span><span style="color: #986801;">E</span><span style="color: #4078f2;">&gt;</span> <span style="color: #4078f2;">{</span>

         <span style="color: #e45649;">private</span> <span style="color: #986801;">List</span><span style="color: #a626a4;">&lt;</span><span style="color: #986801;">E</span><span style="color: #a626a4;">&gt;</span> <span style="color: #6a1868;">elements</span>;
         <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">size</span>;

         <span style="color: #e45649;">public</span> Queue<span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">this</span>.elements = <span style="color: #e45649;">new</span> <span style="color: #986801;">ArrayList</span><span style="color: #50a14f;">&lt;</span><span style="color: #986801;">E</span><span style="color: #50a14f;">&gt;()</span>;
             <span style="color: #e45649;">this</span>.size = <span style="color: #da8548; font-weight: bold;">0</span>;
         <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">enQueue</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">E</span> <span style="color: #6a1868;">e</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             elements.add<span style="color: #50a14f;">(</span>e<span style="color: #50a14f;">)</span>;
             size++;
         <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">E</span> <span style="color: #a626a4;">deQueue</span> <span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span>size == <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #50a14f;">)</span> <span style="color: #e45649;">throw</span> <span style="color: #e45649;">new</span> <span style="color: #986801;">IllegalStateException</span><span style="color: #50a14f;">(</span><span style="color: #50a14f;">"Queue.deQueue"</span><span style="color: #50a14f;">)</span>;
             <span style="color: #986801;">E</span> <span style="color: #6a1868;">result</span> = elements.get<span style="color: #50a14f;">(</span><span style="color: #da8548; font-weight: bold;">0</span><span style="color: #50a14f;">)</span>;
             elements.remove<span style="color: #50a14f;">(</span><span style="color: #da8548; font-weight: bold;">0</span><span style="color: #50a14f;">)</span>;
             size--;
             <span style="color: #e45649;">return</span> result;
         <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">isEmpty</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">return</span> size == <span style="color: #da8548; font-weight: bold;">0</span>;
         <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>

</pre>
</div>

<ol class="org-ol">
<li>Rewrite <code>Queue</code> to be <b>immutable</b>. Keep the representation variables <code>elements</code> and <code>size</code>.</li>
<li>Do the right thing with <code>enQueue()</code>.</li>
<li>Do the right thing with <code>deQueue()</code>.</li>
</ol>
</div>
</div>
<div id="outline-container-ic5B" class="outline-3">
<h3 id="ic5B"><span class="section-number-3">3.6.</span> In class 5B</h3>
<div class="outline-text-3" id="text-ic5B">
<p>
Consider the code:
</p>

<div class="org-src-container">
<pre class="src src-java">
     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Members</span> <span style="color: #4078f2;">{</span>
         <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Members is a mutable record of organization membership</span>
         <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">AF: Collect the list as a set</span>
         <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">rep-inv1: members != null</span>
         <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">rep-inv2: members != null &amp;&amp; no duplicates in members</span>
         <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">for simplicity, assume null can be a member...</span>

         <span style="color: #986801;">List</span><span style="color: #a626a4;">&lt;</span><span style="color: #986801;">Person</span><span style="color: #a626a4;">&gt;</span> <span style="color: #6a1868;">members</span>;   <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">the representation</span>

         <span style="color: #9ca0a4;">//  </span><span style="color: #9ca0a4;">Post: person becomes a member</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">join</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">Person</span> <span style="color: #6a1868;">person</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span> members.add   <span style="color: #50a14f;">(</span>person<span style="color: #50a14f;">)</span>;<span style="color: #a626a4;">}</span>

         <span style="color: #9ca0a4;">//  </span><span style="color: #9ca0a4;">Post: person is no longer a member</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">leave</span><span style="color: #a626a4;">(</span><span style="color: #986801;">Person</span> <span style="color: #6a1868;">person</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span> members.remove<span style="color: #50a14f;">(</span>person<span style="color: #50a14f;">)</span>;<span style="color: #a626a4;">}</span>

</pre>
</div>


<ol class="org-ol">
<li>Analyze these 4 questions for rep-inv 1.
<ol class="org-ol">
<li>Does <code>join()</code> maintain rep-inv?</li>
<li>Does <code>join()</code> satisfy contract?</li>
<li>Does <code>leave()</code> maintain rep-inv?</li>
<li>Does <code>leave()</code> satisfy contract?</li>
</ol></li>
<li>Repeat for rep-inv 2.</li>
<li>Recode <code>join()</code> to make the verification go through. Which rep-invariant do you use?</li>
<li>Recode <code>leave()</code> to make the verification go through. Which rep-invariant do you use?</li>
</ol>
</div>
</div>
<div id="outline-container-ic7A" class="outline-3">
<h3 id="ic7A"><span class="section-number-3">3.7.</span> In class 7A</h3>
<div class="outline-text-3" id="text-ic7A">
<p>
Consider the Java <code>Iterator&lt;E&gt;</code> interface:
</p>

<div class="org-src-container">
<pre class="src src-java">     <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">hasNext</span><span style="color: #4078f2;">()</span>;
     <span style="color: #e45649;">public</span> <span style="color: #986801;">E</span> <span style="color: #a626a4;">next</span><span style="color: #4078f2;">()</span> <span style="color: #e45649;">throws</span> <span style="color: #986801;">NoSuchElementException</span>
                            <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> remove<span style="color: #4078f2;">()</span> <span style="color: #e45649;">throws</span> <span style="color: #986801;">IllegalStateException</span>
</pre>
</div>

<ol class="org-ol">
<li>Work through an example using <code>next()</code> iterating over a list of strings: <code>["bat", "cat", "dog"]</code>
<ul class="org-ul">
<li>Example means a a sequence of <code>next()</code> calls</li>
<li>clearly indicate the concrete and abstract states after each call</li>
</ul></li>
<li>Do the same thing but with a <code>prev()</code> method (combination of <code>next</code> and <code>prev</code>)?</li>
<li>Do the same thing but with a <code>remove()</code> method (combination of <code>next</code> and <code>remove</code>)?</li>
</ol>
</div>
</div>
<div id="outline-container-ic7B" class="outline-3">
<h3 id="ic7B"><span class="section-number-3">3.8.</span> In class 7B</h3>
<div class="outline-text-3" id="text-ic7B">
<p>
Consider the <code>Period</code> example in Bloch&rsquo;s Item 50 (3rd Edition):
</p>

<div class="org-src-container">
<pre class="src src-java">
     <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Broken &#8220;immutable&#8221; time period class</span>
     <span style="color: #e45649;">public</span> <span style="color: #e45649;">final</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Period</span> <span style="color: #4078f2;">{</span>               <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Question 3</span>
         <span style="color: #e45649;">private</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">Date</span> <span style="color: #6a1868;">start</span>;
         <span style="color: #e45649;">private</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">Date</span> <span style="color: #6a1868;">end</span>;

         <span style="color: #84888b; font-style: italic;">/**</span>
<span style="color: #84888b; font-style: italic;">          * </span><span style="color: #b751b6; font-style: italic;">@param</span><span style="color: #84888b; font-style: italic;"> start the beginning of the period</span>
<span style="color: #84888b; font-style: italic;">          * </span><span style="color: #b751b6; font-style: italic;">@param</span><span style="color: #84888b; font-style: italic;"> end the end of the period; must not precede start</span>
<span style="color: #84888b; font-style: italic;">          * </span><span style="color: #b751b6; font-style: italic;">@throws</span><span style="color: #84888b; font-style: italic;"> IAE if start is after end</span>
<span style="color: #84888b; font-style: italic;">          * </span><span style="color: #b751b6; font-style: italic;">@throws</span><span style="color: #84888b; font-style: italic;"> NPE if start or end null</span>
<span style="color: #84888b; font-style: italic;">          */</span>

         <span style="color: #e45649;">public</span> Period <span style="color: #a626a4;">(</span><span style="color: #986801;">Date</span> <span style="color: #6a1868;">start</span>, Date end<span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span>start.compareTo<span style="color: #b751b6;">(</span>end<span style="color: #b751b6;">)</span> &gt; <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #50a14f;">)</span> <span style="color: #e45649;">throw</span> <span style="color: #e45649;">new</span> <span style="color: #986801;">IAE</span><span style="color: #50a14f;">()</span>;
             <span style="color: #e45649;">this</span>.start = start; <span style="color: #e45649;">this</span>.end = end;  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Question 1</span>
         <span style="color: #a626a4;">}</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">Date</span> <span style="color: #a626a4;">start</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> start;<span style="color: #a626a4;">}</span>    <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Question 2</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">Date</span> <span style="color: #a626a4;">end</span><span style="color: #a626a4;">()</span>   <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> end;<span style="color: #a626a4;">}</span>      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Question 2</span>
     <span style="color: #4078f2;">}</span>
</pre>
</div>


<ol class="org-ol">
<li>Write code that shows the problem the line marked // Question 1.</li>
<li>Write code that shows the problem the lines marked // Question 2.</li>
<li><p>
Suppose that the class declaration were:
</p>
<div class="org-src-container">
<pre class="src src-java">        <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Period</span> <span style="color: #4078f2;">{</span> <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Question 3</span>
</pre>
</div>
<ul class="org-ul">
<li>Think of a scenario and write code that shows the problem.</li>
</ul></li>
</ol>
</div>
</div>
<div id="outline-container-ic8A" class="outline-3">
<h3 id="ic8A"><span class="section-number-3">3.9.</span> In class 8A</h3>
<div class="outline-text-3" id="text-ic8A">
<p>
<b>Goal</b>: Understanding dynamic dispatching
</p>

<p>
Consider Liskov&rsquo;s <code>MaxIntSet</code> example with explicit <code>repOk()</code> calls: (Really, we&rsquo;d need assertions on these calls&#x2026;)
</p>

<div class="org-src-container">
<pre class="src src-java">
     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">IntSet</span> <span style="color: #4078f2;">{</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">insert</span><span style="color: #a626a4;">(</span><span style="color: #986801;">int</span> <span style="color: #6a1868;">x</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>...; repOk<span style="color: #50a14f;">()</span>;<span style="color: #a626a4;">}</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">remove</span><span style="color: #a626a4;">(</span><span style="color: #986801;">int</span> <span style="color: #6a1868;">x</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>...; repOk<span style="color: #50a14f;">()</span>;<span style="color: #a626a4;">}</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">repOk</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>...<span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>
     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">MaxIntSet</span> <span style="color: #e45649;">extends</span> <span style="color: #986801;">IntSet</span> <span style="color: #4078f2;">{</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">insert</span><span style="color: #a626a4;">(</span><span style="color: #986801;">int</span> <span style="color: #6a1868;">x</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>...; <span style="color: #e45649;">super</span>.insert<span style="color: #50a14f;">(</span>x<span style="color: #50a14f;">)</span>; repOk<span style="color: #50a14f;">()</span>;<span style="color: #a626a4;">}</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">remove</span><span style="color: #a626a4;">(</span><span style="color: #986801;">int</span> <span style="color: #6a1868;">x</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span><span style="color: #e45649;">super</span>.remove<span style="color: #50a14f;">(</span>x<span style="color: #50a14f;">)</span>; ...; repOk<span style="color: #50a14f;">()</span>;<span style="color: #a626a4;">}</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">repOk</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span><span style="color: #e45649;">super</span>.repOk<span style="color: #50a14f;">()</span>; ...;<span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>

     <span style="color: #986801;">MaxIntSet</span> <span style="color: #6a1868;">s</span> = <span style="color: #4078f2;">{</span><span style="color: #da8548; font-weight: bold;">3</span>, <span style="color: #da8548; font-weight: bold;">5</span><span style="color: #4078f2;">}</span>; s.remove<span style="color: #4078f2;">(</span><span style="color: #da8548; font-weight: bold;">5</span><span style="color: #4078f2;">)</span>;  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">repOk()????</span>
</pre>
</div>

<ol class="org-ol">
<li>What do the <code>"..."</code> bits do?</li>
<li>How does the call work out?</li>
<li>What is the abstract state of a <code>MaxIntSet</code>? There are two options. What are they, and what are the consequences of each choice?</li>
</ol>
</div>
</div>
<div id="outline-container-ic8B" class="outline-3">
<h3 id="ic8B"><span class="section-number-3">3.10.</span> In class 8B</h3>
<div class="outline-text-3" id="text-ic8B">
<p>
Consider the following:
</p>

<div class="org-src-container">
<pre class="src src-java">
     <span style="color: #e45649;">class</span> <span style="color: #986801;">A</span>:
         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> reduce <span style="color: #4078f2;">(</span>Reducer x<span style="color: #4078f2;">)</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Effects: if x is null throw NPE</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">else if x is not appropriate for this throw IAE</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">else reduce this by x</span>

             <span style="color: #e45649;">class</span> B:
             <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> reduce <span style="color: #4078f2;">(</span>Reducer x<span style="color: #4078f2;">)</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Requires: x is not null</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Effects: if x is not appropriate for this throw IAE</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">else reduce this by x</span>

             <span style="color: #e45649;">class</span> C:
             <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> reduce <span style="color: #4078f2;">(</span>Reducer x<span style="color: #4078f2;">)</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Effects: if x is null return (normally) with no change to this</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">else if x is not appropriate for this throw IAE</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">else reduce this by x</span>
</pre>
</div>

<p>
Analyze the &ldquo;methods rule&rdquo; for <code>reduce()</code> in each of these cases: Note: Some analysis may not be necessary. If so, indicate that.
</p>

<div class="org-src-container">
<pre class="src src-text">
     B extends A.
     Precondition Part:
     Postcondition Part:
     -----------------------------------
     C extends A.
     Precondition Part:
     Postcondition Part:
     -----------------------------------
     A extends B.
     Precondition Part:
     Postcondition Part:
     -----------------------------------
     C extends B.
     Precondition Part:
     Postcondition Part:
     -----------------------------------
     A extends C.
     Precondition Part:
     Postcondition Part:
     -----------------------------------
</pre>
</div>
</div>
</div>
<div id="outline-container-ic8C" class="outline-3">
<h3 id="ic8C"><span class="section-number-3">3.11.</span> In class 8C</h3>
<div class="outline-text-3" id="text-ic8C">
<p>
Consider the following:
</p>
<div class="org-src-container">
<pre class="src src-java">     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Counter</span><span style="color: #4078f2;">{</span>   <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Liskov 7.8</span>
         <span style="color: #e45649;">public</span> Counter<span style="color: #a626a4;">()</span>     <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">EFF: Makes this contain 0</span>
             <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> get<span style="color: #a626a4;">()</span>     <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">EFF: Returns the value of this</span>
             <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> incr<span style="color: #a626a4;">()</span>   <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">MOD: this //EFF: makes this larger</span>
             <span style="color: #4078f2;">}</span>
     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Counter2</span> <span style="color: #e45649;">extends</span> <span style="color: #986801;">Counter</span> <span style="color: #4078f2;">{</span> <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Liskov 7.9</span>
         <span style="color: #e45649;">public</span> Counter2<span style="color: #a626a4;">()</span>         <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">EFF: Makes this contain 0</span>
             <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> incr<span style="color: #a626a4;">()</span>       <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">MOD: this //EFF: double this</span>
             <span style="color: #4078f2;">}</span>
     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Counter3</span> <span style="color: #e45649;">extends</span> <span style="color: #986801;">Counter</span> <span style="color: #4078f2;">{</span>  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Liskov 7.10</span>
         <span style="color: #e45649;">public</span> Counter3<span style="color: #a626a4;">(</span><span style="color: #986801;">int</span> <span style="color: #6a1868;">n</span><span style="color: #a626a4;">)</span>   <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">EFF: Makes this contain n</span>
             <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> incr<span style="color: #a626a4;">(</span><span style="color: #986801;">int</span> <span style="color: #6a1868;">n</span><span style="color: #a626a4;">)</span>  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">MOD: this //EFF: if n&gt;0 add n to this</span>
             <span style="color: #4078f2;">}</span>
</pre>
</div>

<ol class="org-ol">
<li>Is there a constraint about negative/zero values for this? How do we know?</li>
<li>What methods are in the <code>Counter2</code> API?</li>
<li>Is <code>Counter2</code> a valid subtype of Counter?</li>
<li>What methods are in the <code>Counter3</code> API?</li>
</ol>
</div>
</div>
<div id="outline-container-ic9" class="outline-3">
<h3 id="ic9"><span class="section-number-3">3.12.</span> In class 9</h3>
<div class="outline-text-3" id="text-ic9">
<p>
This is a recap exercise.
</p>

<div class="org-src-container">
<pre class="src src-java">     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">BoundedQueue</span> <span style="color: #4078f2;">{</span>
         <span style="color: #e45649;">private</span> <span style="color: #986801;">Object</span> <span style="color: #6a1868;">rep</span><span style="color: #a626a4;">[]</span>;
         <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">front</span> = <span style="color: #da8548; font-weight: bold;">0</span>;
         <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">back</span> = -<span style="color: #da8548; font-weight: bold;">1</span>;
         <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">size</span> = <span style="color: #da8548; font-weight: bold;">0</span>;
         <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">count</span> = <span style="color: #da8548; font-weight: bold;">0</span>;

         <span style="color: #e45649;">public</span> BoundedQueue<span style="color: #a626a4;">(</span><span style="color: #986801;">int</span> <span style="color: #6a1868;">size</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span>size &gt; <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #50a14f;">)</span> <span style="color: #50a14f;">{</span>
                 <span style="color: #e45649;">this</span>.size = size;
                 rep = <span style="color: #e45649;">new</span> <span style="color: #986801;">Object</span><span style="color: #b751b6;">[</span>size<span style="color: #b751b6;">]</span>;
                 back = size - <span style="color: #da8548; font-weight: bold;">1</span>;
             <span style="color: #50a14f;">}</span>  <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">isEmpty</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> <span style="color: #50a14f;">(</span>count == <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #50a14f;">)</span>; <span style="color: #a626a4;">}</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">isFull</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> <span style="color: #50a14f;">(</span>count == size<span style="color: #50a14f;">)</span>; <span style="color: #a626a4;">}</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">getCount</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> count; <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">put</span><span style="color: #a626a4;">(</span><span style="color: #986801;">Object</span> <span style="color: #6a1868;">e</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span>e != <span style="color: #b751b6;">null</span> &amp;&amp; <span style="color: #4078f2; font-weight: bold;">!</span>isFull<span style="color: #b751b6;">()</span><span style="color: #50a14f;">)</span> <span style="color: #50a14f;">{</span>
                 back++;
                 <span style="color: #e45649;">if</span> <span style="color: #b751b6;">(</span>back &gt;= size<span style="color: #b751b6;">)</span>
                     back = <span style="color: #da8548; font-weight: bold;">0</span>;
                 rep<span style="color: #b751b6;">[</span>back<span style="color: #b751b6;">]</span> = e;
                 count++;
             <span style="color: #50a14f;">}</span> <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">Object</span> <span style="color: #a626a4;">get</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             <span style="color: #986801;">Object</span> <span style="color: #6a1868;">result</span> = <span style="color: #b751b6;">null</span>;
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span><span style="color: #4078f2; font-weight: bold;">!</span>isEmpty<span style="color: #b751b6;">()</span><span style="color: #50a14f;">)</span> <span style="color: #50a14f;">{</span>
                 result = rep<span style="color: #b751b6;">[</span>front<span style="color: #b751b6;">]</span>;
                 rep<span style="color: #b751b6;">[</span>front<span style="color: #b751b6;">]</span> = <span style="color: #b751b6;">null</span>;
                 front++;
                 <span style="color: #e45649;">if</span> <span style="color: #b751b6;">(</span>front &gt;= size<span style="color: #b751b6;">)</span>
                     front = <span style="color: #da8548; font-weight: bold;">0</span>;
                 count--;
             <span style="color: #50a14f;">}</span>
             <span style="color: #e45649;">return</span> result;
         <span style="color: #a626a4;">}</span>
         <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">String</span> <span style="color: #a626a4;">toString</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             <span style="color: #986801;">String</span> <span style="color: #6a1868;">result</span> = <span style="color: #50a14f;">"front = "</span> + front;
             result += <span style="color: #50a14f;">"; back = "</span> + back;
             result += <span style="color: #50a14f;">"; size = "</span> + size;
             result += <span style="color: #50a14f;">"; count = "</span> + count;
             result += <span style="color: #50a14f;">"; rep = ["</span>;
             <span style="color: #e45649;">for</span> <span style="color: #50a14f;">(</span><span style="color: #986801;">int</span> <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">0</span>; i &lt; rep.<span style="color: #986801;">length</span>; i++<span style="color: #50a14f;">)</span> <span style="color: #50a14f;">{</span>
                 <span style="color: #e45649;">if</span> <span style="color: #b751b6;">(</span>i &lt; rep.<span style="color: #986801;">length</span>-<span style="color: #da8548; font-weight: bold;">1</span><span style="color: #b751b6;">)</span>
                     result = result + rep<span style="color: #b751b6;">[</span>i<span style="color: #b751b6;">]</span> + <span style="color: #50a14f;">", "</span>;
                 <span style="color: #e45649;">else</span>
                     result = result + rep<span style="color: #b751b6;">[</span>i<span style="color: #b751b6;">]</span>;
             <span style="color: #50a14f;">}</span>
             <span style="color: #e45649;">return</span> result + <span style="color: #50a14f;">"]"</span>;
         <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>

</pre>
</div>


<ol class="org-ol">
<li>What is wrong with <code>toString()</code>? What needs to be done to fix it? Make it so.</li>
<li>Write some sample client code to exercise the data structure. Include some non-happy-path cases.</li>
<li>Write contracts for each method (as written), including the constructor.</li>
<li>Build a rep-invariant. Focus on the code in <code>get()</code>. There are also lots of constraints on the array indices; these are quite tricky to get right. The constructor also introduces some complexity.</li>
<li><p>
Suppose we removed the line
</p>
<div class="org-src-container">
<pre class="src src-java">        rep<span style="color: #4078f2;">[</span>front<span style="color: #4078f2;">]</span> = <span style="color: #b751b6;">null</span>;
</pre>
</div>
<p>
from <code>get()</code>.
</p>
<ol class="org-ol">
<li>Informally, why is this wrong?</li>
<li>Formally, where does the correctness proof break down?</li>
<li>Could a client ever see the problem?</li>
</ol></li>
<li>Now that we&rsquo;ve done some AF/RI analysis, what changes make the implementation better? btw - this is code straight out of a textbook.</li>
<li>Could this data structure be made immutable? If so, what would change in the contracts and method headers? What would likely change in the implementation?</li>
</ol>
</div>
</div>
<div id="outline-container-ic10" class="outline-3">
<h3 id="ic10"><span class="section-number-3">3.13.</span> In class 10</h3>
<div class="outline-text-3" id="text-ic10">
<div class="org-src-container">
<pre class="src src-java">     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Person</span> <span style="color: #4078f2;">{</span>

         <span style="color: #e45649;">public</span> <span style="color: #e45649;">enum</span> <span style="color: #986801;">Sex</span> <span style="color: #a626a4;">{</span>
             <span style="color: #6a1868;">MALE</span>, <span style="color: #6a1868;">FEMALE</span>
         <span style="color: #a626a4;">}</span>

         <span style="color: #986801;">String</span> <span style="color: #6a1868;">name</span>;
         <span style="color: #986801;">Sex</span> <span style="color: #6a1868;">gender</span>;
         <span style="color: #986801;">String</span> <span style="color: #6a1868;">emailAddress</span>;

         <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">getAge</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">...</span>
         <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">printPerson</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">...</span>
         <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>

</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="orgb52025e"></a>Approach 1: Create Methods That Search for Members That Match One Characteristic.<br />
<div class="outline-text-5" id="text-3-13-0-1">
<p>
One simplistic approach is to create several methods; each method searches for members that match one characteristic, such as gender or age. <b>Create a method that prints members that are older than a specified age</b>.
</p>

<p>
Limitation: This approach can potentially make your application brittle, which is the likelihood of an application not working because of the introduction of updates (such as newer data types). Suppose that you upgrade your application and change the structure of the Person class such that it contains different member variables; perhaps the class records and measures ages with a different data type or algorithm. You would have to rewrite a lot of your API to accommodate this change. In addition, this approach is unnecessarily restrictive; what if you wanted to print members younger than a certain age, for example?
</p>
</div>
</li>
<li><a id="org2fa4b5c"></a>Approach 2: Create More Generalized Search Methods.<br />
<div class="outline-text-5" id="text-3-13-0-2">
<p>
Create a method is more generic than the one in the previous approach. It prints members within a specified range of ages.
</p>

<p>
Limitation: What if you want to print members of a specified sex, or a combination of a specified gender and age range? What if you decide to change the Person class and add other attributes such as relationship status or geographical location? Although this method is more generic, trying to create a separate method for each possible search query can still lead to brittle code. You can instead separate the code that specifies the criteria for which you want to search in a different class.
</p>
</div>
</li>
<li><a id="orgc69bb59"></a>Approach 3: Specify Search Criteria Code in a Local Class<br />
<div class="outline-text-5" id="text-3-13-0-3">
<p>
Instead of writing filtering functions, use a new interface and class for each search you plan. Use the following filtering criteria for example:  filters members that are eligible for Selective Service in the United States: those who are male and between the ages of 18 and 25:
</p>

<p>
Limtation: Although this approach is less brittle—you don&rsquo;t have to rewrite methods if you change the structure of the Person—you still have additional code: a new interface and a local class for each search you plan to perform in your application. Because one of the class implements an interface, you can use an anonymous class instead of a local class and bypass the need to declare a new class for each search.
</p>
</div>
</li>
<li><a id="org220f65b"></a>Approach 4: Specify Search Criteria Code in an Anonymous Class<br />
<div class="outline-text-5" id="text-3-13-0-4">
<p>
Use an anonymous class to address the issue with Approach 3.
</p>

<p>
Limtation: This approach reduces the amount of code required because you don&rsquo;t have to create a new class for each search that you want to perform. However, the syntax of anonymous classes is bulky considering that the CheckPerson interface contains only one method. In this case, you can use a lambda expression instead of an anonymous class, as described in the next section.
</p>
</div>
</li>
<li><a id="orgab8fb77"></a>Approach 5: Specify Search Criteria Code with a Lambda Expression<br />
<div class="outline-text-5" id="text-3-13-0-5">
<p>
Use lambda expression to address the limitation the previous approach.
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-ic11A" class="outline-3">
<h3 id="ic11A"><span class="section-number-3">3.14.</span> In class 11A</h3>
<div class="outline-text-3" id="text-ic11A">
<p>
Given the following variable declarations, independently consider the given 6 sequences of Java instructions.
</p>
<div class="org-src-container">
<pre class="src src-java">
     <span style="color: #986801;">String</span>           <span style="color: #6a1868;">string</span> = <span style="color: #50a14f;">"bat"</span>;
     <span style="color: #986801;">Integer</span>          <span style="color: #6a1868;">x</span> = <span style="color: #da8548; font-weight: bold;">7</span>;
     <span style="color: #986801;">Object</span><span style="color: #4078f2;">[]</span>         <span style="color: #6a1868;">objects</span>;
     <span style="color: #986801;">List</span>             <span style="color: #6a1868;">rawList</span>;
     <span style="color: #986801;">List</span> <span style="color: #4078f2;">&lt;</span> <span style="color: #986801;">Object</span> <span style="color: #4078f2;">&gt;</span>  <span style="color: #6a1868;">objectList</span>;
     <span style="color: #986801;">List</span> <span style="color: #4078f2;">&lt;</span> <span style="color: #986801;">String</span> <span style="color: #4078f2;">&gt;</span>  <span style="color: #6a1868;">stringList</span>;

</pre>
</div>

<p>
Identify any code that results in a compiler error or warning.
Identify any code that raises a runtime exception.
Once a compiler error is noted, you do not need to analyze the sequence further.
</p>

<ol class="org-ol">
<li><div class="org-src-container">
<pre class="src src-java">        objects = <span style="color: #e45649;">new</span> <span style="color: #986801;">String</span><span style="color: #4078f2;">[</span><span style="color: #da8548; font-weight: bold;">1</span><span style="color: #4078f2;">]</span>;
        objects<span style="color: #4078f2;">[</span><span style="color: #da8548; font-weight: bold;">0</span><span style="color: #4078f2;">]</span> = string;
        objects<span style="color: #4078f2;">[</span><span style="color: #da8548; font-weight: bold;">0</span><span style="color: #4078f2;">]</span> = x;
</pre>
</div></li>

<li><div class="org-src-container">
<pre class="src src-java">        objects = <span style="color: #e45649;">new</span> <span style="color: #986801;">Object</span><span style="color: #4078f2;">[</span><span style="color: #da8548; font-weight: bold;">1</span><span style="color: #4078f2;">]</span>;
        objects<span style="color: #4078f2;">[</span><span style="color: #da8548; font-weight: bold;">0</span><span style="color: #4078f2;">]</span> = string;
        objects<span style="color: #4078f2;">[</span><span style="color: #da8548; font-weight: bold;">0</span><span style="color: #4078f2;">]</span> = x;
</pre>
</div></li>

<li><div class="org-src-container">
<pre class="src src-java">        stringList = <span style="color: #e45649;">new</span> <span style="color: #986801;">ArrayList</span> <span style="color: #4078f2;">&lt;</span> <span style="color: #986801;">String</span> <span style="color: #4078f2;">&gt;()</span>;
        stringList.add<span style="color: #4078f2;">(</span>string<span style="color: #4078f2;">)</span> ;
</pre>
</div></li>

<li><div class="org-src-container">
<pre class="src src-java">        objectList = <span style="color: #e45649;">new</span> <span style="color: #986801;">ArrayList</span> <span style="color: #4078f2;">&lt;</span> <span style="color: #986801;">String</span> <span style="color: #4078f2;">&gt;()</span>;
        objectList.add<span style="color: #4078f2;">(</span>string<span style="color: #4078f2;">)</span> ;
</pre>
</div></li>

<li><div class="org-src-container">
<pre class="src src-java">        objectList = <span style="color: #e45649;">new</span> <span style="color: #986801;">ArrayList</span> <span style="color: #4078f2;">&lt;</span> <span style="color: #986801;">Object</span> <span style="color: #4078f2;">&gt;()</span>;
        objectList.add<span style="color: #4078f2;">(</span>string<span style="color: #4078f2;">)</span> ;
        objectList.add<span style="color: #4078f2;">(</span>x<span style="color: #4078f2;">)</span> ;
</pre>
</div></li>

<li><div class="org-src-container">
<pre class="src src-java">        rawList = <span style="color: #e45649;">new</span> <span style="color: #986801;">ArrayList</span><span style="color: #4078f2;">()</span>;
        rawList.add<span style="color: #4078f2;">(</span>string<span style="color: #4078f2;">)</span> ;
        rawList.add<span style="color: #4078f2;">(</span>x<span style="color: #4078f2;">)</span> ;
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-ic11B" class="outline-3">
<h3 id="ic11B"><span class="section-number-3">3.15.</span> In class 11B</h3>
<div class="outline-text-3" id="text-ic11B">
<div class="org-src-container">
<pre class="src src-java">     <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Chooser - a class badly in need of generics!</span>
     <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Bloch 3rd edition, Chapter 5, Item 28:  Prefer lists to arrays</span>

     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Chooser</span> <span style="color: #4078f2;">{</span>
         <span style="color: #e45649;">private</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">Object</span><span style="color: #a626a4;">[]</span> <span style="color: #6a1868;">choiceArray</span>;

         <span style="color: #e45649;">public</span> Chooser <span style="color: #a626a4;">(</span>Collection choices<span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             choiceArray = choices.toArray<span style="color: #50a14f;">()</span>;
         <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">Object</span> <span style="color: #a626a4;">choose</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             <span style="color: #986801;">Random</span> <span style="color: #6a1868;">rnd</span> = ThreadLocalRandom.current<span style="color: #50a14f;">()</span>;
             <span style="color: #e45649;">return</span> choiceArray <span style="color: #50a14f;">[</span>rnd.nextInt<span style="color: #b751b6;">(</span>choiceArray.length<span style="color: #b751b6;">)</span><span style="color: #50a14f;">]</span>;
         <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>
</pre>
</div>


<ul class="org-ul">
<li>First, simply generify by adding a type to the Chooser class. What is the compiler error with this approach?</li>
<li>How can you turn the compiler error into a compiler warning?</li>
<li>Can this warning be suppressed? Should it?</li>
<li>How can you adopt Bloch&rsquo;s advice about arrays and lists to get a typesafe Chooser class without doing anything else that is complicated?</li>
<li>Add rep invariants and contracts (e.g., throw exceptions in unwanted cases); check if code satisfies these; and if not modify code to satisfy them. This question will take the most time!</li>
<li>Add a <code>addChoice</code> method to the API and write appropriate contracts for it</li>
</ul>
</div>
</div>
<div id="outline-container-ic11C" class="outline-3">
<h3 id="ic11C"><span class="section-number-3">3.16.</span> In class 11C</h3>
<div class="outline-text-3" id="text-ic11C">
<div class="org-src-container">
<pre class="src src-java">     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">BoundedQueue</span> <span style="color: #4078f2;">{</span>

         <span style="color: #e45649;">private</span> <span style="color: #986801;">Object</span> <span style="color: #6a1868;">rep</span><span style="color: #a626a4;">[]</span>;
         <span style="color: #e45649;">protected</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">front</span> = <span style="color: #da8548; font-weight: bold;">0</span>;
         <span style="color: #e45649;">protected</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">back</span> = -<span style="color: #da8548; font-weight: bold;">1</span>;
         <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">size</span> = <span style="color: #da8548; font-weight: bold;">0</span>;
         <span style="color: #e45649;">protected</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">count</span> = <span style="color: #da8548; font-weight: bold;">0</span>;

         <span style="color: #e45649;">public</span> BoundedQueue<span style="color: #a626a4;">(</span><span style="color: #986801;">int</span> <span style="color: #6a1868;">size</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span>size &gt; <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #50a14f;">)</span> <span style="color: #50a14f;">{</span>
                 <span style="color: #e45649;">this</span>.size = size;
                 rep = <span style="color: #e45649;">new</span> <span style="color: #986801;">Object</span><span style="color: #b751b6;">[</span>size<span style="color: #b751b6;">]</span>;
                 back = size - <span style="color: #da8548; font-weight: bold;">1</span>;
             <span style="color: #50a14f;">}</span>  <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">isEmpty</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> <span style="color: #50a14f;">(</span>count == <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #50a14f;">)</span>; <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">isFull</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> <span style="color: #50a14f;">(</span>count == size<span style="color: #50a14f;">)</span>; <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">getCount</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> count; <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">put</span><span style="color: #a626a4;">(</span><span style="color: #986801;">Object</span> <span style="color: #6a1868;">e</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span>e != <span style="color: #b751b6;">null</span> &amp;&amp; <span style="color: #4078f2; font-weight: bold;">!</span>isFull<span style="color: #b751b6;">()</span><span style="color: #50a14f;">)</span> <span style="color: #50a14f;">{</span>
                 back++;
                 <span style="color: #e45649;">if</span> <span style="color: #b751b6;">(</span>back &gt;= size<span style="color: #b751b6;">)</span>
                     back = <span style="color: #da8548; font-weight: bold;">0</span>;
                 rep<span style="color: #b751b6;">[</span>back<span style="color: #b751b6;">]</span> = e;
                 count++;
             <span style="color: #50a14f;">}</span>  <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">Object</span> <span style="color: #a626a4;">get</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             <span style="color: #986801;">Object</span> <span style="color: #6a1868;">result</span> = <span style="color: #b751b6;">null</span>;
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span><span style="color: #4078f2; font-weight: bold;">!</span>isEmpty<span style="color: #b751b6;">()</span><span style="color: #50a14f;">)</span> <span style="color: #50a14f;">{</span>
                 result = rep<span style="color: #b751b6;">[</span>front<span style="color: #b751b6;">]</span>;
                 rep<span style="color: #b751b6;">[</span>front<span style="color: #b751b6;">]</span> = <span style="color: #b751b6;">null</span>;
                 front++;
                 <span style="color: #e45649;">if</span> <span style="color: #b751b6;">(</span>front &gt;= size<span style="color: #b751b6;">)</span>
                     front = <span style="color: #da8548; font-weight: bold;">0</span>;
                 count--;
             <span style="color: #50a14f;">}</span>
             <span style="color: #e45649;">return</span> result;
         <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>

</pre>
</div>


<p>
<b>Generify</b>!
</p>
<ul class="org-ul">
<li>Can you add a <code>putAll()</code> method? A <code>getAll()</code> method?</li>
<li>Recall that we used this same example in in-class 6 as a vehicle for applying Liskov&rsquo;s ideas to make code easier to understand.</li>
</ul>
</div>
</div>
<div id="outline-container-ic12A" class="outline-3">
<h3 id="ic12A"><span class="section-number-3">3.17.</span> In class 12A</h3>
<div class="outline-text-3" id="text-ic12A">
<p>
Consider Bloch&rsquo;s <code>Point/ColorPoint</code> example. For today, ignore the <code>hashCode()</code> issue.
</p>

<div class="org-src-container">
<pre class="src src-java">
     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Point</span> <span style="color: #4078f2;">{</span>  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">routine code</span>
         <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">x</span>; <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">y</span>;
         ...
             <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> equals<span style="color: #a626a4;">(</span>Object obj<span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Standard recipe</span>
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span><span style="color: #4078f2; font-weight: bold;">!</span><span style="color: #b751b6;">(</span>obj <span style="color: #e45649;">instanceof</span> Point<span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span> <span style="color: #e45649;">return</span> <span style="color: #b751b6;">false</span>;

             <span style="color: #986801;">Point</span> <span style="color: #6a1868;">p</span> = <span style="color: #50a14f;">(</span><span style="color: #986801;">Point</span><span style="color: #50a14f;">)</span> obj;
             <span style="color: #e45649;">return</span> p.x == x &amp;&amp; p.y == y;
         <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>

     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">ColorPoint</span> <span style="color: #e45649;">extends</span> <span style="color: #986801;">Point</span> <span style="color: #4078f2;">{</span>  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">First attempt: Standard recipe</span>
         <span style="color: #e45649;">private</span> <span style="color: #986801;">COLOR</span> <span style="color: #6a1868;">color</span>;
         ...
             <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> equals<span style="color: #a626a4;">(</span>Object obj<span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span><span style="color: #4078f2; font-weight: bold;">!</span><span style="color: #b751b6;">(</span>obj <span style="color: #e45649;">instanceof</span> ColorPoint<span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span> <span style="color: #e45649;">return</span> <span style="color: #b751b6;">false</span>;

             <span style="color: #986801;">ColorPoint</span> <span style="color: #6a1868;">cp</span> = <span style="color: #50a14f;">(</span><span style="color: #986801;">ColorPoint</span><span style="color: #50a14f;">)</span> obj;
             <span style="color: #e45649;">return</span> <span style="color: #e45649;">super</span>.equals<span style="color: #50a14f;">(</span>obj<span style="color: #50a14f;">)</span> &amp;&amp; cp.color == color;
         <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>

     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">ColorPoint</span> <span style="color: #e45649;">extends</span> <span style="color: #986801;">Point</span> <span style="color: #4078f2;">{</span>  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Second attempt: DON'T DO THIS!</span>
         <span style="color: #e45649;">private</span> <span style="color: #986801;">COLOR</span> <span style="color: #6a1868;">color</span>;
         ...
             <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> equals<span style="color: #a626a4;">(</span>Object obj<span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span><span style="color: #4078f2; font-weight: bold;">!</span><span style="color: #b751b6;">(</span>o instance of Point<span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span> <span style="color: #e45649;">return</span> <span style="color: #b751b6;">false</span>;

             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">If obj is a normal Point, be colorblind</span>
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span><span style="color: #4078f2; font-weight: bold;">!</span><span style="color: #b751b6;">(</span>obj <span style="color: #e45649;">instanceof</span> ColorPoint<span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span> <span style="color: #e45649;">return</span> obj.equals<span style="color: #50a14f;">(</span><span style="color: #e45649;">this</span><span style="color: #50a14f;">)</span>;

             <span style="color: #986801;">ColorPoint</span> <span style="color: #6a1868;">cp</span> = <span style="color: #50a14f;">(</span><span style="color: #986801;">ColorPoint</span><span style="color: #50a14f;">)</span> obj;
             <span style="color: #e45649;">return</span> <span style="color: #e45649;">super</span>.equals<span style="color: #50a14f;">(</span>obj<span style="color: #50a14f;">)</span> &amp;&amp; cp.color == color;
         <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>
</pre>
</div>

<ol class="org-ol">
<li>What is the <code>equals()</code> contract? What is the standard recipe?</li>
<li>Why does Bloch use the <code>instanceof</code> operator in the standard recipe?</li>
<li>Write client code that shows a contract problem with the first attempt at <code>ColorPoint</code> (i.e., what contract does it break?)</li>
<li>Write client code that shows a contract problem with the second attempt at <code>ColorPoint</code> (i.e., what contract does it break?).</li>
<li>Some authors recommend solving this problem by using a different standard recipe for <code>equals()</code>.
<ul class="org-ul">
<li>What&rsquo;s the key difference?</li>
<li><p>
Which approach do you want in the following code:
</p>
<div class="org-src-container">
<pre class="src src-java">          <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">CounterPoint</span> <span style="color: #e45649;">extends</span> <span style="color: #986801;">Point</span>
                                            <span style="color: #e45649;">private</span> <span style="color: #e45649;">static</span> <span style="color: #e45649;">final</span> AtomicInteger counter =
                                            <span style="color: #e45649;">new</span> <span style="color: #986801;">AtomicInteger</span><span style="color: #4078f2;">()</span>;

          <span style="color: #e45649;">public</span> CounterPoint<span style="color: #4078f2;">(</span><span style="color: #986801;">int</span> <span style="color: #6a1868;">x</span>, <span style="color: #986801;">int</span> <span style="color: #6a1868;">y</span><span style="color: #4078f2;">)</span> <span style="color: #4078f2;">{</span>
              <span style="color: #e45649;">super</span> <span style="color: #a626a4;">(</span>x, y<span style="color: #a626a4;">)</span>;
              counter.incrementAndGet<span style="color: #a626a4;">()</span>;
          <span style="color: #4078f2;">}</span>
          <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">numberCreated</span><span style="color: #4078f2;">()</span> <span style="color: #4078f2;">{</span> <span style="color: #e45649;">return</span> counter.get<span style="color: #a626a4;">()</span>; <span style="color: #4078f2;">}</span>

          <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">equals</span> <span style="color: #4078f2;">(</span><span style="color: #986801;">Object</span> <span style="color: #6a1868;">obj</span><span style="color: #4078f2;">)</span> <span style="color: #4078f2;">{</span> ??? <span style="color: #4078f2;">}</span>
          <span style="color: #e45649; font-weight: bold;">}</span>


          <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Client code:</span>

          <span style="color: #986801;">Point</span> <span style="color: #6a1868;">p</span> = PointFactory.getPoint<span style="color: #e45649; font-weight: bold;">()</span>;   <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">either a Point or a CounterPoint</span>
          <span style="color: #986801;">Set</span><span style="color: #e45649; font-weight: bold;">&lt;</span><span style="color: #986801;">Point</span><span style="color: #e45649; font-weight: bold;">&gt;</span> <span style="color: #6a1868;">importantPoints</span> =   <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">a set of important points</span>
              <span style="color: #986801;">boolean</span> b = PointUtilities.isImportant<span style="color: #e45649; font-weight: bold;">(</span>p<span style="color: #e45649; font-weight: bold;">)</span>;  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">value?</span>

</pre>
</div></li>
</ul></li>
</ol>
</div>
</div>
<div id="outline-container-ic12B" class="outline-3">
<h3 id="ic12B"><span class="section-number-3">3.18.</span> In class 12B</h3>
<div class="outline-text-3" id="text-ic12B">
<p>
Consider a variation of Liskov&rsquo;s <code>IntSet</code> example (Figure 5.10, page 97)
</p>

<div class="org-src-container">
<pre class="src src-java">
     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">IntSet</span> <span style="color: #e45649;">implements</span> <span style="color: #986801;">Cloneable</span> <span style="color: #4078f2;">{</span>
         <span style="color: #e45649;">private</span> <span style="color: #986801;">List</span><span style="color: #a626a4;">&lt;</span><span style="color: #986801;">Integer</span><span style="color: #a626a4;">&gt;</span> <span style="color: #6a1868;">els</span>;
         <span style="color: #e45649;">public</span> IntSet <span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span> els = <span style="color: #e45649;">new</span> <span style="color: #986801;">ArrayList</span><span style="color: #50a14f;">&lt;</span><span style="color: #986801;">Integer</span><span style="color: #50a14f;">&gt;()</span>; <span style="color: #a626a4;">}</span>
         ...
             <span style="color: #b751b6;">@Override</span>
             <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> equals<span style="color: #a626a4;">(</span>Object obj<span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span><span style="color: #4078f2; font-weight: bold;">!</span><span style="color: #b751b6;">(</span>obj <span style="color: #e45649;">instanceof</span> IntSet<span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span> <span style="color: #e45649;">return</span> <span style="color: #b751b6;">false</span>;

             <span style="color: #986801;">IntSet</span> <span style="color: #6a1868;">s</span> = <span style="color: #50a14f;">(</span><span style="color: #986801;">IntSet</span><span style="color: #50a14f;">)</span> obj;
             <span style="color: #e45649;">return</span> ???
                 <span style="color: #a626a4;">}</span>

         <span style="color: #b751b6;">@Override</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">hashCode</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">see below</span>
         <span style="color: #a626a4;">}</span>

         <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">adding a private constructor</span>
         <span style="color: #e45649;">private</span> IntSet <span style="color: #a626a4;">(</span><span style="color: #986801;">List</span><span style="color: #50a14f;">&lt;</span><span style="color: #986801;">Integer</span><span style="color: #50a14f;">&gt;</span> <span style="color: #6a1868;">list</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span> els = list; <span style="color: #a626a4;">}</span>

         <span style="color: #b751b6;">@Override</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">IntSet</span> <span style="color: #a626a4;">clone</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">return</span> <span style="color: #e45649;">new</span> <span style="color: #986801;">IntSet</span> <span style="color: #50a14f;">(</span> <span style="color: #e45649;">new</span> <span style="color: #986801;">ArrayList</span><span style="color: #b751b6;">&lt;</span><span style="color: #986801;">Integer</span><span style="color: #b751b6;">&gt;(</span>els<span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span>;
         <span style="color: #a626a4;">}</span>

     <span style="color: #4078f2;">}</span>
</pre>
</div>

<ol class="org-ol">
<li>How should the <code>equals()</code> method be completed?</li>
<li><p>
Analyze the following ways to implement <code>hashCode()</code>? If there is a problem, give a test case that shows the problem.
</p>
<ol class="org-ol">
<li>not overridden at all</li>
</ol>

<ol class="org-ol">
<li>return 42;</li>
</ol>

<ol class="org-ol">
<li>return <code>els.hashCode()</code>;</li>
</ol>

<ol class="org-ol">
<li><code>int sum = 0; for (Integer i : els) sum += i.hashCode(); return sum;</code></li>
</ol></li>
<li>What&rsquo;s the problem with <code>clone()</code> here (something with subtyping)? Give a test case that shows the problem.</li>
<li>Fix <code>clone()</code> in two very different ways.</li>
</ol>
</div>
</div>
<div id="outline-container-ic13A" class="outline-3">
<h3 id="ic13A"><span class="section-number-3">3.19.</span> In class 13A</h3>
<div class="outline-text-3" id="text-ic13A">
<p>
Consider Bloch&rsquo;s <code>InstrumentedHashSet</code>, <code>InstrumentedSet</code>, and <code>ForwardingSet</code> examples:
</p>

<div class="org-src-container">
<pre class="src src-java">     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">InstrumentedHashSet</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">E</span><span style="color: #4078f2;">&gt;</span> <span style="color: #e45649;">extends</span> <span style="color: #986801;">HashSet</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">E</span><span style="color: #4078f2;">&gt;{</span>
         <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">addCount</span> = <span style="color: #da8548; font-weight: bold;">0</span>;
         <span style="color: #e45649;">public</span> InstrumentedHashSet<span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{}</span>

         <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">add</span><span style="color: #a626a4;">(</span><span style="color: #986801;">E</span> <span style="color: #6a1868;">e</span><span style="color: #a626a4;">){</span>
             addCount++;
             <span style="color: #e45649;">return</span> <span style="color: #e45649;">super</span>.add<span style="color: #50a14f;">(</span>e<span style="color: #50a14f;">)</span>;
         <span style="color: #a626a4;">}</span>
         <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">addAll</span><span style="color: #a626a4;">(</span><span style="color: #986801;">Collection</span><span style="color: #50a14f;">&lt;</span>? <span style="color: #e45649;">extends</span> <span style="color: #986801;">E</span><span style="color: #50a14f;">&gt;</span> <span style="color: #6a1868;">c</span><span style="color: #a626a4;">){</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">What to do with addCount?</span>
             <span style="color: #e45649;">return</span> <span style="color: #e45649;">super</span>.addAll<span style="color: #50a14f;">(</span>c<span style="color: #50a14f;">)</span>;
         <span style="color: #a626a4;">}</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">getAddCount</span><span style="color: #a626a4;">(){</span> <span style="color: #e45649;">return</span> addCount; <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>

     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">InstrumentedSet</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">E</span><span style="color: #4078f2;">&gt;</span> <span style="color: #e45649;">extends</span> <span style="color: #986801;">ForwardingSet</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">E</span><span style="color: #4078f2;">&gt;{</span>
         <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">addCount</span> = <span style="color: #da8548; font-weight: bold;">0</span>;

         <span style="color: #e45649;">public</span> InstrumentedSet<span style="color: #a626a4;">(</span><span style="color: #986801;">Set</span><span style="color: #50a14f;">&lt;</span><span style="color: #986801;">E</span><span style="color: #50a14f;">&gt;</span> <span style="color: #6a1868;">s</span><span style="color: #a626a4;">){</span> <span style="color: #e45649;">super</span><span style="color: #50a14f;">(</span>s<span style="color: #50a14f;">)</span>; <span style="color: #a626a4;">}</span>
         <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">add</span><span style="color: #a626a4;">(</span><span style="color: #986801;">E</span> <span style="color: #6a1868;">e</span><span style="color: #a626a4;">){</span> addCount++; <span style="color: #e45649;">return</span> <span style="color: #e45649;">super</span>.add<span style="color: #50a14f;">(</span>e<span style="color: #50a14f;">)</span>; <span style="color: #a626a4;">}</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">getAddCount</span><span style="color: #a626a4;">(){</span> <span style="color: #e45649;">return</span> addCount; <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>

     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">ForwardingSet</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">E</span><span style="color: #4078f2;">&gt;</span> <span style="color: #e45649;">implements</span> <span style="color: #986801;">Set</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">E</span><span style="color: #4078f2;">&gt;</span> <span style="color: #4078f2;">{</span>
         <span style="color: #e45649;">private</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">Set</span><span style="color: #a626a4;">&lt;</span><span style="color: #986801;">E</span><span style="color: #a626a4;">&gt;</span> <span style="color: #6a1868;">s</span>;

         <span style="color: #e45649;">public</span> ForwardingSet<span style="color: #a626a4;">(</span><span style="color: #986801;">Set</span><span style="color: #50a14f;">&lt;</span><span style="color: #986801;">E</span><span style="color: #50a14f;">&gt;</span> <span style="color: #6a1868;">s</span><span style="color: #a626a4;">){</span> <span style="color: #e45649;">this</span>.s = s; <span style="color: #a626a4;">}</span>
         <span style="color: #e45649;">public</span>           <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">add</span><span style="color: #a626a4;">(</span><span style="color: #986801;">E</span> <span style="color: #6a1868;">e</span><span style="color: #a626a4;">)</span>        <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> s.add<span style="color: #50a14f;">(</span>e<span style="color: #50a14f;">)</span>;     <span style="color: #a626a4;">}</span>
         <span style="color: #e45649;">public</span>           <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">remove</span><span style="color: #a626a4;">(</span><span style="color: #986801;">Object</span> <span style="color: #6a1868;">o</span><span style="color: #a626a4;">){</span> <span style="color: #e45649;">return</span> s.remove<span style="color: #50a14f;">(</span>o<span style="color: #50a14f;">)</span>;  <span style="color: #a626a4;">}</span>
         <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">equals</span><span style="color: #a626a4;">(</span><span style="color: #986801;">Object</span> <span style="color: #6a1868;">o</span><span style="color: #a626a4;">){</span> <span style="color: #e45649;">return</span> s.equals<span style="color: #50a14f;">(</span>o<span style="color: #50a14f;">)</span>;  <span style="color: #a626a4;">}</span>
         <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span>     <span style="color: #a626a4;">hashCode</span><span style="color: #a626a4;">()</span>      <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> s.hashCode<span style="color: #50a14f;">()</span>; <span style="color: #a626a4;">}</span>
         <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">String</span>  <span style="color: #a626a4;">toString</span><span style="color: #a626a4;">()</span>      <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> s.toString<span style="color: #50a14f;">()</span>; <span style="color: #a626a4;">}</span>
         <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Other forwarded methods from Set interface omitted</span>
     <span style="color: #4078f2;">}</span>
</pre>
</div>

<p>
Consider also the following client code:
</p>

<div class="org-src-container">
<pre class="src src-java">     <span style="color: #986801;">Set</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">String</span><span style="color: #4078f2;">&gt;</span> <span style="color: #6a1868;">r</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">HashSet</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">String</span><span style="color: #4078f2;">&gt;()</span>;
     r.add<span style="color: #4078f2;">(</span><span style="color: #50a14f;">"ant"</span><span style="color: #4078f2;">)</span>; r.add<span style="color: #4078f2;">(</span><span style="color: #50a14f;">"bee"</span><span style="color: #4078f2;">)</span>;

     <span style="color: #986801;">Set</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">String</span><span style="color: #4078f2;">&gt;</span> <span style="color: #6a1868;">sh</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">InstrumentedHashSet</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">String</span><span style="color: #4078f2;">&gt;()</span>;
     sh.addAll<span style="color: #4078f2;">(</span>r<span style="color: #4078f2;">)</span>;

     <span style="color: #986801;">Set</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">String</span><span style="color: #4078f2;">&gt;</span> <span style="color: #6a1868;">s</span> =  <span style="color: #e45649;">new</span> <span style="color: #986801;">InstrumentedSet</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">String</span><span style="color: #4078f2;">&gt;(</span>r<span style="color: #4078f2;">)</span>;
     s.add<span style="color: #4078f2;">(</span><span style="color: #50a14f;">"ant"</span><span style="color: #4078f2;">)</span>; s.add<span style="color: #4078f2;">(</span><span style="color: #50a14f;">"cat"</span><span style="color: #4078f2;">)</span>;

     <span style="color: #986801;">Set</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">String</span><span style="color: #4078f2;">&gt;</span> <span style="color: #6a1868;">t</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">InstrumentedSet</span><span style="color: #4078f2;">&lt;</span><span style="color: #986801;">String</span><span style="color: #4078f2;">&gt;(</span>s<span style="color: #4078f2;">)</span>;
     t.add<span style="color: #4078f2;">(</span><span style="color: #50a14f;">"dog"</span><span style="color: #4078f2;">)</span>;

     r.remove<span style="color: #4078f2;">(</span><span style="color: #50a14f;">"bee"</span><span style="color: #4078f2;">)</span>;
     s.remove<span style="color: #4078f2;">(</span><span style="color: #50a14f;">"ant"</span><span style="color: #4078f2;">)</span>;
</pre>
</div>

<ol class="org-ol">
<li>How do you think the <code>addCount</code> variable should be updated in the <code>addAll()</code> method in <code>InstrumentedHashSet</code>?
<ol class="org-ol">
<li>Why is this a hard question?</li>
<li>What does the answer say about inheritance?</li>
<li>Does <code>equals()</code> behave correctly in <code>InstrumentedHashSet?</code></li>
</ol></li>
<li>Given your previous answer, what is the value of <code>sh.addCount</code> at the end of the computation?</li>
<li>Consider the <code>InstrumentedSet</code> solution. Besides being correct (always a plus!) why is it more general than the <code>InstrumentedHashSet</code> solution?</li>
<li>At the end of the computation, what are the values of: <code>r</code>, <code>s</code>, and <code>t</code>?</li>
<li>What would a call to <code>s.getAddCount()</code> return at the end of the computation?</li>
<li>At the end of the computation, what are the values of: <code>r.equals(s)</code>, <code>s.equals(t)</code>, and <code>t.equals(s)</code>?
<ul class="org-ul">
<li>Are there any problems with the <code>equals()</code> contract?</li>
</ul></li>
</ol>

<p>
<b>Note</b>: There is a lot going on in this example. I highly recommend that you play with the code until you understand it.    
</p>
</div>
</div>
<div id="outline-container-ic13B" class="outline-3">
<h3 id="ic13B"><span class="section-number-3">3.20.</span> In class 13B</h3>
<div class="outline-text-3" id="text-ic13B">
<div class="org-src-container">
<pre class="src src-java">     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Super</span> <span style="color: #4078f2;">{</span>
         <span style="color: #e45649;">public</span> Super<span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             overrideMe<span style="color: #50a14f;">()</span>;
         <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">overrideMe</span> <span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
         <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>
     <span style="color: #e45649;">public</span> <span style="color: #e45649;">final</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Sub</span> <span style="color: #e45649;">extends</span> <span style="color: #986801;">Super</span> <span style="color: #4078f2;">{</span>

         <span style="color: #e45649;">private</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">Date</span> <span style="color: #6a1868;">date</span>;  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">filled in by constructor</span>

         <span style="color: #e45649;">public</span> Sub<span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             date = <span style="color: #e45649;">new</span> <span style="color: #986801;">Date</span><span style="color: #50a14f;">()</span>;
         <span style="color: #a626a4;">}</span>
         <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">overrideMe</span> <span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             System.out.println<span style="color: #50a14f;">(</span>date<span style="color: #50a14f;">)</span>;
         <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">main</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">String</span><span style="color: #50a14f;">[]</span> <span style="color: #6a1868;">args</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             <span style="color: #986801;">Sub</span> <span style="color: #6a1868;">sub</span> = <span style="color: #e45649;">new</span> <span style="color: #986801;">Sub</span><span style="color: #50a14f;">()</span>;
             sub.overrideMe<span style="color: #50a14f;">()</span>;
         <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>
</pre>
</div>

<ol class="org-ol">
<li>What is the pattern, and how common is it?</li>
<li>What does the main method do, and why?</li>
<li>Which of Bloch&rsquo;s rules does this example break?</li>
<li>What does this example mean for <code>Cloneable</code> interface and the <code>clone()</code> method?</li>
<li>What does this example mean for <code>Serializable</code> interface and the <code>readObject()</code> method?</li>
<li>To what extent does this rule generalize to producer methods?</li>
</ol>
</div>
</div>
<div id="outline-container-ic13C" class="outline-3">
<h3 id="ic13C"><span class="section-number-3">3.21.</span> In class 13C</h3>
<div class="outline-text-3" id="text-ic13C">
<p>
Consider a mutable complex number class:
</p>

<div class="org-src-container">
<pre class="src src-java">     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">MComplex</span> <span style="color: #4078f2;">{</span>
         <span style="color: #986801;">double</span> <span style="color: #6a1868;">re</span>; <span style="color: #e45649;">protected</span> <span style="color: #986801;">double</span> <span style="color: #6a1868;">im</span>;

         <span style="color: #e45649;">public</span> MComplex <span style="color: #a626a4;">(</span><span style="color: #986801;">double</span> <span style="color: #6a1868;">re</span>, <span style="color: #986801;">double</span> <span style="color: #6a1868;">im</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">this</span>.re = re; <span style="color: #e45649;">this</span>.im = im; <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">double</span> <span style="color: #a626a4;">getReal</span><span style="color: #a626a4;">()</span>      <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> re; <span style="color: #a626a4;">}</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">double</span> <span style="color: #a626a4;">getImaginary</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> im; <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">setReal</span><span style="color: #a626a4;">(</span><span style="color: #986801;">double</span> <span style="color: #6a1868;">re</span><span style="color: #a626a4;">)</span>      <span style="color: #a626a4;">{</span> <span style="color: #e45649;">this</span>.re = re; <span style="color: #a626a4;">}</span>
         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">setImaginary</span><span style="color: #a626a4;">(</span><span style="color: #986801;">double</span> <span style="color: #6a1868;">im</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">this</span>.im = im; <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">add</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">MComplex</span> <span style="color: #6a1868;">c</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span> re += c.re; im += c.im; <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">subtract</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">MComplex</span> <span style="color: #6a1868;">c</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span> re -= c.re; im -= c.im; <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">multiply</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">MComplex</span> <span style="color: #6a1868;">c</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             <span style="color: #986801;">double</span> <span style="color: #6a1868;">r</span> = re * c.re - im * c.im;
             <span style="color: #986801;">double</span> <span style="color: #6a1868;">i</span> = re * c.im + im * c.re;
             re = r; im = i;
         <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">divide</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">MComplex</span> <span style="color: #6a1868;">c</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             <span style="color: #986801;">double</span> <span style="color: #6a1868;">den</span> = c.re * c.re + c.im * c.im;
             <span style="color: #986801;">double</span> <span style="color: #6a1868;">r</span> = <span style="color: #50a14f;">(</span>re * c.re - im * c.im<span style="color: #50a14f;">)</span> / den;
             <span style="color: #986801;">double</span> <span style="color: #6a1868;">i</span> = <span style="color: #50a14f;">(</span>re * c.im + im * c.re<span style="color: #50a14f;">)</span> / den;
             re = r; im = i;
         <span style="color: #a626a4;">}</span>

         <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">boolean</span> <span style="color: #a626a4;">equals</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">Object</span> <span style="color: #6a1868;">o</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span>o == <span style="color: #e45649;">this</span><span style="color: #50a14f;">)</span>               <span style="color: #e45649;">return</span> <span style="color: #b751b6;">true</span>;
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span><span style="color: #4078f2; font-weight: bold;">!</span><span style="color: #b751b6;">(</span>o <span style="color: #e45649;">instanceof</span> MComplex<span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span> <span style="color: #e45649;">return</span> <span style="color: #b751b6;">false</span>;
             <span style="color: #986801;">MComplex</span> <span style="color: #6a1868;">c</span> = <span style="color: #50a14f;">(</span><span style="color: #986801;">MComplex</span><span style="color: #50a14f;">)</span> o;

             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">See Bloch page 43 to find out why to use compare() instead of ==</span>
             <span style="color: #e45649;">return</span> Double.compare<span style="color: #50a14f;">(</span>re, c.re<span style="color: #50a14f;">)</span> == <span style="color: #da8548; font-weight: bold;">0</span> &amp;&amp;
                 Double.compare<span style="color: #50a14f;">(</span>im, c.im<span style="color: #50a14f;">)</span> == <span style="color: #da8548; font-weight: bold;">0</span>;
         <span style="color: #a626a4;">}</span>

         <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">hashCode</span> <span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             <span style="color: #986801;">int</span> <span style="color: #6a1868;">result</span> = <span style="color: #da8548; font-weight: bold;">17</span> + hashDouble<span style="color: #50a14f;">(</span>re<span style="color: #50a14f;">)</span>;
             result = <span style="color: #da8548; font-weight: bold;">31</span> * result + hashDouble<span style="color: #50a14f;">(</span>im<span style="color: #50a14f;">)</span>;
             <span style="color: #e45649;">return</span> result;
         <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">hashDouble</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">double</span> <span style="color: #6a1868;">val</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             <span style="color: #986801;">long</span> <span style="color: #6a1868;">longBits</span> = Double.doubleToLongBits<span style="color: #50a14f;">(</span>val<span style="color: #50a14f;">)</span>;
             <span style="color: #e45649;">return</span> <span style="color: #50a14f;">(</span><span style="color: #986801;">int</span><span style="color: #50a14f;">)</span> <span style="color: #50a14f;">(</span>longBits ^ <span style="color: #b751b6;">(</span>longBits &gt;&gt;&gt;<span style="color: #da8548; font-weight: bold;">32</span><span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span>;
         <span style="color: #a626a4;">}</span>

         <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">String</span> <span style="color: #a626a4;">toString</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> <span style="color: #50a14f;">"("</span> + re + <span style="color: #50a14f;">" + "</span> + im + <span style="color: #50a14f;">"i)"</span>; <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>

</pre>
</div>

<p>
Before we get to immutability, consider the method contracts. Where do the various contracts &ldquo;come from&rdquo;, and is there anything in the (missing) JavaDoc that might require a bit of research?
</p>

<p>
Apply each of Bloch&rsquo;s 5 rules for making a class immutable:
</p>
<ol class="org-ol">
<li>Don&rsquo;t provide any methods that modify the object&rsquo;s state. How do you handle the mutators?</li>
<li>Ensure that no methods can be overridden.
<ul class="org-ul">
<li>Why is this a problem? Show me!</li>
<li>Fix the problem:
<ul class="org-ul">
<li>Change the class declaration, or</li>
<li>Change the method declarations, or</li>
<li>Change the constructor visibility.</li>
</ul></li>
</ul></li>
<li>Make all fields final.</li>
<li>Make all fields private.
<ul class="org-ul">
<li>Is there a significant difference in visibility between re and im?</li>
</ul></li>
<li>Ensure exclusive access to any mutable components.</li>
</ol>
</div>
</div>
<div id="outline-container-ic14" class="outline-3">
<h3 id="ic14"><span class="section-number-3">3.22.</span> In class 14</h3>
<div class="outline-text-3" id="text-ic14">
<p>
This is a JUnit theory exercise.
</p>

<ol class="org-ol">
<li>Write a JUnit theory that captures the symmetry property of the <code>equals()</code> method.
<ol class="org-ol">
<li>Create <code>@DataPoints</code> from Bloch&rsquo;s <code>Point</code>, <code>ColorPoint</code> classes. So that we&rsquo;re all on the same page, create 1 <code>null</code> reference, 1 <code>Point</code> object and 2 <code>ColorPoint</code> objects.</li>
<li>Given this set of data points:
<ul class="org-ul">
<li>How many combinations are considered by the theory?</li>
<li>How many combinations make it past the preconditions of the theory?</li>
<li>How many combinations make it to the postcondition of the theory?</li>
</ul></li>
</ol></li>
<li>Repeat the exercise for the transitive property for <code>equals()</code>.</li>
<li>Recall the <code>equals()</code> and <code>hashCode()</code> discussion in Bloch. Write a JUnit theory that encodes the consistency property between <code>equals()</code> and <code>hashCode()</code>.</li>
</ol>
</div>
</div>
<div id="outline-container-ic15A" class="outline-3">
<h3 id="ic15A"><span class="section-number-3">3.23.</span> In class 15A</h3>
<div class="outline-text-3" id="text-ic15A">
<p>
Consider the following (bad) Java, implementing the &ldquo;C style&rdquo; enum pattern:
</p>

<div class="org-src-container">
<pre class="src src-java">     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Coins</span> <span style="color: #4078f2;">{</span>
         <span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">PENNY</span> = <span style="color: #da8548; font-weight: bold;">1</span>;
         <span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">NICKLE</span> = <span style="color: #da8548; font-weight: bold;">5</span>;
         <span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">DIME</span> = <span style="color: #da8548; font-weight: bold;">10</span>;
         <span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #e45649;">final</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">QUARTER</span> = <span style="color: #da8548; font-weight: bold;">25</span>;
     <span style="color: #4078f2;">}</span>

</pre>
</div>

<ol class="org-ol">
<li>Give example code that illustrates a type safety problem with <code>Coins</code>. Work through a range of expressions from &ldquo;probably ok&rdquo; to &ldquo;clearly wrong&rdquo;.</li>
<li>What code would you need to turn a nickel into a string? Explain how this could go wrong at runtime.</li>
<li>What code would you need to iterate through the coins?</li>
<li>Would extensions to this particular enum be likely to require recompilation of client code? Explain.</li>
<li>Write a decent Java Enum for coins.</li>
<li>Turn a nickle into a string.</li>
<li>Iterate though the coins.</li>
</ol>


<p>
Consider Bloch&rsquo;s example:
</p>

<div class="org-src-container">
<pre class="src src-java">     <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Abuse of ordinal to derive an associated value &#8211; DON&#8217;T DO THIS</span>
     <span style="color: #e45649;">public</span> <span style="color: #e45649;">enum</span> <span style="color: #986801;">Ensemble</span> <span style="color: #4078f2;">{</span>
         <span style="color: #6a1868;">SOLO</span>,   <span style="color: #6a1868;">DUET</span>,   <span style="color: #6a1868;">TRIO</span>,  <span style="color: #6a1868;">QUARTET</span>, <span style="color: #6a1868;">QUINTET</span>, 
         <span style="color: #6a1868;">SEXTET</span>, <span style="color: #6a1868;">SEPTET</span>, <span style="color: #6a1868;">OCTET</span>, <span style="color: #6a1868;">NONET</span>,   <span style="color: #6a1868;">DECTET</span>;

         <span style="color: #e45649;">public</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">numberOfMusicians</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">return</span> ordinal<span style="color: #50a14f;">()</span> + <span style="color: #da8548; font-weight: bold;">1</span>; <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>
</pre>
</div>

<p>
Explain why it&rsquo;s wrong, fix it, and add another enum with an overlapping number of musicians.
</p>
</div>
</div>
<div id="outline-container-ic15B" class="outline-3">
<h3 id="ic15B"><span class="section-number-3">3.24.</span> In class 15B</h3>
<div class="outline-text-3" id="text-ic15B">
<p>
This is a recap exercise based on the map-based implementation of Liskov&rsquo;s polynomial example: <a href="./files/MapPoly.java">MapPoly</a>
</p>

<ol class="org-ol">
<li>How are the following polynomials represented?
<ul class="org-ul">
<li>\(0\)</li>
<li>\(3-7x^4\)</li>
</ul></li>
<li>Bloch would not accept that the <code>MapPoly</code> class is immutable. Why not? Show how it would be possible to provide mutable behavior with the class if Bloch&rsquo;s problem isn&rsquo;t fixed. Fix the problem, and implement any other changes Bloch suggests, even if they don&rsquo;t compromise immutability in this particular example.</li>
<li>Write a reasonable rep-invariant for <code>MapPoly</code>.</li>
<li>Provide reasonable implementations of <code>equals()</code> and <code>hashCode()</code>. Explain why you believe your implemetations are appropriate.</li>
<li>As written, the <b>contract</b> for the <code>coeff()</code> method is inconsistent with other contracts in the class.
<ul class="org-ul">
<li>What is the inconsistency with the contract?</li>
<li>Fix the inconsistency with the contract.</li>
<li>Fix the code to match the revised contract.</li>
</ul></li>
<li>Argue that the implementation of the <code>coeff()</code> method is correct (with respect to your repaired contract, of course.)</li>
<li>Consider implementing <code>Cloneable</code> for this class. Decide whether Bloch would think this is a good idea and provide justification for your answer. Note: You don&rsquo;t have to actually implement anything for this question.</li>
<li>See if you can come up with a theory about <code>Polys</code> and implement it in JUnit. (<code>Polys</code> are math objects, so there should be properties that you can specified as theories to test!) Here&rsquo;s a suggestion: Think about the relationship between the degrees of two Polys being multiplied and the resulting degree.</li>
</ol>
</div>
</div>
<div id="outline-container-ic16" class="outline-3">
<h3 id="ic16"><span class="section-number-3">3.25.</span> In class 16</h3>
<div class="outline-text-3" id="text-ic16">
<p>
How well are you prepared for the final? This exercise should help you find out. Piazza discussions encouraged!
</p>

<div class="org-src-container">
<pre class="src src-java">
     <span style="color: #e45649;">public</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">Stack</span> <span style="color: #4078f2;">{</span>
         <span style="color: #e45649;">private</span> <span style="color: #986801;">Object</span><span style="color: #a626a4;">[]</span> <span style="color: #6a1868;">elements</span>; <span style="color: #e45649;">private</span> <span style="color: #986801;">int</span> <span style="color: #6a1868;">size</span> = <span style="color: #da8548; font-weight: bold;">0</span>;

         <span style="color: #e45649;">public</span> Stack<span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">this</span>.elements = <span style="color: #e45649;">new</span> <span style="color: #986801;">Object</span><span style="color: #50a14f;">[</span><span style="color: #da8548; font-weight: bold;">0</span><span style="color: #50a14f;">]</span>; <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">push</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">Object</span> <span style="color: #6a1868;">e</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span>e == <span style="color: #b751b6;">null</span><span style="color: #50a14f;">)</span> <span style="color: #e45649;">throw</span> <span style="color: #e45649;">new</span> <span style="color: #986801;">NullPointerException</span><span style="color: #50a14f;">(</span><span style="color: #50a14f;">"Stack.push"</span><span style="color: #50a14f;">)</span>;
             ensureCapacity<span style="color: #50a14f;">()</span>; elements<span style="color: #50a14f;">[</span>size++<span style="color: #50a14f;">]</span> = e;  
         <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">pushAll</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">Object</span><span style="color: #50a14f;">[]</span> <span style="color: #6a1868;">collection</span><span style="color: #a626a4;">)</span> <span style="color: #a626a4;">{</span> <span style="color: #e45649;">for</span> <span style="color: #50a14f;">(</span><span style="color: #986801;">Object</span> <span style="color: #6a1868;">obj</span>: collection<span style="color: #50a14f;">)</span> <span style="color: #50a14f;">{</span> push<span style="color: #b751b6;">(</span>obj<span style="color: #b751b6;">)</span>; <span style="color: #50a14f;">}</span> <span style="color: #a626a4;">}</span>

         <span style="color: #e45649;">public</span> <span style="color: #986801;">Object</span> <span style="color: #a626a4;">pop</span> <span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             <span style="color: #e45649;">if</span> <span style="color: #50a14f;">(</span>size == <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #50a14f;">)</span> <span style="color: #e45649;">throw</span> <span style="color: #e45649;">new</span> <span style="color: #986801;">IllegalStateException</span><span style="color: #50a14f;">(</span><span style="color: #50a14f;">"Stack.pop"</span><span style="color: #50a14f;">)</span>;
             <span style="color: #986801;">Object</span> <span style="color: #6a1868;">result</span> = elements<span style="color: #50a14f;">[</span>--size<span style="color: #50a14f;">]</span>;
             elements<span style="color: #50a14f;">[</span>size<span style="color: #50a14f;">]</span> = <span style="color: #b751b6;">null</span>;
             <span style="color: #e45649;">return</span> result;
         <span style="color: #a626a4;">}</span>

         <span style="color: #b751b6;">@Override</span> <span style="color: #e45649;">public</span> <span style="color: #986801;">String</span> <span style="color: #a626a4;">toString</span><span style="color: #a626a4;">()</span> <span style="color: #a626a4;">{</span>
             <span style="color: #986801;">String</span> <span style="color: #6a1868;">result</span> = <span style="color: #50a14f;">"size = "</span> + size;
             result += <span style="color: #50a14f;">"; elements = ["</span>;
             <span style="color: #e45649;">for</span> <span style="color: #50a14f;">(</span><span style="color: #986801;">int</span> <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">0</span>; i &lt; elements.<span style="color: #986801;">length</span>; i++<span style="color: #50a14f;">)</span> <span style="color: #50a14f;">{</span>
                 <span style="color: #e45649;">if</span> <span style="color: #b751b6;">(</span>i &lt; elements.<span style="color: #986801;">length</span>-<span style="color: #da8548; font-weight: bold;">1</span><span style="color: #b751b6;">)</span>
                     result = result + elements<span style="color: #b751b6;">[</span>i<span style="color: #b751b6;">]</span> + <span style="color: #50a14f;">", "</span>;
                 <span style="color: #e45649;">else</span>
                     result = result + elements<span style="color: #b751b6;">[</span>i<span style="color: #b751b6;">]</span>;
             <span style="color: #50a14f;">}</span>
             <span style="color: #e45649;">return</span> result + <span style="color: #50a14f;">"]"</span>;
         <span style="color: #a626a4;">}</span>
     <span style="color: #4078f2;">}</span>


</pre>
</div>

<ol class="org-ol">
<li>Write a contract for <code>push(Object e)</code>.</li>
<li>What is wrong with <code>toString()?</code> Fix it.</li>
<li>What rep-invariant is likely broken? Fix it. This includes writing a suitable rep-invariant.</li>
<li>How would Bloch&rsquo;s Item 25: <i>Prefer Lists to Arrays</i> apply here? Would it make the rep-invariant simpler?</li>
<li>How would you argue that that <code>pop()</code> is correct (or not)?</li>
<li>What is the problem with <code>pushAll()</code> ?  why a contract for it.  What would Bloch suggest as an alternative?</li>
<li>Override <code>equals()</code> (for both cases when elements is Array and ArrayList). What else do you have to do? Do that too.</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgc7a97d1" class="outline-2">
<h2 id="orgc7a97d1"><span class="section-number-2">4.</span> HW Assignments</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-a1" class="outline-3">
<h3 id="a1"><span class="section-number-3">4.1.</span> Assignment 1</h3>
<div class="outline-text-3" id="text-a1">
</div>
<div id="outline-container-orgfbff5ee" class="outline-4">
<h4 id="orgfbff5ee"><span class="section-number-4">4.1.1.</span> Goal</h4>
<div class="outline-text-4" id="text-4-1-1">
<ul class="org-ul">
<li>Getting started on Piazza.</li>
<li>Getting your group together.</li>
</ul>

<p>
There are two parts to this assignment:
</p>

<ul class="org-ul">
<li>Post a brief intro about yourself on the course Piazza page. For any credit, the posting must:
<ul class="org-ul">
<li>be a follow-up to my introduction. In other words, all intros need to be in the same thread.</li>
<li>Include a photo appropriate in size, content, and orientation.</li>
</ul></li>
<li>Your <b>group</b> should communicate the composition of your group to me (and the GTA) on Piazza.</li>
</ul>
</div>
</div>
<div id="outline-container-org896d561" class="outline-4">
<h4 id="org896d561"><span class="section-number-4">4.1.2.</span> Grading Criteria</h4>
<div class="outline-text-4" id="text-4-1-2">
<ul class="org-ul">
<li>Your individual Piazza post adheres to my instructions. (That is, no sideways pictures, no oversize pictures, etc.)</li>
<li>You are in a group.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-a2" class="outline-3">
<h3 id="a2"><span class="section-number-3">4.2.</span> Assignment 2</h3>
<div class="outline-text-3" id="text-a2">
</div>
<div id="outline-container-org10e39f7" class="outline-4">
<h4 id="org10e39f7"><span class="section-number-4">4.2.1.</span> Goals: Contracts</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
For the second assignment, you&rsquo;ll build a <i>very</i> small piece of Java for a contract with preconditions, transform the contract so that all preconditions become postconditions (i.e., make it a <i>total</i> contract), and then re-implement appropriately.
</p>

<ul class="org-ul">
<li>Consider a method that calculates the number of months needed to pay off a loan of a given size at a fixed <i>annual</i> interest rate and a fixed <i>monthly</i> payment. For instance, a $100,000 loan at an 8% annual rate would take 166 months to discharge at a monthly payment of $1,000, and 141 months to discharge at a monthly payment of $1,100. (In both of these cases, the final payment is smaller than the others; I rounded 165.34 up to 166 and 140.20 up to 141.) Continuing the example, the loan would never be paid off at a monthly payment of $100, since the principal would grow rather than shrink.</li>
</ul>

<p>
Define a Java class called <code>Loan</code>. In that class, write a method that satisfies the following specification:
</p>

<div class="org-src-container">
<pre class="src src-java">      <span style="color: #9ca0a4;">/*</span>
<span style="color: #9ca0a4;">        @param principal:  Amount of the initial principal</span>
<span style="color: #9ca0a4;">        @param rate:       Annual interest rate  (8% rate expressed as rate = 0.08)</span>
<span style="color: #9ca0a4;">        @param payment:    Amount of the monthly payment</span>
<span style="color: #9ca0a4;">      */</span>
      <span style="color: #e45649;">public</span> <span style="color: #e45649;">static</span> <span style="color: #986801;">int</span> <span style="color: #a626a4;">months</span> <span style="color: #4078f2;">(</span><span style="color: #986801;">int</span> <span style="color: #6a1868;">principal</span>, <span style="color: #986801;">double</span> <span style="color: #6a1868;">rate</span>, <span style="color: #986801;">int</span> <span style="color: #6a1868;">payment</span><span style="color: #4078f2;">)</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Requires: principal, rate, and payment all positive and payment is sufficiently large to drive the principal to zero.</span>
      <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Effects:  return the number of months required to pay off the principal</span>
</pre>
</div>


<p>
Note that the precondition is quite strong, which makes implementing the method easy. You should use double precision arithmetic internally, but the final result is an integer, not a floating point value. The key step in your calculation is to change the principal on each iteration with the following formula (which amounts to monthly compounding):
</p>

<div class="org-src-container">
<pre class="src src-java">      newPrincipal = oldPrincipal * <span style="color: #4078f2;">(</span><span style="color: #da8548; font-weight: bold;">1</span> + monthlyInterestRate<span style="color: #4078f2;">)</span> - payment;
</pre>
</div>


<p>
The variable names here are explanatory, not required. You may want to use different variables, which is fine.
</p>

<p>
<b>To make sure you understand the point about preconditions, your code is required to be minimal. Specifically, if it possible to delete parts of your implementation and still have it satisfy the requirements, you&rsquo;ll earn less than full credit.</b>
</p>

<ul class="org-ul">
<li>Now modify <code>months</code> so that it handles <b>all</b> of its preconditions with exceptions. Use the standard exceptions recommended by Bloch. Document this with a revised contract. You can use JavaDoc or you can simply identify the postconditions.</li>
</ul>
</div>
</div>
<div id="outline-container-org6d5555c" class="outline-4">
<h4 id="org6d5555c"><span class="section-number-4">4.2.2.</span> Grading Criteria</h4>
<div class="outline-text-4" id="text-4-2-2">
<ul class="org-ul">
<li>Adherence to instructions.</li>
<li>Minimal implementation.</li>
<li>Preconditions are correctly converted to exceptions.</li>
<li>Syntax: Java compiles and runs.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-a4" class="outline-3">
<h3 id="a4"><span class="section-number-3">4.3.</span> Assignment 4</h3>
<div class="outline-text-3" id="text-a4">
</div>
<div id="outline-container-org145337e" class="outline-4">
<h4 id="org145337e"><span class="section-number-4">4.3.1.</span> Goals: Understanding Program Verification through Hoare Logic</h4>
<div class="outline-text-4" id="text-4-3-1">
<ol class="org-ol">
<li>Do the <a href="#ic4">in-class exercise</a> with your group and submit it on BB. More specifically, you will do the below two tasks:
<ol class="org-ol">
<li>Prove the program using the following the loop invariant:  <code>i &lt;= N</code>.
<ol class="org-ol">
<li>Clearly reason why this is a loop invariant</li>
<li>Compute the weakest precondition <code>wp</code> of the program wrt the post conditiong <code>Q</code></li>
<li>Compute the verification condition <code>vc (P =&gt; wp(..))</code>, and</li>
<li>Analyze the <code>vc</code> to dertermine whether the program is proved or not</li>
</ol></li>
<li>Repeat the above task a different loop invariant:  <code>N &gt;= 0</code></li>
</ol></li>
<li><p>
Given the program
</p>
<div class="org-src-container">
<pre class="src src-java">     <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">{x &lt;= 1}   # P1</span>
     <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">{x &lt;= 11}  # P2</span>

     <span style="color: #e45649;">while</span> <span style="color: #4078f2;">(</span>x != <span style="color: #da8548; font-weight: bold;">10</span><span style="color: #4078f2;">){</span>
         <span style="color: #b751b6;">x</span> := x + <span style="color: #da8548; font-weight: bold;">1</span>;
     <span style="color: #4078f2;">}</span>

     <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">{x == 10}  # Q</span>
</pre>
</div>
<ol class="org-ol">
<li>Informally reason that this program is correct with the given <code>P1</code> and <code>Q</code>.</li>
<li>This program <b>is correct</b> with respect to the given precondition <code>P1</code> and postcondition <code>Q</code>.  Prove it by finding a loop invariant and verify the verification condition (show your work, i.e., generate the <code>wp</code> and the <code>vc</code> of the program, and reason about these)</li>
<li>Now, consider a different precondition <code>P2</code>.
<ol class="org-ol">
<li>Recompute the VC of the program with respect to <code>P2</code>.</li>
<li>is the VC  <code>P2 -&gt; WP ..</code>  valid?  if yes, what does that mean,  if not, what does that mean?</li>
</ol></li>
</ol></li>
</ol>
</div>
</div>
<div id="outline-container-org6c0c076" class="outline-4">
<h4 id="org6c0c076"><span class="section-number-4">4.3.2.</span> Grading Criteria</h4>
<div class="outline-text-4" id="text-4-3-2">
<ul class="org-ul">
<li>Correctness of solution</li>
</ul>
<p>
Note: If your group had trouble with the assignment, feel free to appeal to your classmates to post a sample solution on Piazza.
</p>
</div>
</div>
</div>
<div id="outline-container-a5" class="outline-3">
<h3 id="a5"><span class="section-number-3">4.4.</span> Assignment 5</h3>
<div class="outline-text-3" id="text-a5">
</div>
<div id="outline-container-org5199c0b" class="outline-4">
<h4 id="org5199c0b"><span class="section-number-4">4.4.1.</span> Goals: Data Abstraction / Mutability</h4>
<div class="outline-text-4" id="text-4-4-1">
<p>
Rewrite <a href="./files/MapPoly.java">MapPoly</a>, my map-based version Liskov&rsquo;s Poly so that it is <i>mutable</i>. Keep the same representation.
</p>

<p>
Rewrite the overview, the method signatures, the method specifications, and the methods themselves. You do not need to rewrite the abstraction function and representation invariant for this exercise.
</p>

<p>
Turn in a <b>story</b>. This means that it is possible to grade your assignment simply by reading it, as if it were part of a textbook. In particular, every place you make a decision to change something in the code (or not), you should have a description of what you did (or didn&rsquo;t do) and why you did (or didn&rsquo;t do) it.
</p>

<p>
Remember that part of your group is responsible for synthesizing a solution, and part of your group is responsible for checking the result.
</p>
</div>
</div>
<div id="outline-container-org2f569ee" class="outline-4">
<h4 id="org2f569ee"><span class="section-number-4">4.4.2.</span> Grading Criteria</h4>
<div class="outline-text-4" id="text-4-4-2">
<ul class="org-ul">
<li>Correct transformation of Poly</li>
<li>Clarity of your story.</li>
<li>Reasonable division of synthesis vs. checking.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-a6" class="outline-3">
<h3 id="a6"><span class="section-number-3">4.5.</span> Assignment 6</h3>
<div class="outline-text-3" id="text-a6">
</div>
<div id="outline-container-org2fdd09a" class="outline-4">
<h4 id="org2fdd09a"><span class="section-number-4">4.5.1.</span> Goals: Rep-Invariants, contracts, tests</h4>
<div class="outline-text-4" id="text-4-5-1">
<p>
Revisit the mutable Poly example from <a href="#a5">assignment 5</a>. That is, use the one based on a map, not an array.
</p>

<ol class="org-ol">
<li>Implement <code>repOk()</code>.</li>
<li>Introduce a fault (i.e. &ldquo;bug&rdquo;) that breaks the rep-invariant. Try to do this with a small (conceptual) change to the code. Show that the rep-invariant is broken with a JUnit test.</li>
<li>Analyzed your bug with respect to the various contracts/methods in Poly. Are all/some/none of the contracts violated?</li>
<li>Do you think your fault is realistic? Why or why not?</li>
</ol>

<p>
As in assignment 3, your deliverable is a <b>story</b>, with exactly the same rationale. Take screenshots (e.g. of failing JUnit tests) as necessary to make your case.
</p>
</div>
</div>
<div id="outline-container-orgb2a2292" class="outline-4">
<h4 id="orgb2a2292"><span class="section-number-4">4.5.2.</span> Grading Criteria</h4>
<div class="outline-text-4" id="text-4-5-2">
<ul class="org-ul">
<li>Correctness of solution</li>
<li>Clarity of story</li>
</ul>
<p>
Note: If your group had trouble with the previous assignment, feel free to appeal to your classmates to post a sample solution on Piazza.
</p>
</div>
</div>
</div>
<div id="outline-container-a8" class="outline-3">
<h3 id="a8"><span class="section-number-3">4.6.</span> Assignment 8</h3>
<div class="outline-text-3" id="text-a8">
</div>
<div id="outline-container-org927881d" class="outline-4">
<h4 id="org927881d"><span class="section-number-4">4.6.1.</span> Goals: Type Abstraction</h4>
<div class="outline-text-4" id="text-4-6-1">
<p>
Consider the following <code>Market</code> class.
</p>

<div class="org-src-container">
<pre class="src src-java">
      <span style="color: #e45649;">class</span> <span style="color: #986801;">Market</span> <span style="color: #4078f2;">{</span>
          <span style="color: #e45649;">private</span> <span style="color: #986801;">Set</span><span style="color: #a626a4;">&lt;</span><span style="color: #986801;">Item</span><span style="color: #a626a4;">&gt;</span> <span style="color: #6a1868;">wanted</span>;           <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">items for which prices are of interest</span>
          <span style="color: #e45649;">private</span> <span style="color: #986801;">Bag</span><span style="color: #a626a4;">&lt;</span><span style="color: #986801;">Item</span>, <span style="color: #986801;">Money</span><span style="color: #a626a4;">&gt;</span> <span style="color: #6a1868;">offers</span>;    <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">offers to sell items at specific prices</span>
          <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Note:  Bag isn't a Java data type.  Here, the bag entries are pairs.</span>

          <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">offer</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">Item</span> <span style="color: #6a1868;">item</span>, <span style="color: #986801;">Money</span> <span style="color: #6a1868;">price</span><span style="color: #a626a4;">)</span>
          <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Requires: item is an element of wanted</span>
          <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Effects:  add (item, price) to offers</span>

              <span style="color: #e45649;">public</span> Money buy<span style="color: #a626a4;">(</span>Item item<span style="color: #a626a4;">)</span>
          <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Requires: item is an element of the domain of offers</span>
          <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Effects: choose and remove some (arbitrary) pair (item, price) from</span>
          <span style="color: #9ca0a4;">//          </span><span style="color: #9ca0a4;">offers and return the chosen price</span>
              <span style="color: #4078f2;">}</span>

</pre>
</div>

<ol class="org-ol">
<li><p>
Suppose that offers are only accepted if they are lower than previous offers.
</p>
<div class="org-src-container">
<pre class="src src-java">         <span style="color: #e45649;">class</span> <span style="color: #986801;">Low_Bid_Market</span> <span style="color: #e45649;">extends</span> <span style="color: #986801;">Market</span> <span style="color: #4078f2;">{</span>
             <span style="color: #e45649;">public</span> <span style="color: #986801;">void</span> <span style="color: #a626a4;">offer</span> <span style="color: #a626a4;">(</span><span style="color: #986801;">Item</span> <span style="color: #6a1868;">item</span>, <span style="color: #986801;">Money</span> <span style="color: #6a1868;">price</span><span style="color: #a626a4;">)</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Requires: item is an element of wanted</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Effects:  if (item, price) is not cheaper than any existing pair</span>
             <span style="color: #9ca0a4;">//           </span><span style="color: #9ca0a4;">(item, existing_price) in offers do nothing</span>
             <span style="color: #9ca0a4;">//           </span><span style="color: #9ca0a4;">else add (item, price) to offers</span>

</pre>
</div>
<p>
Is <code>Low_Bid_Market</code> a valid subtype of <code>Market</code>? Appeal to the methods rule to back up your answer.
</p></li>

<li><p>
Suppose that the <code>buy()</code> method always chooses the lowest price on an item.
</p>
<div class="org-src-container">
<pre class="src src-java">         <span style="color: #e45649;">class</span> <span style="color: #986801;">Low_Offer_Market</span> <span style="color: #e45649;">extends</span> <span style="color: #986801;">Market</span> <span style="color: #4078f2;">{</span>
             <span style="color: #e45649;">public</span> <span style="color: #986801;">Money</span> <span style="color: #a626a4;">buy</span><span style="color: #a626a4;">(</span><span style="color: #986801;">Item</span> <span style="color: #6a1868;">item</span><span style="color: #a626a4;">)</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Requires: item is an element the domain of offers</span>
             <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Effects: choose and remove pair (item, price) with the </span>
             <span style="color: #9ca0a4;">//          </span><span style="color: #9ca0a4;">lowest price from offers and return the chosen price</span>
</pre>
</div>
<p>
Is <code>Low_Offer_Market</code> a valid subtype of <code>Market</code>? Appeal to the methods rule to back up your answer.
</p></li>
</ol>
</div>
</div>
<div id="outline-container-org6d8ecd2" class="outline-4">
<h4 id="org6d8ecd2"><span class="section-number-4">4.6.2.</span> Grading Criteria</h4>
<div class="outline-text-4" id="text-4-6-2">
<p>
This is purely a &ldquo;paper and pencil&rdquo; exercise. No code is required. Write your answer so that it is easily understandable by someone with only a passing knowledge of Liskov&rsquo;s rules for subtypes.
</p>
</div>
</div>
</div>
<div id="outline-container-a9" class="outline-3">
<h3 id="a9"><span class="section-number-3">4.7.</span> Assignment 9</h3>
<div class="outline-text-3" id="text-a9">
</div>
<div id="outline-container-org0b3fa08" class="outline-4">
<h4 id="org0b3fa08"><span class="section-number-4">4.7.1.</span> Goals: Polymorphic Abstraction.</h4>
<div class="outline-text-4" id="text-4-7-1">
<p>
A <code>Comparator</code> based on absolute values is problematic. Code up the comparator and then write client code that illustrates the problem. Use a <i>lambda function</i> to implement the comparator. Explain what is wrong in a brief summary statement. Your explanation of the problem must be phrased in terms of a violation of the contract for <code>Comparator</code>.
</p>

<p>
To emphasize that this contract problem is real, your code should create two Java sets, one a <code>HashSet</code>, and the other a <code>TreeSet</code>. The <code>TreeSet</code> should order items with your absolute value comparator. Your example should add the same integers to both sets, yet still end up with sets that are different. Your summary statement should explain why.
</p>
</div>
</div>
<div id="outline-container-org15d91cd" class="outline-4">
<h4 id="org15d91cd"><span class="section-number-4">4.7.2.</span> Grading Criteria</h4>
<div class="outline-text-4" id="text-4-7-2">
<p>
As for other recent assignments, your deliverable is a clear, concise story that demonstrates completion of the assignment.
</p>
</div>
</div>
</div>
<div id="outline-container-a10" class="outline-3">
<h3 id="a10"><span class="section-number-3">4.8.</span> Assignment 10</h3>
<div class="outline-text-3" id="text-a10">
</div>
<div id="outline-container-orgd27ffe2" class="outline-4">
<h4 id="orgd27ffe2"><span class="section-number-4">4.8.1.</span> Goals: Generics</h4>
<div class="outline-text-4" id="text-4-8-1">
<p>
Consider the <a href="./files/BoundedQueue.java">BoundedQueue</a> example from the in-class exercise given <a href="#ic11C">3.16</a>.
</p>

<p>
Complete the generic part of the exercise: The result should be fully generic, and there should not be any compiler warnings. You should adopt Bloch&rsquo;s advice about lists vs. arrays; doing so will eliminate the need for many of the instance variables.
</p>

<p>
Keep the same methods, but update the behavior (and document with contracts!) to include exception handling for all cases not on the happy path.
</p>

<p>
Include the constructor in your considerations. In particular, consider whether you think a zero-sized buffer is a reasonable possibility. Document your reasoning. This is less about a right vs. wrong answer than a careful consideration of the consequences of the decision.
</p>

<p>
Add <code>putAll()</code> and <code>getAll()</code>. Define the method signatures carefully. Use exception-handling consistent with that for <code>get()</code> and <code>put()</code>. Use bounded wildcards as appropriate. Note that <code>putAll()</code> has a special case where there isn&rsquo;t sufficient space in the bounded queue. Adopt a solution you think Bloch and/or Liskov would approve of. In particular, Bloch prefers that when methods throw exceptions, there is no change to the state of the object.
</p>
</div>
</div>
<div id="outline-container-org3d6ffc2" class="outline-4">
<h4 id="org3d6ffc2"><span class="section-number-4">4.8.2.</span> Grading Criteria</h4>
<div class="outline-text-4" id="text-4-8-2">
<p>
As before, turn in a clear, concise story demonstrating completion of the assignment.
</p>
</div>
</div>
</div>
<div id="outline-container-a11" class="outline-3">
<h3 id="a11"><span class="section-number-3">4.9.</span> Assignment 11</h3>
<div class="outline-text-3" id="text-a11">
</div>
<div id="outline-container-orgd31975a" class="outline-4">
<h4 id="orgd31975a"><span class="section-number-4">4.9.1.</span> Goals: <code>Object</code> class contracts.</h4>
<div class="outline-text-4" id="text-4-9-1">
<p>
As it happens, Liskov&rsquo;s implementation of <code>clone()</code> for the <code>IntSet</code> class (see figure 5.10, page 97) is wrong.
</p>

<ol class="org-ol">
<li>Use the <a href="./files/IntSet.java">version</a> of <code>IntSet</code> from the in-class exercise. Implement a subtype of <code>IntSet</code> to demonstrate the problem. Your solution should include appropiate executable code in the form of JUnit tests.</li>
<li>Provide a correct implementation of <code>clone()</code> for <code>IntSet</code>. Again, give appropriate JUnit tests.</li>
<li>Correctly override <code>hashCode()</code> and <code>equals()</code>. Note that the standard recipe is not appropriate in this (unusual) case (why?).</li>
</ol>
</div>
</div>
<div id="outline-container-org6d1efc1" class="outline-4">
<h4 id="org6d1efc1"><span class="section-number-4">4.9.2.</span> Grading Criteria</h4>
<div class="outline-text-4" id="text-4-9-2">
<p>
In addititon to code and tests, your deliverable is a story. Explain what is going on at each stage of the exercise. The GTA will primarily grade your story.
</p>
</div>
</div>
</div>
<div id="outline-container-a12" class="outline-3">
<h3 id="a12"><span class="section-number-3">4.10.</span> Assignment 12</h3>
<div class="outline-text-3" id="text-a12">
</div>
<div id="outline-container-org78dff6f" class="outline-4">
<h4 id="org78dff6f"><span class="section-number-4">4.10.1.</span> Goals: Favoring composition over inheritance. Bloch, Item 18.</h4>
<div class="outline-text-4" id="text-4-10-1">
<p>
Consider the <code>InstrumentedSet</code> example from Bloch Item 18 (as well as in-class exercise <a href="#ic12A">in-class 12A</a>).
</p>
<ol class="org-ol">
<li>Replace <code>Set</code> with <code>List</code>. There is no problem with <code>equals()</code>. Why not?</li>
<li>Replace <code>Set</code> with <code>Collection</code>. Now <code>equals()</code> does not satisfy its contract.
<ul class="org-ul">
<li>Explain why there is a problem.</li>
<li>Demonstrate the problem with a suitable JUnit test.</li>
</ul></li>
</ol>
</div>
</div>
<div id="outline-container-orge83fe24" class="outline-4">
<h4 id="orge83fe24"><span class="section-number-4">4.10.2.</span> Grading Criteria</h4>
<div class="outline-text-4" id="text-4-10-2">
<p>
The GTA will look for correct responses, appropriate JUnit tests, and plausible explanations when doing the grading.
</p>
</div>
</div>
</div>
<div id="outline-container-a13" class="outline-3">
<h3 id="a13"><span class="section-number-3">4.11.</span> Assignment 13</h3>
<div class="outline-text-3" id="text-a13">
</div>
<div id="outline-container-orgbb25aab" class="outline-4">
<h4 id="orgbb25aab"><span class="section-number-4">4.11.1.</span> Goals: Applying lessons learned.</h4>
<div class="outline-text-4" id="text-4-11-1">
<p>
You have a choice of possible assignments:
</p>

<ol class="org-ol">
<li>Consider one of the <code>copyOf()</code> methods in the Java <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Arrays.html">Arrays</a> utility class. Bloch uses this method in his <code>Stack</code> example. Code a corresponding method in C++, changing the argument list as necessary. Provide a specification for the C++ code by translating the JavaDoc and adding preconditions as necessary. Explain what this exercise demonstrates about C++ type safety.</li>

<li><p>
For most of the semester, we have focused on design considerations for constructing software that does something we want it to do. For this last assignment, I would like students to appreciate just how vulnerable software is to malicious parties intent on attacking their software.
</p>

<p>
There are two attacks documented in Bloch&rsquo;s Item 88: <i>Write <code>readObject()</code> methods defensively</i>. One is called <code>BogusPeriod</code>, and the other is called <code>MutablePeriod</code>. Implement either (your choice) of these attacks (basically involves typing in code from Bloch) and verify that the attack takes place.
</p></li>

<li>A different source of security vulnerabilities in Java also involve serialization. Bloch (and others) recommend &ldquo;cross-platform structured data representations&rdquo; (e.g. JSON or Protocol Buffers) as safe alternatives. Develop a simple serialization example in Java and convert it into a safe alternative (probably, JSON is easier to use, since it is text-based). To make the example more interesting, use some objects types that are not directly supported.</li>

<li>Find some existing (Java) code that uses the &ldquo;int enum pattern&rdquo; and refactor it to use Java <code>Enums</code> instead. Identify any type-safety issue you uncover in the existing code. To make the exercise interesting, extend your enums beyond simple named-constants in one of the ways discussed by Bloch in Item 34.</li>

<li>Where appropriate, code up, as JUnit theories, constraints for classes that implement the Java <code>Comparable</code> interface. Note that there is significant overlap with the in-class exercise. Note also that the Comparable interface is generic; hence, you should use generics in your JUnit test class.</li>

<li>Gain experience with one of the property-based testing tools. I suggest a Java-based one (such as <a href="https://jqwik.net">jqwik</a>). One way to do this is work through one of the articles linked on the jqwik site.</li>
</ol>
</div>
</div>
<div id="outline-container-orgbf1e4fc" class="outline-4">
<h4 id="orgbf1e4fc"><span class="section-number-4">4.11.2.</span> Grading Criteria</h4>
<div class="outline-text-4" id="text-4-11-2">
<p>
In each case, the deliverable is a story. Write a brief report, and include enough evidence (output, screen shots, etc.) that the GTA can figure out that you actually completed the assignment.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org12a53c0" class="outline-2">
<h2 id="org12a53c0"><span class="section-number-2">5.</span> Reflection</h2>
<div class="outline-text-2" id="text-5">
<p>
For each of the following, answer these two questions first:
</p>
<ol class="org-ol">
<li>List the names of students in your group.</li>
<li>Did everyone in your group contribute to the discussion of your solutions to this reading quiz? If not, who did not?</li>
</ol>
</div>
<div id="outline-container-org8fc9fc7" class="outline-3">
<h3 id="org8fc9fc7"><span class="section-number-3">5.1.</span> Reflection 1</h3>
<div class="outline-text-3" id="text-5-1">
<ol class="org-ol">
<li>Much of the material explores the connection between preconditions and exception handling. Were there any aspects of this connection that surprised or confused anyone in your group? If so, explain. If not, where did you learn this material?</li>
<li>Liskov and Bloch have different advice with respect to checked vs. unchecked exceptions. Which approach do you find more persuasive, and why?</li>
<li>Preconditions are often characterized as &ldquo;bad&rdquo; from a security perspective. If you think you know why this is, please explain. If you are unsure, say so and try to explain why the you find the connection between preconditions and security confusing.</li>
</ol>
</div>
</div>
<div id="outline-container-orge7feb58" class="outline-3">
<h3 id="orge7feb58"><span class="section-number-3">5.2.</span> Reflection 2</h3>
<div class="outline-text-3" id="text-5-2">
<ol class="org-ol">
<li>If you sat down to design a new class, would the result likely be mutable or immutable? Why?</li>
<li>In her presentation, Liskov doesn&rsquo;t cover all the requirements for immutability. (In fairness, these requirements weren&rsquo;t well understood at the time she wrote her text.) Do you know what she&rsquo;s missing and why it&rsquo;s important? If so, briefly explain. (We&rsquo;ll cover those requirements later in the semester.)</li>
<li>Based on your experience, what do you think the major advantage is of immutability over mutability? mutability over immutability?</li>
</ol>
</div>
</div>
<div id="outline-container-org03ae969" class="outline-3">
<h3 id="org03ae969"><span class="section-number-3">5.3.</span> Reflection 3</h3>
<div class="outline-text-3" id="text-5-3">
<ol class="org-ol">
<li>Have you ever explicitly considered invariants when deciding how to implement a Java class? If so, can you give an example?</li>
<li>Please explain what you think it means to to correctly override the toString() method. Base your answer on your understanding <b>before</b> enrolling in SWE 619.</li>
<li>How do you decide whether you have implemented a Java method correctly? Again, base your answer on your understanding <b>before</b> enrolling in SWE 619.</li>
</ol>
</div>
</div>
<div id="outline-container-org11f97bf" class="outline-3">
<h3 id="org11f97bf"><span class="section-number-3">5.4.</span> Reflection 4 (reflection 3 redo)</h3>
<div class="outline-text-3" id="text-5-4">
<p>
Answer these questions based on your new knowledge on invariants and correctness analysis from class lectures and reading assignment.
</p>
<ol class="org-ol">
<li>Have you ever implicitly or explicitly considered invariants when writing code?</li>
<li>How do you decide whether you have implemented a program or method correctly?</li>
</ol>
</div>
</div>
<div id="outline-container-org75ab98a" class="outline-3">
<h3 id="org75ab98a"><span class="section-number-3">5.5.</span> Reflection 5</h3>
<div class="outline-text-3" id="text-5-5">
<ol class="org-ol">
<li>Iteration is a basic concept, yet Liskov devotes an entire chapter to it. What, if anything, did you find in Liskov&rsquo;s presentation of iteration abstraction that is new to you?</li>
<li>Bloch&rsquo;s <code>Period</code> class (Item 50) has a lot going on in it. We&rsquo;ll revisit the this example in an in-class exercise. What, if anything, did you find confusing in this example?</li>
</ol>
</div>
</div>
<div id="outline-container-orgc57235c" class="outline-3">
<h3 id="orgc57235c"><span class="section-number-3">5.6.</span> Reflection 6</h3>
<div class="outline-text-3" id="text-5-6">
<ol class="org-ol">
<li>Liskov 7 develops rules for assessing the correctness of subtypes. What do you think the connection is between these rules and the rules for verification addressed in Chapter 5?</li>
</ol>

<ol class="org-ol">
<li>Consider the Java Set interface and two subtypes: HashSet and TreeSet. Do you think the abstract state for these three interfaces/classes are identical or different? (You might want to spend some time in the JavaDoc before jumping to a conclusion; there is a specific answer in there!)</li>
</ol>
</div>
</div>
<div id="outline-container-org4801502" class="outline-3">
<h3 id="org4801502"><span class="section-number-3">5.7.</span> Reflection 7</h3>
<div class="outline-text-3" id="text-5-7">
<ol class="org-ol">
<li>Explain why Java has both a Comparable interface and a Comparator interface.</li>
<li>How familiar is your group with the Java &ldquo;anonymous class&rdquo; and &ldquo;lambda&rdquo; constructs?</li>
<li>Can you explain the connection between anonymous classes and lambda expressions?</li>
</ol>
</div>
</div>
<div id="outline-container-org819c38c" class="outline-3">
<h3 id="org819c38c"><span class="section-number-3">5.8.</span> Reflection 8</h3>
<div class="outline-text-3" id="text-5-8">
<ol class="org-ol">
<li>Explain the basic role of generics in the Java language</li>
<li>Do you have experience generifying Java classes? Explain.</li>
<li>Bloch explains how bounded wildcards can address certain limitations in the use of generics in inheritance settings. If you can, give a brief description of how this works. (If not, that&rsquo;s fine; we&rsquo;ll address in class.)</li>
</ol>
</div>
</div>
<div id="outline-container-org693734d" class="outline-3">
<h3 id="org693734d"><span class="section-number-3">5.9.</span> Reflection 9</h3>
<div class="outline-text-3" id="text-5-9">
<ol class="org-ol">
<li>Have you overridden the equals() or the hashCode() methods? In light of Bloch&rsquo;s discussion of both methods, do you think your implementations were correct?</li>
<li>Have you overridden the clone() method? Do you understand why inheritance is a particular concern for overridding this method?</li>
<li>What similarities and differences do you see between how Liskov and Bloch treat the toString() method?</li>
</ol>
</div>
</div>
<div id="outline-container-orgbb17790" class="outline-3">
<h3 id="orgbb17790"><span class="section-number-3">5.10.</span> Reflection 10</h3>
<div class="outline-text-3" id="text-5-10">
<ol class="org-ol">
<li>Bloch discusses specific rules for making a class immutable. Did you find any of these rules confusing?</li>
<li>Bloch&rsquo;s InstrumentedHashSet example demonstrates how inheritance can break encapsulation. Does the JavaDoc for HashSet, Set and/or Collection follow the Bloch&rsquo;s Item 19 advice for documenting for inheritances?</li>
<li>Bloch&rsquo;s InstrumentedSet example has a lot going on in it. What aspects, if any, of this example did you find confusing?</li>
</ol>
</div>
</div>
<div id="outline-container-org97dc8b1" class="outline-3">
<h3 id="org97dc8b1"><span class="section-number-3">5.11.</span> Reflection 11</h3>
<div class="outline-text-3" id="text-5-11">
<ol class="org-ol">
<li>How would you rate your experience with writing (ordinary) tests in the JUnit framework? Use a scale from &ldquo;A few times for class&rdquo; to &ldquo;I do that professionally&rdquo;.</li>
<li>JUnit theories are the JUnit implementation of &ldquo;property-based&rdquo; testing. Have you every written a property-based test?</li>
<li>JUnit theories are included on the syllabus because they show how the precondition/postcondition model applies beyond method contracts. Does the pre/post model for JUnit theories make sense to you?</li>
</ol>
</div>
</div>
<div id="outline-container-org27a70b6" class="outline-3">
<h3 id="org27a70b6"><span class="section-number-3">5.12.</span> Reflection 11</h3>
<div class="outline-text-3" id="text-5-12">
<ol class="org-ol">
<li>Is there anything about property based testing that you still find confusing?</li>
<li>Have you ever used a &ldquo;C style&rdquo; enum? If so, at the time, did this seem reasonable or ridiculous?</li>
<li>This week&rsquo;s in-class exercise is a recap. Is there a topic (or two) we&rsquo;ve covered that you think you need more practice with?</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org1c3e7f4" class="outline-2">
<h2 id="org1c3e7f4"><span class="section-number-2">6.</span> Files</h2>
<div class="outline-text-2" id="text-6">
<ul class="org-ul">
<li><a href="./files/LiskovSet.java">LiskovSet.java</a></li>
<li><a href="./files/Poly.java">Poly.java</a></li>
</ul>
</div>
</div>
<div id="outline-container-org787220e" class="outline-2">
<h2 id="org787220e"><span class="section-number-2">7.</span> Links</h2>
<div class="outline-text-2" id="text-7">
<ul class="org-ul">
<li><a href="./index.html">Syllabus</a></li>
<li><a href="./schedule.html">Schedule</a></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: ThanhVu (Vu) Nguyen</p>
<p class="date">Created: 2024-03-13 Wed 13:37</p>
</div>
</body>
</html>
