<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-09-29 Thu 12:06 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>Module 10 - Automatic Program Verification using Hoare Logic</title>
<meta name="author" content="ThanhVu (Vu) Nguyen" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="https://dynaroars.github.io/files/org.css">
</head>
<body>
<div id="content" class="content">
<h1 class="title">Module 10 - Automatic Program Verification using Hoare Logic</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org296a855">1. Overview and Objectives</a>
<ul>
<li><a href="#org79723fd">1.1. <span class="todo TODO">TODO</span> OVERVIEW</a></li>
<li><a href="#org16b1d1a">1.2. COURSE LEVEL OBJECTIVES (CLO)</a></li>
<li><a href="#org875ab2b">1.3. MODULE LEVEL OBJECTIVES (MLO)</a></li>
</ul>
</li>
<li><a href="#org5c0996e">2. Module Video (Wiley-Produced w/Dan Ramos) [3-5 minutes]</a></li>
<li><a href="#orgf971a9b">3. Learning Materials [~100 pages, ~3.5 hours]</a>
<ul>
<li><a href="#org9cdeb4c">3.1. TEXTBOOK READINGS</a></li>
<li><a href="#org88e1737">3.2. <span class="done DONE">DONE</span> ADDITIONAL RESOURCES</a></li>
</ul>
</li>
<li><a href="#org45dae7a">4. Module 10 Learning Unit 0 – Motivation (MLO 1) [~15 mins]</a></li>
<li><a href="#orgc9cb43a">5. <span class="todo TODO">TODO</span> Module 10 Learning Unit 1 – Intro to Logic (MLO 2) [~1 hour]</a>
<ul>
<li><a href="#orgde5bddd">5.1. Terminology</a></li>
<li><a href="#orga679939">5.2. Important Concept: Formula evaluation</a></li>
<li><a href="#org47fe5dc">5.3. Instructor Screencast: TITLE</a></li>
<li><a href="#orgb4f167f">5.4. Interactive Element: TITLE</a></li>
<li><a href="#org7fb156d">5.5. Important Concept: Text</a></li>
<li><a href="#org944bb33">5.6. Instructor Screencast: TITLE</a></li>
<li><a href="#org381d961">5.7. Important Concept: Text</a></li>
</ul>
</li>
<li><a href="#org3d7d499">6. Module 10 Learning Unit 2 – Program Verification using Hoare logic (MLO 2, 3) [~3 hours]</a>
<ul>
<li><a href="#org029400a">6.1. Terminology</a>
<ul>
<li><a href="#orgc1c7010">6.1.1. Hoare Tripple <code>{P} S {Q}</code></a></li>
<li><a href="#org5efc9b8">6.1.2. Partial and Total Correctness</a></li>
<li><a href="#org5cdcc58">6.1.3. Examples of Hoare Tripples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgcc366ce">7. Important Concept: Text</a>
<ul>
<li><a href="#org9f81eaf">7.1. Rules to Computing Weakest Preconditions</a>
<ul>
<li><a href="#org0f7cff1">7.1.1. Quick summary of Hoare rules</a></li>
<li><a href="#org35fe055">7.1.2. ASSIGNMENT</a></li>
<li><a href="#list">7.1.3. LIST of statements</a></li>
<li><a href="#org1151d39">7.1.4. CONDITIONAL</a></li>
</ul>
</li>
<li><a href="#org5d7bb13">7.2. Important Concept: Loop Invariants</a>
<ul>
<li><a href="#org162e01a">7.2.1. Loop Invariants</a></li>
<li><a href="#org14a66bd">7.2.2. Where is the loop invariant <code>I</code>?</a></li>
<li><a href="#li">7.2.3. What is the loop invariant <code>I</code>?</a></li>
<li><a href="#li-to-use">7.2.4. Which loop invariants to use?</a></li>
<li><a href="#org897751f">7.2.5. Important Concept: Computing WP for LOOPs</a></li>
<li><a href="#org4083509">7.2.6. Instructor Screencast: TITLE</a></li>
<li><a href="#org6bda050">7.2.7. Interactive Element: TITLE</a></li>
<li><a href="#orgc198ab8">7.2.8. Important Concept: Text</a></li>
<li><a href="#org710e1c6">7.2.9. Instructor Screencast: TITLE</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd77001b">8. Module 10 Assignment – Program Verification using Hoare Logic (MLO TODO, TODO) [~2.5 hours]</a>
<ul>
<li><a href="#org7750487">8.1. Purpose</a></li>
<li><a href="#org6ee912d">8.2. Instructions</a>
<ul>
<li><a href="#org2ab1162">8.2.1. Q1</a></li>
<li><a href="#orgb304ad1">8.2.2. Q2</a></li>
</ul>
</li>
<li><a href="#org36e6a39">8.3. Deliverable</a></li>
<li><a href="#org3733707">8.4. Due Date</a></li>
</ul>
</li>
<li><a href="#orgbccdfde">9. Module 1 Quiz (MLO TODO, TODO, TODO) [~.5 hour]</a>
<ul>
<li><a href="#org1ad331e">9.1. Purpose</a></li>
<li><a href="#org317cd21">9.2. Instructions</a></li>
<li><a href="#org2538073">9.3. Deliverable</a></li>
<li><a href="#org67b1a27">9.4. Due Date</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org296a855" class="outline-2">
<h2 id="org296a855"><span class="section-number-2">1.</span> Overview and Objectives</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org79723fd" class="outline-3">
<h3 id="org79723fd"><span class="section-number-3">1.1.</span> <span class="todo TODO">TODO</span> OVERVIEW</h3>
</div>

<div id="outline-container-org16b1d1a" class="outline-3">
<h3 id="org16b1d1a"><span class="section-number-3">1.2.</span> COURSE LEVEL OBJECTIVES (CLO)</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Upon completion of this course, you should be able to:
</p>

<ol class="org-ol">
<li>Construct modern high quality software systems and reason about them.</li>
<li>Properly define software specifications and rep-invariants.</li>
<li>Leverage immutability to properly construct threat safe programs.</li>
<li>Explain object-oriented concepts such as information hiding, encapsulation, data and type abstraction, and polymorphism.</li>
<li>Properly use exception handling</li>
<li>Identify when it is appropriate to use inheritance and generics.</li>
</ol>
</div>
</div>

<div id="outline-container-org875ab2b" class="outline-3">
<h3 id="org875ab2b"><span class="section-number-3">1.3.</span> MODULE LEVEL OBJECTIVES (MLO)</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Upon completion of this module’s activities, you should be able to: 
</p>

<ol class="org-ol">
<li>Motivation for using verification to prove program correctness/safety specifications (CLO 1,2)</li>
<li>Able to formalize programs and specifications as logical formulae (CLO 1,2)</li>
<li>Able to automatically verify program automatically using Hoare logic (CLO 1,2)</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org5c0996e" class="outline-2">
<h2 id="org5c0996e"><span class="section-number-2">2.</span> Module Video (Wiley-Produced w/Dan Ramos) [3-5 minutes]</h2>
<div class="outline-text-2" id="text-2">
</div>
</div>





<div id="outline-container-orgf971a9b" class="outline-2">
<h2 id="orgf971a9b"><span class="section-number-2">3.</span> Learning Materials [~100 pages, ~3.5 hours]</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org9cdeb4c" class="outline-3">
<h3 id="org9cdeb4c"><span class="section-number-3">3.1.</span> TEXTBOOK READINGS</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>Hoare logic notes: <a href="https://nguyenthanhvuh.github.io/posts/program-analysis-notes.html#hoare">https://nguyenthanhvuh.github.io/posts/program-analysis-notes.html#hoare</a></li>
<li>Barbara Liskov with John Guttag. Program Development in Java. Addison Wesley, 2001, ISBN 0-201-65768-6. 
<ul class="org-ul">
<li>Chapter TODO</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org88e1737" class="outline-3">
<h3 id="org88e1737"><span class="section-number-3">3.2.</span> <span class="done DONE">DONE</span> ADDITIONAL RESOURCES</h3>
<div class="outline-text-3" id="text-3-2">
<ul class="org-ul">
<li>Propositional logic: <a href="https://en.wikipedia.org/wiki/Propositional_calculus">https://en.wikipedia.org/wiki/Propositional_calculus</a></li>
<li>Hoare logic: <a href="https://en.wikipedia.org/wiki/Hoare_logic">https://en.wikipedia.org/wiki/Hoare_logic</a></li>
</ul>
</div>
</div>
</div>


<div id="outline-container-org45dae7a" class="outline-2">
<h2 id="org45dae7a"><span class="section-number-2">4.</span> Module 10 Learning Unit 0 – Motivation (MLO 1) [~15 mins]</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li>Previously we have look at program specifications that involve pre and post conditions and  <b>manually</b> reason that the program implementation is correct (adheres to) with respect to the specification.</li>
<li>As we also have experienced, such manual reasoning is difficult, time consuming, and error-prone, even for short "toy" examples shown class.</li>
<li>Automatic testing is popular and widely-used, however not adequate for many domains and situations such as avionic systems and medical systems</li>
<li>Automatic verification is what required, and has enjoyed many successes in the real-world. For examples,
<ul class="org-ul">
<li>Hardware (e.g., circuit designs, CPU) are rigorous verified by chip makers</li>
<li>Companies and government organizations develop and rely on verification tools (e.g., Mars Rover, Avionic system of Airbus, Facebook newsfeeds and instagrams, Microsoft drivers are all verified in some ways).</li>
</ul></li>

<li>Today we will learn about Hoare Logic, one of the most popular ways to *automatically verify program correctness.</li>
<li>Hoare logic:
<ul class="org-ul">
<li>a formal systems with a set of rules to formally reason about the correctness of a program with respect to given specifications</li>
<li>invited by Sir. Tony Hoare, who is the Turing award winner in 1980 , and in addition to Hoare logic, has developed many well-known concepts such as the *quicksort algorithm and "null pointer" (the billion dollar mistake)</li>
<li>standard for many practical verification techniques and tools</li>
</ul></li>
</ul>

<p>
For this topic, you will learn about
</p>
<ul class="org-ul">
<li>Hoare tripple: which describes how the program changes its states during execution</li>
<li>Total vs. Partial correctness: Total correctness reasons both about program termination (e.g., the loop will eventually terminate) and that the program is correct and satisfies the postcondition when it terminates; whereas parial correctness *assumes the program terminates and only deals with program correctness.</li>
<li>Computing Weakenst Preconditions using Hoare rules: a set of rules for each types of statements in a program that leads to the weakest preconditions required for verification</li>
<li>Finding and using Loop invariants: the crucial piece of information that the user needs to provide to enable verification automation under Hoare logic</li>
<li>Formulating specifications, weakest preconditions, loop invariants as logical formulae</li>
<li>Using SAT solver to automatically prove program correctness</li>
</ul>
</div>
</div>



<div id="outline-container-orgc9cb43a" class="outline-2">
<h2 id="orgc9cb43a"><span class="section-number-2">5.</span> <span class="todo TODO">TODO</span> Module 10 Learning Unit 1 – Intro to Logic (MLO 2) [~1 hour]</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgde5bddd" class="outline-3">
<h3 id="orgde5bddd"><span class="section-number-3">5.1.</span> Terminology</h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li>variables:
<ul class="org-ul">
<li>boolean variables: can take either True (1) or False (0) value</li>
<li>integer variables: can take integers</li>
<li>&#x2026;</li>
</ul></li>

<li>Logical connectors: <code>and</code> (<code>&amp;</code>), <code>or</code> (<code>|</code>), <code>not</code> (<code>!</code>), <code>imply</code> (<code>=&gt;</code>)</li>

<li><p>
Formulae: proper combination of variables and logical connectors. 
</p>
<pre class="example">
x
x &amp; !x
(x | y) &amp; z
x =&gt; y

x &gt; 6 and x &lt; 5    :  False  (no value of x would satisfy this)
x &gt; 6  =&gt;  x &gt; 1   :  True  (every value of x would satisfy this)
x &gt; 6  and  y = 3  :  False (counterxample: {x=5 , y=2})
x &gt; 6  =&gt;  y = 3   :  False (counterexample  : {x=7,  y=4})
</pre></li>
</ul>
<ul class="org-ul">
<li>Satisfiable, Valid (Tautology), Falsification
<ul class="org-ul">
<li><p>
a formula <code>f</code> is *satisfiable  if there is *some assignment to the values in <code>f</code> that makes <code>f</code> evaluate to <code>True</code>
</p>
<pre class="example">
- x &lt;= 6 or y = 3  is satisfiable (e.g.,  x=4, y=4)
- x &gt; 6  and  y = 3 is SAT (e.g.,  x =7, y=3)  
- x &gt; 6  =&gt;  x &gt; 1   is SAT (e.g.,  x=7)
- x &gt; 6 and x &lt; 5   is UNSAT
</pre></li>
<li><p>
a formula <code>f</code> is *valid if <code>f</code> is always satisfiable for *every assignment
</p>
<pre class="example">
x &gt; 6  =&gt;  x &gt; 1   is valid
x = x  is valid 
</pre></li>
<li><p>
a formula <code>f</code> is a *falsification if <code>f</code> is always unsatisfiable for *every assignment
</p>
<pre class="example">
x &gt; 6 and x &lt; 5
x != x
x = x + 1   (if x = some infinite number, then x = x + 1 would True, so assume x is finite)
</pre></li>
</ul></li>
</ul>
</div>
</div>


<div id="outline-container-orga679939" class="outline-3">
<h3 id="orga679939"><span class="section-number-3">5.2.</span> Important Concept: Formula evaluation</h3>
<div class="outline-text-3" id="text-5-2">
<ul class="org-ul">
<li>Understand how logical connector works, especially <b>implication</b></li>
<li>Understand well how to evaluate formula through the above definitions of satisfiable, valid, falsification.</li>
</ul>
</div>
</div>

<div id="outline-container-org47fe5dc" class="outline-3">
<h3 id="org47fe5dc"><span class="section-number-3">5.3.</span> Instructor Screencast: TITLE</h3>
<div class="outline-text-3" id="text-5-3">
<p>
Link to MP4 File
</p>
</div>
</div>
<div id="outline-container-orgb4f167f" class="outline-3">
<h3 id="orgb4f167f"><span class="section-number-3">5.4.</span> Interactive Element: TITLE</h3>
</div>
<div id="outline-container-org7fb156d" class="outline-3">
<h3 id="org7fb156d"><span class="section-number-3">5.5.</span> Important Concept: Text</h3>
<div class="outline-text-3" id="text-5-5">
<p>
Text. 
</p>
</div>
</div>
<div id="outline-container-org944bb33" class="outline-3">
<h3 id="org944bb33"><span class="section-number-3">5.6.</span> Instructor Screencast: TITLE</h3>
<div class="outline-text-3" id="text-5-6">
<p>
Link to MP4 File 
</p>
</div>
</div>
<div id="outline-container-org381d961" class="outline-3">
<h3 id="org381d961"><span class="section-number-3">5.7.</span> Important Concept: Text</h3>
<div class="outline-text-3" id="text-5-7">
<p>
Text.
</p>
</div>
</div>
</div>

<div id="outline-container-org3d7d499" class="outline-2">
<h2 id="org3d7d499"><span class="section-number-2">6.</span> Module 10 Learning Unit 2 – Program Verification using Hoare logic (MLO 2, 3) [~3 hours]</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org029400a" class="outline-3">
<h3 id="org029400a"><span class="section-number-3">6.1.</span> Terminology</h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="outline-container-orgc1c7010" class="outline-4">
<h4 id="orgc1c7010"><span class="section-number-4">6.1.1.</span> Hoare Tripple <code>{P} S {Q}</code></h4>
</div>
<div id="outline-container-org5efc9b8" class="outline-4">
<h4 id="org5efc9b8"><span class="section-number-4">6.1.2.</span> Partial and Total Correctness</h4>
<div class="outline-text-4" id="text-6-1-2">
<ul class="org-ul">
<li><b>Partial</b>: assume <code>P</code> holds and <code>S</code> <i>successfully</i> executes, <code>Q</code> holds
<ul class="org-ul">
<li>Here, we *assume <code>P</code> and the program terminates (<code>S</code> successfully executed)</li>
</ul></li>
<li><b>Total</b>: assume <code>P</code> holds, if  <code>S</code> <i>successfully</i> executes, then <code>Q</code> holds
<ul class="org-ul">
<li>Here, we *require <code>S</code> terminates</li>
<li>Dififcult because having to ensure the termination of <code>S</code></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org5cdcc58" class="outline-4">
<h4 id="org5cdcc58"><span class="section-number-4">6.1.3.</span> Examples of Hoare Tripples</h4>
<div class="outline-text-4" id="text-6-1-3">
<ul class="org-ul">
<li><p>
Consider a program <code>S</code> with a single assignment statement <code>x:=5</code>.
The Hoare tripple <code>{True} x := 5 {x &gt; 6}</code> is <i>not</i> a valid tripple, but these next ones are
</p>
<pre class="example">
{True} x := 5 {x=5 or x= 6 or x &gt; 6}
{True} x := 5 {x &gt; 1}
{True} x := 5 {x = 5}
</pre>
<p>
Moreover, the postcondition in <code>x=5</code> is *strongest because it is more precise than <code>x &gt; 1</code> and <code>(x=5 or x=6 or x &gt; 6)</code>.  In general we want the strongest (most precise) postcondition.
</p></li>

<li><p>
Consider another program <code>z:= x/y</code>
These are valid Hoare tripples:
</p>
<pre class="example">
{x = 1 &amp; y = 2} z:= x/y  {z &lt; 1}
{x = 2 &amp; y = 4} z:= x/y {z &lt;1}
{0 &lt; x &lt; y &amp; y != 0} z:= x/y {z &lt;1}
</pre>
<p>
Moreover, the precondition <code>0 &lt; x &lt; y &amp; y != 0</code> is the *weakest precondition (i.e., it is the least constraint precondition). In general we want the weakest precondition.
</p></li>

<li><p>
These are invalid tripples:
</p>
<pre class="example">
1. {x &lt; y} z:= x/y  {z &lt; 1} (counterexample input x=-1, y=0,  after executing z:=x/y, we do not have z &lt; 1 and instead got a div-by-0 exception)
{x = 0} z:= x/y  {z &lt; 1} (counterexample input x=0, y=0)
{y != 0} z:= x/y  {z &lt; 1} (counterexample input x=2 , y=1)
{x &lt; y &amp; y != 0} z:= x/y {z &lt;1} (counterexample input   x=-2,  y=-1)
</pre></li>
</ul>
</div>
</div>
</div>
</div>


<div id="outline-container-orgcc366ce" class="outline-2">
<h2 id="orgcc366ce"><span class="section-number-2">7.</span> Important Concept: Text</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org9f81eaf" class="outline-3">
<h3 id="org9f81eaf"><span class="section-number-3">7.1.</span> Rules to Computing Weakest Preconditions</h3>
<div class="outline-text-3" id="text-7-1">
<p>
We can automatically verify (partial) program correctness using Hoare Triples and weakest preconditions.
To prove <code>{P} S {Q}</code> is valid, i.e., to prove the program <code>S</code> is correct wrt to the precondition <code>P</code> and postcondition <code>Q</code>, we check that <code>P =&gt; wp(S, Q)</code> is valid. Here, the function *wp returns the weakest precondition allowing the program <code>S</code> to achieve the postcondition <code>Q</code>.
</p>

<p>
Thus, to show the validity of <code>{P} S {Q}</code>, we show that <code>P</code> implies (<code>=&gt;</code>) the WP of <code>S</code> wrt to <code>Q</code>. Hoare defines rules to obtain the WP of different kind of (imperative) program statements as shown below.
</p>
</div>
<div id="outline-container-org0f7cff1" class="outline-4">
<h4 id="org0f7cff1"><span class="section-number-4">7.1.1.</span> Quick summary of Hoare rules</h4>
<div class="outline-text-4" id="text-7-1-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-center" />

<col  class="org-center" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-right">Statement</td>
<td class="org-center"><code>S</code></td>
<td class="org-center"><code>wp(S, Q)</code></td>
<td class="org-left">Comment</td>
</tr>

<tr>
<td class="org-right"><a href="#org35fe055">Assignment</a></td>
<td class="org-center"><code>x := E</code></td>
<td class="org-center"><code>Q[x/E]</code></td>
<td class="org-left">replace all occurences of the variable <code>x</code> in <code>Q</code> with the expresion <code>E</code></td>
</tr>

<tr>
<td class="org-right"><a href="#list">List of Assignments</a></td>
<td class="org-center"><code>S1;S2</code></td>
<td class="org-center"><code>wp(S1, wp(S2,Q))</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right"><a href="#org1151d39">Conditional</a></td>
<td class="org-center"><code>if b then S1 else S2</code></td>
<td class="org-center"><code>b =&gt; wp(S1,Q) &amp; !b =&gt; wp(S2,Q)</code></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right"><a href="#org079ed0a">Loop</a></td>
<td class="org-center"><code>while b do S</code></td>
<td class="org-center"><code>(I) &amp; (I &amp; B =&gt; wp(S,I)) &amp; (I &amp; !B =&gt; Q)</code></td>
<td class="org-left"><code>I</code> is a user supplied <span class="underline">loop invariant</span></td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org35fe055" class="outline-4">
<h4 id="org35fe055"><span class="section-number-4">7.1.2.</span> ASSIGNMENT</h4>
<div class="outline-text-4" id="text-7-1-2">
<p>
An <code>assignment</code> statement <code>x := E</code> is one of the most popular types of statement.  It assigns the value of an expression <code>E</code> to a variable <code>x</code>. The WP for an assignment <code>wp(x:=E,Q)</code> is obtained by substituting all occurences of <code>x</code> in <code>Q</code> with the expression <code>E</code>.
</p>

<pre class="example">
WP(x := E, Q) = Q[x/E]
</pre>

<p>
Example:
</p>
<pre class="example">
WP(x:=3, x + y = 10)
= 3 + y = 10 
= y = 7
Thus, we have {y=7} x := 3 {x + y = 10}
</pre>

<pre class="example">
WP(x:=3, {x + y &gt; 0) 
= 3 + y &gt; 0  
= y &gt; -3
Thus, we have {y &gt; -3}  x := 3 {x + y&gt; 0}
</pre>
</div>
</div>

<div id="outline-container-list" class="outline-4">
<h4 id="list"><span class="section-number-4">7.1.3.</span> LIST of statements</h4>
<div class="outline-text-4" id="text-list">
<p>
A list of sequential statements. The WP for list is defined <i>recursively</i> as follows.
</p>

<pre class="example">
WP([S1; S2; S3 ...;]  Q) = WP(S1, WP(S2;S3;.., Q))
WP([], Q) = Q
</pre>

<p>
Example:
</p>
<pre class="example">
WP([x:=x+1; y:=y*x], y=2*z) 
=   WP(x:=x+1, WP([y:=y*x], y=2*z))
=   WP(x:=x+1, y*x=2*z)
=   y*(x+1)=2*z
Thus, we have {y*(x+1)=2*z}  x:=x+1; y:=y*x {y=2*z}
</pre>
</div>
</div>

<div id="outline-container-org1151d39" class="outline-4">
<h4 id="org1151d39"><span class="section-number-4">7.1.4.</span> CONDITIONAL</h4>
<div class="outline-text-4" id="text-7-1-4">
<p>
The WP of a conditional statement <code>if b then S1 else S2, Q</code> combines the WPs of <code>S1</code> and <code>S2</code>.
</p>

<pre class="example">
WP(if b then S1 else S2, Q)  =  (b =&gt; WP(S1,Q))  &amp;  (!b =&gt; WP(S2, Q))
</pre>

<p>
Example:
</p>
<pre class="example">
WP(if x &gt; 0 then y := x + 2  else y := y + 1,  y &gt; x) 
= (x&gt;0 =&gt; WP(y:=y+x, y&gt;x) &amp; (x&lt;=0 =&gt; WP(y:=y+1, y&gt;x))
= (x&gt;0 =&gt; y+x&gt;x)  &amp;  (x &lt;= 0  =&gt;  y+1&gt;x)
= x&gt;0 =&gt; y&gt;0  &amp; x&lt;=0 =&gt; y+1&gt;x
</pre>

<pre class="example">
WP(if x &gt; 0 then y :=x  else y:= 0,  y &gt; 0) 
= (x&gt;0 =&gt; WP(y:=x, y &gt;0)) &amp; (x&lt;=0 =&gt; WP(y:=0, y&gt;0))
= (x &gt; 0 =&gt; x &gt; 0)  &amp;  (x &lt;= 0  =&gt;  0 &gt; 0)
= True &amp; x &gt; 0   
= x &gt; 0 # (0&gt; 0 is false,  and so !(x&lt;=0) or false is !(x&lt;=0) = x&gt;0)
</pre>

<p>
Note: Instead of using <code>=&gt;</code> (imply), which might be confusing to some, we can use just <code>!</code> (not) and <code>||</code> (or)
</p>
<pre class="example">
WP(if b then S1 else S2, Q)
=  (b =&gt; WP(S1,Q))  &amp;  (!b =&gt; WP(S2, Q))
=  !((b &amp; !WP(S1,Q))  ||  (!b &amp; !WP(S2, Q)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d7bb13" class="outline-3">
<h3 id="org5d7bb13"><span class="section-number-3">7.2.</span> Important Concept: Loop Invariants</h3>
<div class="outline-text-3" id="text-7-2">
</div>
<div id="outline-container-org162e01a" class="outline-4">
<h4 id="org162e01a"><span class="section-number-4">7.2.1.</span> Loop Invariants</h4>
<div class="outline-text-4" id="text-7-2-1">
<p>
At a high level, loop invariant capture the meaning of the loop, and thus help understand and reason about the loop. They are especially helpful for automatic verification.
</p>

<p>
A loop invariant is a property <code>I</code> that always holds at the <b>loop entrance</b>. This means that <code>I</code>  (i) holds when the loop entered and (ii) is preserved after the loop body is executed (i.e., <code>I</code> is an inductive loop invariant).
</p>
</div>
</div>

<div id="outline-container-org14a66bd" class="outline-4">
<h4 id="org14a66bd"><span class="section-number-4">7.2.2.</span> Where is the loop invariant <code>I</code>?</h4>
<div class="outline-text-4" id="text-7-2-2">
<p>
If you have a loop that looks like
</p>
<pre class="example">
while (b){
  // I 
  //loop body
}
</pre>

<p>
It is useful to transform it to this equivalent form
</p>
<div class="org-src-container">
<pre class="src src-c"><span style="color: #e45649;">while</span> (True){
  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">[I] : loop invariant I is right here</span>
  <span style="color: #e45649;">if</span> (<span style="color: #4078f2; font-weight: bold;">!</span>b) <span style="color: #e45649;">break</span>
  <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">loop body</span>
}
</pre>
</div>

<p>
Then the loop invariant <code>I</code> is right when you enter the loop, as indicated by <code>[I]</code> in the code above.
</p>

<p>
Note that <code>I</code> is not located *after the guard condition <code>b</code> is satisfied, e.g., 
</p>
<div class="org-src-container">
<pre class="src src-c"><span style="color: #e45649;">while</span> (b){
  <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">[I]  : incorrect location for loop invariant</span>
  <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">loop body</span>
}
</pre>
</div>
</div>
</div>


<div id="outline-container-li" class="outline-4">
<h4 id="li"><span class="section-number-4">7.2.3.</span> What is the loop invariant <code>I</code>?</h4>
<div class="outline-text-4" id="text-li">
<p>
We will use an example to demonstrate loop invariants. Consider a simple program
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">{N &gt;= 0} </span>
i := 0;
<span style="color: #e45649;">while</span>(i &lt; N){
  <span style="color: #b751b6;">i</span> := N;
}
<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">{i = N} // post condition</span>
</pre>
</div>

<p>
To make it easier to see where loop invariants are, we first transform this program into an equivalent one:
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">{N &gt;= 0} </span>
i := 0;
<span style="color: #e45649;">while</span>(<span style="color: #b751b6;">true</span>){
  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">[I]: loop invariants here</span>
  <span style="color: #e45649;">if</span>(<span style="color: #4078f2; font-weight: bold;">!</span>i &lt; N) <span style="color: #e45649;">break</span>;
  <span style="color: #b751b6;">i</span> := N;
}
<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">{i = N} // post condition</span>
</pre>
</div>


<p>
The <code>while</code> loop in this program has many possible loop invariants (any property that is true at <code>[I]</code>):
</p>
<ol class="org-ol">
<li><code>true</code> : is always a loop invariant, but it is very weak and trivial, i.e., almost useless for any analysis</li>
<li><code>N &gt;= 0</code>:  because <code>N&gt;0</code> is a precondition and <code>N</code> is never changed</li>
<li><code>i&gt;=0</code>: because <code>i</code> is initalized to <code>0</code> can only changed to <code>N</code>, which itself is <code>&gt;=0</code> and never changed.</li>
<li><code>i &lt;= N</code>: because <code>i</code> can only either be <code>0</code> or <code>N</code>, and <code>N &gt;=0</code>.</li>
</ol>
</div>
</div>

<div id="outline-container-li-to-use" class="outline-4">
<h4 id="li-to-use"><span class="section-number-4">7.2.4.</span> Which loop invariants to use?</h4>
<div class="outline-text-4" id="text-li-to-use">
<p>
An important question to ask is which of these invariants are useful?  Typically, the more stronger the better as they capture the meaning of the loop more precisely (thus <code>true</code> is not very useful).  However, the answer really depends on the task we are trying to achieve.  If the task is to prove a very weak property, then we might not need strong loop invariants, e.g., for instance to prove that <code>N &gt;= 0</code> as the postcondition, then we only need the loop invariant <code>N &gt;= 0</code>.  Vice versa, if the task is to prove a strong property such as <code>i=N</code>, then we likely need strong loop invariants, e.g., <code>i&lt;=N</code>.
</p>

<p>
In many cases, we can guess which loop invariants are useful based on the postconditions we want to prove. However, in the general cases we do not know a priori which loop invariants to use.  If the program is indeed correct wrt the specs (i.e., the representing Hoare tripple is valid), there are two possible scenarios about using loop invariants to prove programs:
</p>
<ol class="org-ol">
<li>if we use sufficiently strong loop invariants, then we will be able to prove the program is correct.</li>
<li>if we use insufficiently strong loop invariants, then we will <i>not</i> be able to prove the program is correct.</li>
</ol>
<p>
The <a href="#org079ed0a">loop</a> section in Hoare logic gives concrete examples demonstrating these two cases.
</p>

<p>
Thus, this gives an *crucial observation:  if we can prove that a program is correct (e.g., using Hoare logic), then it is really correct.  However, if we cannot prove that the program is correct, then we do not know whether the program is correct or not (it could really be wrong,  or it is actually correct but we can't prove it because we use rather weak loop invariants).
</p>
</div>
</div>




<div id="outline-container-org897751f" class="outline-4">
<h4 id="org897751f"><span class="section-number-4">7.2.5.</span> Important Concept: Computing WP for LOOPs</h4>
<div class="outline-text-4" id="text-7-2-5">
</div>
<ol class="org-ol">
<li><a id="org079ed0a"></a>LOOP<br />
<div class="outline-text-5" id="text-7-2-5-1">
<p>
Unlike other statements where we have rules to compute WP automatically, for loop, we (the user) need to supply a <i>loop invariant</i> ~I~to obtain the WP of loop. This <a href="#org162e01a">subsection</a> describes loop invariants.  The WP for loop is:
</p>

<pre class="example">
WP(while [I] b do S, Q) =  I &amp; (I &amp; b =&gt; WP(S,I) &amp; (I &amp; !b)  =&gt; Q)
</pre>
<p>
As can be seen, the WP for loop consists of 3 conjuncts:
</p>
<ol class="org-ol">
<li><code>I</code> :  the loop invariant (should hold when entering the loop)</li>
<li><code>(I &amp; b)  =&gt;   I</code> : (entering the loop because <code>b</code> is true) <code>I</code> is preserved after each loop body execution</li>
<li><code>(I &amp; !b) =&gt;  Q</code>  (exiting the loop because <code>b</code> is false), when exiting the loop, the post condition holds</li>
</ol>

<p>
Thus, to compute WP for loop, you would need to come up with invariants. Moreover, as <a href="#org162e01a">mentioned</a>, we will need to pick a sufficiently strong loop invariants to be able to prove the program. Note that we will always able to create the weakest WP, but it might not be good enough to prove the program at the end.
</p>

<p>
Below we demonstrate the computation of WPs using sufficiently and insufficiently strong invariants. We use the same example program used <a href="#li">here</a>:
</p>
<div class="org-src-container">
<pre class="src src-c"><span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">{N &gt;= 0} </span>
i := 0;
<span style="color: #e45649;">while</span>(<span style="color: #b751b6;">true</span>){
  <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">[I]: loop invariants here</span>
  <span style="color: #e45649;">if</span>(<span style="color: #4078f2; font-weight: bold;">!</span>i &lt; N) <span style="color: #e45649;">break</span>;
  <span style="color: #b751b6;">i</span> := N;
}
<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">{i = N} // post condition</span>
</pre>
</div>

<p>
This program has several loop invariants at <code>[I]</code> including  <code>N &gt;= 0, i&gt;=0, i &lt;= N</code>.  Also, the program can be written as <code>S: i := 0; while[i&lt;=N] i &lt; N do i:= N]</code>, with precondition <code>P: N &gt;= 0</code> and postcondition <code>Q: i==N</code>.
</p>
</div>
</li>

<li><a id="org8b7eee2"></a>Example: using a <i>sufficiently</i> strong invariant<br />
<div class="outline-text-5" id="text-7-2-5-2">
<p>
Here, we use the loop invariant <code>i &lt;= N</code> to prove <code>S</code> is correct wrt to <code>P,Q</code>. As we will see, this loop invariant is sufficiently strong because it allows us to prove the program.
</p>
<ol class="org-ol">
<li><p>
Apply the WP to the program, which is a list of statements.
</p>
<pre class="example">
WP([i := 0; while[i&lt;=N] i &lt; N do i:= N], i = N) 
= WP(i := 0; WP(while[i&lt;=N] i &lt; N do i:=N], i = N)  //WP rule for list of statements
</pre></li>
<li><p>
Apply the WP to <code>while</code> 
</p>
<pre class="example">
// Let's first compute WP(while[i&lt;=N] i &lt; N do i:=N, {i = N}). According to the WP rule for LOOP, we will have 3 conjuncts 
1. i &lt;= N

2. (i &lt;= N &amp; i &lt; N) =&gt; WP(i:=N, {i&lt;=N})
   = i &lt; N          =&gt;  N &lt;= N 
   = i &lt; N          =&gt;  True   
   = True     // because !(i&lt;N) or True  is true (anything or with true is true)

3. (i &lt;= N &amp; !(i&lt;N)) =&gt; i = N
   = i = N           =&gt; i = N
   = True     // because !(i=N) | i = n  is True (a or !a is True)

=  i &lt;= N &amp; True &amp; True
=  i &lt;= N
</pre></li>
<li><p>
After obtaining the WP <code>i&lt;=N</code> for <code>while</code>, we continue with <code>WP(i:=0, i&lt;=N)</code>
</p>
<pre class="example">
// WP([i := 0; while[i&lt;=N] i &lt; N do i:= N], i = N) = WP(i := 0, i&lt;=N)
WP(i := 0, i&lt;=N)
= 0&lt;=N  //WP rule for assignment
</pre></li>
<li><p>
Now we construct a <i>verification condition</i> (<code>vc</code>) to check that the given precondition <code>P: N &gt;= 0</code> implies the WP <code>0&lt;=N</code>
</p>
<pre class="example">
P =&gt; WP([i := 0; while[i&lt;=N] i &lt; N do i:= N], {i = N}) 
= N&gt;=0 =&gt;  0&lt;=N   // N&gt;=0 is the given precondition and 0 &lt;= N is the WP we obtain above for the program
= True
</pre>
<p>
Because te given precondition <code>N&gt;=0</code> implies <code>0&lt;=N</code>, the Hoare tripple is valid, i.e., the program is correct.
</p></li>
<li>Also, the loop invariant <code>i &lt;= N</code> is thus *sufficiently strong to let us prove the program satisfy the specifications.</li>
</ol>
</div>
</li>

<li><a id="orgdc2a371"></a>Example 2: using an <i>insufficiently</i> strong invariant<br />
<div class="outline-text-5" id="text-7-2-5-3">
<p>
Here, we use the loop invariant <code>N &gt;= 0</code> to prove program. As we will see, this loop invariant is not sufficiently strong because we will not be able to use it to prove the program.
</p>

<ol class="org-ol">
<li><p>
Apply the WP to <code>while</code>
</p>
<pre class="example">
WP(while[N &gt;= 0] i &lt; N do i:=N, {i = N})
=
  1. N &gt;= 0
  2. (N &gt;=0 &amp; i &lt; N) =&gt; WP(i := N, N &gt;= 0) = 
     (N &gt;=0 &amp; i &lt; N) =&gt; i &gt;= 0   // we can't simplify much, so just leave as is

  3. N &gt;=0 &amp; !(i&lt;N) =&gt; i =N
     (N &gt;= 0 &amp; i &gt;= N) =&gt; i = N
     i&gt;= 0  =&gt; i = N  // we can't simplify much, so just leave as is

  =  N &gt;=0 &amp; (N &gt;=0 &amp; i &lt; N) =&gt; i &gt;= 0 &amp; (i&gt;= 0  =&gt; i = N)

WP(i:=0; {N &gt;=0 &amp; (N &gt;=0 &amp; i &lt; N) =&gt; i &gt;= 0 &amp; (i&gt;= 0  =&gt; i = N)})
  = (0 &gt;= 0) &amp; (0 &gt;= 0 &amp; 0 &lt; N =&gt; 0 &gt;= 0) &amp; (0&gt;=0 =&gt; 0 = N)  //apply WP for assignment and simplify
  =  TRUE    &amp;      TRUE                  &amp; 0 = N
  = 0 = N
</pre></li>
<li><p>
Obtain the <code>vc</code>
</p>
<pre class="example">
P =&gt; 0 = N  // the given precondition implies 0 = N
(N &gt;= 0) =&gt; 0 = N  // This is not valid, e.g., counterexample N=3
</pre>
<p>
The <code>vc</code> is not valid and thus we were not able to prove the Hoare triple and hence do not know whether the program is correct or not.
</p></li>
<li><p>
Thus this loop invariant is not sufficiently strong for us to prove the program.
</p>

<p>
<b>Important</b>: as mentioned <a href="#li-to-use">here</a>, not being able to prove simply means we cannot prove it using this loop invariant.  It *does not mean that you disprove it or show that the Hoare triple is invalid.  (in fact, we know the Hoare tripple is valid if we used a different loop invariant, e.g., i &lt;= N )
</p></li>
</ol>
</div>
</li>
</ol>
</div>


<div id="outline-container-org4083509" class="outline-4">
<h4 id="org4083509"><span class="section-number-4">7.2.6.</span> Instructor Screencast: TITLE</h4>
<div class="outline-text-4" id="text-7-2-6">
<p>
Link to MP4 File 
</p>
</div>
</div>
<div id="outline-container-org6bda050" class="outline-4">
<h4 id="org6bda050"><span class="section-number-4">7.2.7.</span> Interactive Element: TITLE</h4>
</div>
<div id="outline-container-orgc198ab8" class="outline-4">
<h4 id="orgc198ab8"><span class="section-number-4">7.2.8.</span> Important Concept: Text</h4>
<div class="outline-text-4" id="text-7-2-8">
<p>
Text. 
</p>
</div>
</div>
<div id="outline-container-org710e1c6" class="outline-4">
<h4 id="org710e1c6"><span class="section-number-4">7.2.9.</span> Instructor Screencast: TITLE</h4>
<div class="outline-text-4" id="text-7-2-9">
<p>
Link to MP4 File 
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd77001b" class="outline-2">
<h2 id="orgd77001b"><span class="section-number-2">8.</span> Module 10 Assignment – Program Verification using Hoare Logic (MLO TODO, TODO) [~2.5 hours]</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-org7750487" class="outline-3">
<h3 id="org7750487"><span class="section-number-3">8.1.</span> Purpose</h3>
<div class="outline-text-3" id="text-8-1">
<p>
The purpose of this assignment is to help you practice learned concepts on logical formula, Hoare tripple, and especially program verification using Hoare logic.  
</p>
</div>
</div>


<div id="outline-container-org6ee912d" class="outline-3">
<h3 id="org6ee912d"><span class="section-number-3">8.2.</span> Instructions</h3>
<div class="outline-text-3" id="text-8-2">
</div>
<div id="outline-container-org2ab1162" class="outline-4">
<h4 id="org2ab1162"><span class="section-number-4">8.2.1.</span> Q1</h4>
<div class="outline-text-4" id="text-8-2-1">
<p>
Fill in <code>P,S,Q</code> to make the following Hoare tripples valid.
</p>

<ol class="org-ol">
<li><code>{Q} x:=3 {x = 8}</code></li>
<li><code>{P} x:= y - 3 {x = 8}</code></li>
<li><code>{x = y} S {x = y}</code></li>
<li><code>{x &lt; 0} while(x!=0) do x := x - 1 {Q}</code></li>
</ol>
</div>
</div>

<div id="outline-container-orgb304ad1" class="outline-4">
<h4 id="orgb304ad1"><span class="section-number-4">8.2.2.</span> Q2</h4>
<div class="outline-text-4" id="text-8-2-2">
<p>
Consider the program:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">{N &gt;= 0}   # P</span>
i = 0;
<span style="color: #e45649;">while</span> (i &lt; <span style="color: #986801;">N</span>){
    i = i + 1;
}

<span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">{i == N}  # Q</span>
</pre>
</div>

<ul class="org-ul">
<li>Identify the loop invariants for the loop in this program</li>
<li>Use a sufficiently strong invariant to prove the program is correct</li>
<li>Attemp to prove the program using an insufficiently strong invariant, describe what happens and why.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org36e6a39" class="outline-3">
<h3 id="org36e6a39"><span class="section-number-3">8.3.</span> Deliverable</h3>
<div class="outline-text-3" id="text-8-3">
<p>
Submit a short essay (2 pages maximum) with your response to questions above
</p>
</div>
</div>

<div id="outline-container-org3733707" class="outline-3">
<h3 id="org3733707"><span class="section-number-3">8.4.</span> Due Date</h3>
<div class="outline-text-3" id="text-8-4">
<p>
Your assignment is due by Sunday 11:59 PM, ET. 
</p>
</div>
</div>
</div>

<div id="outline-container-orgbccdfde" class="outline-2">
<h2 id="orgbccdfde"><span class="section-number-2">9.</span> Module 1 Quiz (MLO TODO, TODO, TODO) [~.5 hour]</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-org1ad331e" class="outline-3">
<h3 id="org1ad331e"><span class="section-number-3">9.1.</span> Purpose</h3>
<div class="outline-text-3" id="text-9-1">
<p>
Quizzes in this course give you an opportunity to demonstrate your knowledge of the subject material. 
</p>
</div>
</div>

<div id="outline-container-org317cd21" class="outline-3">
<h3 id="org317cd21"><span class="section-number-3">9.2.</span> Instructions</h3>
<div class="outline-text-3" id="text-9-2">
<p>
Note the following instructions for your quiz: 
The quiz is 20 minutes in length. 
The quiz is closed-book.
</p>
</div>
</div>

<div id="outline-container-org2538073" class="outline-3">
<h3 id="org2538073"><span class="section-number-3">9.3.</span> Deliverable</h3>
<div class="outline-text-3" id="text-9-3">
<p>
Use the link above to take the quiz.
</p>
</div>
</div>

<div id="outline-container-org67b1a27" class="outline-3">
<h3 id="org67b1a27"><span class="section-number-3">9.4.</span> Due Date</h3>
<div class="outline-text-3" id="text-9-4">
<p>
Your quiz submission is due by Sunday 11:59 PM, ET. 
</p>





<p>
Questions:
</p>
<ul class="org-ul">
<li>what is the CLO? what's the diff btw CLO and MLO ?</li>
<li>too details ?</li>
<li>What are these submission deadlines? how to determine?</li>
</ul>
</div>
</div>
</div>
</div>
</body>
</html>
